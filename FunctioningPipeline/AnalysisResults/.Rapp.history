n5
n6
n1 <- 5											## 5#
#
# t 2#
n2 <- off.num(n1)
n2
migrants.out <- m*n2#
migrants.in <- 5#
n2 <- n2 - migrants.out + migrants.in			## 13.57#
#
# t 3#
n3 <- off.num(n2)
n3
migrants.out <- m*n3#
n3 <- n3 - migrants.out + migrants.in			## 26.51#
#
# t 4#
n4 <- off.num(n3)
n4
migrants.out <- m*n4#
n4 <- n4 - migrants.out + migrants.in			## 42.72#
#
# t 5#
n5 <- off.num(n4)
n5
migrants.out <- m*n5#
n5 <- n5 - migrants.out + migrants.in			## 58.88#
#
# t 6#
n6 <- off.num(n5)								##	## #
migrants.out <- m*n6
n6
migrants.out <- m*n6#
n6 <- n6 - migrants.out + migrants.in			## 71.71
n6
n7 <- off.num(n6)								########## 74.12
n7
n7 <- n7 - migrants.out + migrants.in			## 71.71
n7
n8 <- off.num(n7)								########## 83.52
n8
migrants.out <- m*n8#
n8 <- n8 - migrants.out + migrants.in			## 81.11
n8
# t 9#
n9 <- off.num(n8)								########## 89.57
n9
migrants.out <- m*n9#
n9 <- n9 - migrants.out + migrants.in			## 85.61
n9
n10 <- off.num(n9)								########## 92.25
n10
migrants.out <- m*n10#
n10 <- n10 - migrants.out + migrants.in			## 88.02
n10
plot(1:10, c(5, 9.52, 23.9, 41.91, 59.86, 74.12, 83.52, 89.57, 92.25, 93.63), type="o")
plot(1:10, c(5, 9.52, 23.9, 41.91, 59.86, 74.12, 83.52, 89.57, 92.25, 93.63), type="o", ylab="front deme population size", xlab="generation since colonization")
plot(1:10, c(5, 9.52, 23.9, 41.91, 59.86, 74.12, 83.52, 89.57, 92.25, 93.63), ylim=c(0,100), type="o", ylab="front deme population size", xlab="generation since colonization")
plot(1:10, c(5, 9.52, 23.9, 41.91, 59.86, 74.12, 83.52, 89.57, 92.25, 93.63), ylim=c(0,100), type="o", ylab="front deme population size", xlab="generation since colonization")#
abline(h = 100, lty=3, col="gray")
migrants.in
pop.size <- NULL#
prev.pop.size <- 5#
for(i in 1:20){#
	n <- off.num(prev.pop.size)#
	pop.size <- c(pop.size, n)#
	prev.pop.size <- n - m*n + migrants.in#
}
pop.size
plot(1:length(pop.size), pop.size, ylim=c(0,100), type="o", ylab="front deme population size", xlab="generation since colonization")#
abline(h = 100, lty=3, col="gray")
pop.size <- NULL#
prev.pop.size <- 5#
for(i in 1:20){#
	n <- off.num(prev.pop.size)#
	pop.size <- c(pop.size, n)#
	prev.pop.size <- n - m*n + migrants.in#
}#
plot(1:length(pop.size), pop.size, ylim=c(0,100), type="o", ylab="front deme population size", xlab="generation since colonization")#
abline(h = 100, lty=3, col="gray")
?rpois
rpois(1)
abline(v = c(5,10), lty=2, col="gray")
# logistic growth#
#
r <- 2#
K <- 100#
m <- 0.1#
#
off.num <- function(n){#
	ans <- n * (r/(1+(n*(r-1))/K))#
	return(ans)#
}#
#
n1 <- 5											## 5#
#
# t 2#
n2 <- off.num(n1)								########## 9.52#
migrants.out <- m*n2#
migrants.in <- 5#
n2 <- n2 - migrants.out + migrants.in			## 13.57#
#
# t 3#
n3 <- off.num(n2)								########## 23.90#
migrants.out <- m*n3#
n3 <- n3 - migrants.out + migrants.in			## 26.51#
#
# t 4#
n4 <- off.num(n3)								########## 41.91#
migrants.out <- m*n4#
n4 <- n4 - migrants.out + migrants.in			## 42.72#
#
# t 5#
n5 <- off.num(n4)								########## 59.86#
migrants.out <- m*n5#
n5 <- n5 - migrants.out + migrants.in			## 58.88#
#
# t 6#
n6 <- off.num(n5)								########## 74.12#
migrants.out <- m*n6#
n6 <- n6 - migrants.out + migrants.in			## 71.71#
#
# t 7#
n7 <- off.num(n6)								########## 83.52#
migrants.out <- m*n7#
n7 <- n7 - migrants.out + migrants.in			## 81.11#
#
# t 8#
n8 <- off.num(n7)								########## 89.57#
migrants.out <- m*n8#
n8 <- n8 - migrants.out + migrants.in			## 85.61#
#
# t 9#
n9 <- off.num(n8)								########## 92.25#
migrants.out <- m*n9#
n9 <- n9 - migrants.out + migrants.in			## 88.02#
#
# t 10#
n10 <- off.num(n9)								########## 93.63#
migrants.out <- m*n10#
n10 <- n10 - migrants.out + migrants.in			## 89.27#
#
plot(1:10, c(5, 9.52, 23.9, 41.91, 59.86, 74.12, 83.52, 89.57, 92.25, 93.63), ylim=c(0,100), type="o", ylab="front deme population size", xlab="generation since colonization")#
abline(h = 100, lty=3, col="gray")#
#<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>##
#
## AUTOMATED ###
#
#<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>##
pop.size <- NULL#
prev.pop.size <- 5#
for(i in 1:20){#
	n <- off.num(prev.pop.size)#
	pop.size <- c(pop.size, n)#
	prev.pop.size <- n - m*n + migrants.in#
}#
plot(1:length(pop.size), pop.size, ylim=c(0,100), type="o", ylab="front deme population size", xlab="generation since colonization")#
abline(h = 100, lty=3, col="gray")#
abline(v = c(5,10), lty=2, col="gray")
plot(1:length(pop.size), pop.size, ylim=c(0,100), type="b", ylab="front deme population size", xlab="generation since colonization")
plot(1:length(pop.size), pop.size, ylim=c(0,100), type="o", ylab="front deme population size", xlab="generation since colonization")
pop.size <- NULL#
prev.pop.size <- 5#
for(i in 1:20){#
	n <- off.num(prev.pop.size)#
	pop.size <- c(pop.size, n)#
	prev.pop.size <- n - m*n + migrants.in#
}#
plot(1:length(pop.size), pop.size, ylim=c(0,100), type="o", ylab="front deme population size", xlab="generation since colonization")#
abline(h = 100, lty=3, col="gray")#
abline(v = c(5,10), lty=2, col="gray")
pop.size <- NULL#
prev.pop.size <- 5#
for(i in 1:20){#
	n <- off.num(prev.pop.size)#
	pop.size <- c(pop.size, n)#
	prev.pop.size <- n - m*.5*n + migrants.in#
}#
plot(1:length(pop.size), pop.size, ylim=c(0,100), type="o", ylab="front deme population size", xlab="generation since colonization")#
abline(h = 100, lty=3, col="gray")#
abline(v = c(5,10), lty=2, col="gray")
pop.size <- NULL#
prev.pop.size <- 5#
for(i in 1:20){#
	n <- off.num(prev.pop.size)#
	pop.size <- c(pop.size, n)#
	prev.pop.size <- n - m*n + migrants.in#
}#
plot(1:length(pop.size), pop.size, ylim=c(0,100), type="o", ylab="front deme population size", xlab="generation since colonization")#
abline(h = 100, lty=3, col="gray")#
abline(v = c(5,10), lty=2, col="gray")
rnorm
library(maps)  #functions for mapmaking#
library(mapdata)   #some data for rough maps#
library(maptools)  #for other plotting tools#
#
provinces <- readShapePoly("PROVINCE.SHP")
install.packages(mapdata)
install.packages("mapdata")
library(maps)  #functions for mapmaking#
library(mapdata)   #some data for rough maps#
library(maptools)  #for other plotting tools#
#
provinces <- readShapePoly("PROVINCE.SHP")
install.packages("maptools")
library(maps)  #functions for mapmaking#
library(mapdata)   #some data for rough maps#
library(maptools)  #for other plotting tools#
#
provinces <- readShapePoly("PROVINCE.SHP")
map("world", xlim=c(-140,-114),ylim=c(48.4,60), fill=FALSE, col="white")
box()#
axis(side=2, at=c(49,50,51,52,53,54,55,56,57,58,59,60), labels=c("", expression(paste("50", degree, "N")), "", "", "", "", expression(paste("55", degree, "N")), "", "", "", "", expression(paste("60", degree, "N"))))#
axis(side=1, at=seq(-140,-114), labels=c("","","","","",expression(paste("135",degree,"W")),"","","","",expression(paste("130",degree,"W")),"","","","",expression(paste("125",degree, "W")),"","","","",expression(paste("120",degree,"W")),"","","","",expression(paste("115",degree,"W")),""))
map("world", xlim=c(-140,-114),ylim=c(48.4,60), fill=FALSE, col="gray")
pdf("~/Desktop/AmandaMap.pdf", width=6, height=6)#
#
map("world", xlim=c(-140,-114),ylim=c(48.4,60), fill=FALSE, col="gray")#
#
plot(provinces, add=TRUE, col=alpha("gray", 0), border="black", lwd=1)#
#
box()#
axis(side=2, at=c(49,50,51,52,53,54,55,56,57,58,59,60), labels=c("", expression(paste("50", degree, "N")), "", "", "", "", expression(paste("55", degree, "N")), "", "", "", "", expression(paste("60", degree, "N"))))#
axis(side=1, at=seq(-140,-114), labels=c("","","","","",expression(paste("135",degree,"W")),"","","","",expression(paste("130",degree,"W")),"","","","",expression(paste("125",degree, "W")),"","","","",expression(paste("120",degree,"W")),"","","","",expression(paste("115",degree,"W")),""))#
#
dev.off()
pdf("~/Desktop/AmandaMap.pdf", width=6, height=6)#
#
map("world", xlim=c(-140,-114),ylim=c(48.4,60), fill=FALSE, col="gray", bg="blue")#
#
plot(provinces, add=TRUE, col=alpha("gray", 0), border="black", lwd=1)#
#
box()#
axis(side=2, at=c(49,50,51,52,53,54,55,56,57,58,59,60), labels=c("", expression(paste("50", degree, "N")), "", "", "", "", expression(paste("55", degree, "N")), "", "", "", "", expression(paste("60", degree, "N"))))#
axis(side=1, at=seq(-140,-114), labels=c("","","","","",expression(paste("135",degree,"W")),"","","","",expression(paste("130",degree,"W")),"","","","",expression(paste("125",degree, "W")),"","","","",expression(paste("120",degree,"W")),"","","","",expression(paste("115",degree,"W")),""))#
#
dev.off()
pdf("~/Desktop/AmandaMap.pdf", width=6, height=6)#
par(mar=c(0,0,0,0))#
map("world", xlim=c(-140,-114),ylim=c(48.4,60), fill=FALSE, col="gray", bg="blue")#
#
plot(provinces, add=TRUE, col=alpha("gray", 0), border="black", lwd=1)#
#
box()#
axis(side=2, at=c(49,50,51,52,53,54,55,56,57,58,59,60), labels=c("", expression(paste("50", degree, "N")), "", "", "", "", expression(paste("55", degree, "N")), "", "", "", "", expression(paste("60", degree, "N"))))#
axis(side=1, at=seq(-140,-114), labels=c("","","","","",expression(paste("135",degree,"W")),"","","","",expression(paste("130",degree,"W")),"","","","",expression(paste("125",degree, "W")),"","","","",expression(paste("120",degree,"W")),"","","","",expression(paste("115",degree,"W")),""))#
#
dev.off()
pdf("~/Desktop/AmandaMap.pdf", width=6, height=5)#
par(mar=c(0,0,0,0))#
map("world", xlim=c(-140,-114),ylim=c(48.4,60), fill=FALSE, col="gray", bg="blue")#
#
plot(provinces, add=TRUE, col=alpha("gray", 0), border="black", lwd=1)#
#
box()#
axis(side=2, at=c(49,50,51,52,53,54,55,56,57,58,59,60), labels=c("", expression(paste("50", degree, "N")), "", "", "", "", expression(paste("55", degree, "N")), "", "", "", "", expression(paste("60", degree, "N"))))#
axis(side=1, at=seq(-140,-114), labels=c("","","","","",expression(paste("135",degree,"W")),"","","","",expression(paste("130",degree,"W")),"","","","",expression(paste("125",degree, "W")),"","","","",expression(paste("120",degree,"W")),"","","","",expression(paste("115",degree,"W")),""))#
#
dev.off()
pdf("~/Desktop/AmandaMap.pdf", width=5, height=4)#
par(mar=c(0,0,0,0))#
map("world", xlim=c(-140,-114),ylim=c(48.4,60), fill=FALSE, col="gray", bg="blue")#
#
plot(provinces, add=TRUE, col=alpha("gray", 0), border="black", lwd=1)#
#
box()#
axis(side=2, at=c(49,50,51,52,53,54,55,56,57,58,59,60), labels=c("", expression(paste("50", degree, "N")), "", "", "", "", expression(paste("55", degree, "N")), "", "", "", "", expression(paste("60", degree, "N"))))#
axis(side=1, at=seq(-140,-114), labels=c("","","","","",expression(paste("135",degree,"W")),"","","","",expression(paste("130",degree,"W")),"","","","",expression(paste("125",degree, "W")),"","","","",expression(paste("120",degree,"W")),"","","","",expression(paste("115",degree,"W")),""))#
#
dev.off()
pdf("~/Desktop/AmandaMap.pdf", width=5, height=4)#
par(mar=c(0,0,0,0))#
map("world", xlim=c(-140,-114),ylim=c(48.4,60), fill=FALSE, col="gray")#
polygon(x=c(-140,-140, -114,-114), y=c(48.4,60,60,48.4), col="blue")#
#
plot(provinces, add=TRUE, col=alpha("gray", 0), border="black", lwd=1)#
#
box()#
axis(side=2, at=c(49,50,51,52,53,54,55,56,57,58,59,60), labels=c("", expression(paste("50", degree, "N")), "", "", "", "", expression(paste("55", degree, "N")), "", "", "", "", expression(paste("60", degree, "N"))))#
axis(side=1, at=seq(-140,-114), labels=c("","","","","",expression(paste("135",degree,"W")),"","","","",expression(paste("130",degree,"W")),"","","","",expression(paste("125",degree, "W")),"","","","",expression(paste("120",degree,"W")),"","","","",expression(paste("115",degree,"W")),""))#
#
dev.off()
pdf("~/Desktop/AmandaMap.pdf", width=5, height=4)#
par(mar=c(0,0,0,0))#
polygon(x=c(-140,-140, -114,-114), y=c(48.4,60,60,48.4), col="blue")#
map("world", xlim=c(-140,-114),ylim=c(48.4,60), fill=FALSE, col="gray")#
#
plot(provinces, add=TRUE, col=alpha("gray", 0), border="black", lwd=1)#
#
box()#
axis(side=2, at=c(49,50,51,52,53,54,55,56,57,58,59,60), labels=c("", expression(paste("50", degree, "N")), "", "", "", "", expression(paste("55", degree, "N")), "", "", "", "", expression(paste("60", degree, "N"))))#
axis(side=1, at=seq(-140,-114), labels=c("","","","","",expression(paste("135",degree,"W")),"","","","",expression(paste("130",degree,"W")),"","","","",expression(paste("125",degree, "W")),"","","","",expression(paste("120",degree,"W")),"","","","",expression(paste("115",degree,"W")),""))#
#
dev.off()
pdf("~/Desktop/AmandaMap.pdf", width=5, height=4)#
par(mar=c(0,0,0,0))#
map("world", xlim=c(-140,-114),ylim=c(48.4,60), fill=FALSE, col="gray")#
polygon(x=c(-140,-140, -114,-114), y=c(48.4,60,60,48.4), col="blue")#
map("world", xlim=c(-140,-114),ylim=c(48.4,60), fill=FALSE, col="gray")#
#
plot(provinces, add=TRUE, col=alpha("gray", 0), border="black", lwd=1)#
#
box()#
axis(side=2, at=c(49,50,51,52,53,54,55,56,57,58,59,60), labels=c("", expression(paste("50", degree, "N")), "", "", "", "", expression(paste("55", degree, "N")), "", "", "", "", expression(paste("60", degree, "N"))))#
axis(side=1, at=seq(-140,-114), labels=c("","","","","",expression(paste("135",degree,"W")),"","","","",expression(paste("130",degree,"W")),"","","","",expression(paste("125",degree, "W")),"","","","",expression(paste("120",degree,"W")),"","","","",expression(paste("115",degree,"W")),""))#
#
dev.off()
pdf("~/Desktop/AmandaMap.pdf", width=5, height=4)#
par(mar=c(0,0,0,0))#
map("world", xlim=c(-140,-114),ylim=c(48.4,60), fill=FALSE, col="gray")#
polygon(x=c(-140,-140, -114,-114), y=c(48.4,60,60,48.4), col="blue")#
map("world", xlim=c(-140,-114),ylim=c(48.4,60), fill=FALSE, col="gray", add=TRUE)#
#
plot(provinces, add=TRUE, col=alpha("gray", 0), border="black", lwd=1)#
#
box()#
axis(side=2, at=c(49,50,51,52,53,54,55,56,57,58,59,60), labels=c("", expression(paste("50", degree, "N")), "", "", "", "", expression(paste("55", degree, "N")), "", "", "", "", expression(paste("60", degree, "N"))))#
axis(side=1, at=seq(-140,-114), labels=c("","","","","",expression(paste("135",degree,"W")),"","","","",expression(paste("130",degree,"W")),"","","","",expression(paste("125",degree, "W")),"","","","",expression(paste("120",degree,"W")),"","","","",expression(paste("115",degree,"W")),""))#
#
dev.off()
library(maps)  #functions for mapmaking#
library(mapdata)   #some data for rough maps#
library(maptools)  #for other plotting tools#
#
provinces <- readShapePoly("PROVINCE.SHP")#
pdf("~/Desktop/AmandaMap.pdf", width=5, height=4)#
par(mar=c(0,0,0,0))#
map("world", xlim=c(-140,-114),ylim=c(48.4,60), fill=FALSE, col="gray")#
polygon(x=c(-140,-140, -114,-114), y=c(48.4,60,60,48.4), col="blue")#
map("world", xlim=c(-140,-114),ylim=c(48.4,60), fill=FALSE, col="gray", add=TRUE)#
#
plot(provinces, add=TRUE, col=alpha("gray", 0), border="black", lwd=1)#
#
#box()#
axis(side=2, at=c(49,50,51,52,53,54,55,56,57,58,59,60), labels=c("", expression(paste("50", degree, "N")), "", "", "", "", expression(paste("55", degree, "N")), "", "", "", "", expression(paste("60", degree, "N"))))#
axis(side=1, at=seq(-140,-114), labels=c("","","","","",expression(paste("135",degree,"W")),"","","","",expression(paste("130",degree,"W")),"","","","",expression(paste("125",degree, "W")),"","","","",expression(paste("120",degree,"W")),"","","","",expression(paste("115",degree,"W")),""))#
#
dev.off()
?pch
install.packages("DESeq2")
if (!requireNamespace("BiocManager", quietly = TRUE))#
    install.packages("BiocManager")#
BiocManager::install("DESeq2", version = "3.8")
?paste
?heatmap
?dist
test <- matrix(1:100, ncol=10)
test
heatmap(test)
test <- matrix(c(1:10,1:10,1:80), ncol=10)
heatmap(test)
test
test <- matrix(c(rep(1,20),2:79), ncol=10)
test <- matrix(c(rep(1,20),2:81), ncol=10)
test
heatmap(test)
heatmap(test, keep.dendro = TRUE)
ans <- heatmap(test, keep.dendro = TRUE)
ans
test <- matrix(c(rep(1,20),2:91), ncol=11)
ans <- heatmap(test, keep.dendro = TRUE)
test
ans
test <- matrix(c(rep(1,20),2:131), ncol=15)#
#
ans <- heatmap(test, keep.dendro = TRUE)
ans
ans$Rowv
library(dendextend)
install.packages("dendextend")
sum(get_nodes_attr(map$Rowv, "height"))
library(dendextend)
sum(get_nodes_attr(map$Rowv, "height"))
sum(get_nodes_attr(ans$Rowv, "height"))
sum(get_nodes_attr(ans$Colv, "height"))
ans
rep(1:10,2)
test <- matrix(c(rep(1:10,2),2:131), ncol=15)#
#
ans <- heatmap(test, keep.dendro = TRUE)#
ans$Rowv
sum(get_nodes_attr(ans$Rowv, "height"))#
  sum(get_nodes_attr(ans$Colv, "height"))
test <- matrix(c(rep(1:10,15)), ncol=15)
ans <- heatmap(test, keep.dendro = TRUE)
test
test <- matrix(c(rep(1:10,14),10:1), ncol=15)
ans <- heatmap(test, keep.dendro = TRUE)
ans$Rowv
sum(get_nodes_attr(ans$Rowv, "height"))
sum(get_nodes_attr(ans$Colv, "height"))
mat <- matrix(1:100, ncol=10)
mat
ans <- heatmap(mat, keep.dendro=TRUE)
ans <- heatmap(mat, keep.dendro=TRUE, plot=FALSE)
?heatmap
start <- 0
end <- start + window.size
end
step <- 500000
window.size <- 2000000
end <- start + window.size
end
paste(c(start, end), collapse="_")
rm(list = ls(all.names = TRUE))
s1 <- 0.1#
s2 <- 0.2#
#
qe <- s1 / (s1+s2)
s1 <- 0.1#
s2 <- 0.2#
#
(qe <- s1 / (s1+s2))
s1 <- 0.1#
s2 <- 0.3#
#
(qe <- s1 / (s1+s2))
s1 <- 0.1#
s2 <- 0.11#
#
(qe <- s1 / (s1+s2))
s1 <- 0.1#
s2 <- 0.1001#
#
(qe <- s1 / (s1+s2))
s1 <- 0.1#
s2 <- 0.100001#
#
(qe <- s1 / (s1+s2))
(h <- s1 / (s1-s2))
(s <- (s2 - s1) / (s1 - 1))
s1 <- 0.1#
s2 <- 0.10001#
#
(qe <- s1 / (s1+s2))#
#
(h <- s1 / (s1-s2))#
#
(s <- (s2 - s1) / (s1 - 1))
s1 <- 0.1#
s2 <- 0.2#
(qe <- s1 / (s1+s2))
s1 <- 0.1#
s2 <- 0.3#
(qe <- s1 / (s1+s2))
s1 <- 0.1#
s2 <- 0.4#
(qe <- s1 / (s1+s2))
(h <- s1 / (s1-s2))
(s <- (s2 - s1) / (s1 - 1))
s2 <- 0.5
s1 <- 0.1#
s2 <- 0.5#
#
(qe <- s1 / (s1+s2))
s1 <- 0.1#
s2 <- 0.7#
#
(qe <- s1 / (s1+s2))
s1 <- 0.1#
s2 <- 1#
#
(qe <- s1 / (s1+s2))
s1 <- 0.1#
s2 <- 1.5#
#
(qe <- s1 / (s1+s2))
s1 <- 0.1#
s2 <- 1.7#
#
(qe <- s1 / (s1+s2))
s1 <- 0.1#
s2 <- 1.75#
#
(qe <- s1 / (s1+s2))
s1 <- 0.1#
s2 <- 1.8#
#
(qe <- s1 / (s1+s2))
s1 <- 0.1#
s2 <- 1.9#
#
(qe <- s1 / (s1+s2))
(h <- s1 / (s1-s2))#
#
(s <- (s2 - s1) / (s1 - 1))
s1 <- 0.1#
s2 <- 0.10001
(qe <- s1 / (s1+s2))#
#
(h <- s1 / (s1-s2))#
#
(s <- (s2 - s1) / (s1 - 1))#
#
het <- 1 + (h*s)#
hom <- 1-s
het
hom
s1 <- 0.1#
s2 <- 0.4
(qe <- s1 / (s1+s2))#
#
(h <- s1 / (s1-s2))#
#
(s <- (s2 - s1) / (s1 - 1))#
#
het <- 1 + (h*s)#
hom <- 1-s
het
hom
s1 <- 0.1#
s2 <- 0.4
(qe <- s1 / (s1+s2))
(h <- s1 / (s1-s2))
(s <- (s2 - s1) / (s1 - 1))
het <- 1 + (h*s)
het
h
hom <- 1-s
s1 <- 0.1#
s2 <- 1.9#
#
(qe <- s1 / (s1+s2))#
#
(h <- s1 / (s1-s2))#
#
(s <- (s2 - s1) / (s1 - 1))#
#
het <- 1 + (h*s)#
hom <- 1-s
het
hom
s1 <- 0.1#
s2 <- 0.10001
(qe <- s1 / (s1+s2))#
#
(h <- s1 / (s1-s2))#
#
(s <- (s2 - s1) / (s1 - 1))#
#
(het <- 1 + (h*s))#
(hom <- 1+s)
s1 <- 0.1#
s2 <- 0.4
(qe <- s1 / (s1+s2))#
#
(h <- s1 / (s1-s2))#
#
(s <- (s2 - s1) / (s1 - 1))#
#
(het <- 1 + (h*s))#
(hom <- 1+s)
s1 <- 0.1#
s2 <- 1.9#
#
(qe <- s1 / (s1+s2))#
#
(h <- s1 / (s1-s2))#
#
(s <- (s2 - s1) / (s1 - 1))#
#
(het <- 1 + (h*s))#
(hom <- 1+s)
s1 <- 0.1#
s2 <- 0.1001
(qe <- s1 / (s1+s2))
(h <- s1 / (s1-s2))
(s <- (s2 - s1) / (s1 - 1))
library(ape)
a <- read.dna("~/Documents/UNIL/PartitioningMethods_SimulationProject/FunctioningPipeline/results_lopho/sim_match_lophotroch/MSA/MSA_1_aa.fa", format="fasta")
a <- read.dna("~/Documents/UNIL/PartitioningMethods_SimulationProject/FunctioningPipeline/results_lopho/sim_match_lophotroch/MSA/MSA_2_aa.fa", format="fasta")
a <- read.dna("~/Documents/UNIL/PartitioningMethods_SimulationProject/FunctioningPipeline/results_lopho/sim_match_lophotroch/MSA/MSA_1_aa.fa", format="fasta")
b <- read.dna("~/Documents/UNIL/PartitioningMethods_SimulationProject/FunctioningPipeline/results_lopho/sim_match_lophotroch/MSA/MSA_2_aa.fa", format="fasta")
c <- cbind(a,b)
print(5)
library(scales)#
setwd("~/Documents/UNIL/PartitioningMethods_SimulationProject/FunctioningPipeline/AnalysisResults")#
make.merge.id <- function(dat){#
	id.col <- rep(NA, dim(dat)[1])#
	for(i in 1:dim(dat)[1]){#
		if(length(grep("lopho", dat$file[i])) > 0) spp <- "lopho_"#
		if(length(grep("myria", dat$file[i])) > 0) spp <- "myria_"#
		if(length(grep("10", dat$file[i])) > 0) samp <- "10_"#
		if(length(grep("20", dat$file[i])) > 0) samp <- "20_"#
		if(length(grep("40", dat$file[i])) > 0) samp <- "40_"#
		if(length(grep("80", dat$file[i])) > 0) samp <- "80_"#
		if(length(grep("rcluster", dat$file[i])) > 0) algo <- "rcluster_"#
		if(length(grep("greedy", dat$file[i])) > 0) algo <- "greedy_"#
		if(length(grep("noPart", dat$file[i])) > 0) algo <- "noPart_"#
		if(length(grep("AIC", dat$file[i])) > 0) crit <- "AIC"#
		if(length(grep("AICc", dat$file[i])) > 0) crit <- "AICc"#
		if(length(grep("BIC", dat$file[i])) > 0) crit <- "BIC"#
		if(length(grep("noPart", dat$file[i])) > 0) crit <- "noPart"#
		id.col[i] <- paste(c(spp, samp, algo, crit), collapse="")#
	}#
	return(id.col)#
}#
#####################################
#
get.rep.difference <- function(dat, rep, samp.size, spp, partitioning.criterion, distance){#
	temp.dat <- dat[dat$replicate == rep & dat$samp.size == samp.size & dat$species == spp , ]#
	no.part.result <- temp.dat[temp.dat$search.algo == "noPart" ,]#
	rclust.AIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AIC" ,]#
	rclust.BIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "BIC" ,]#
	rclust.AICc.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AICc",]#
	if(partitioning.criterion == "AIC"){#
		if(dim(rclust.AIC.result[distance])[1] == 0 | dim(no.part.result[distance])[1] == 0){ difference <- NA}#
		else{ difference <- no.part.result[distance] - rclust.AIC.result[distance] }#
	}#
	if(partitioning.criterion == "BIC"){#
		if(dim(rclust.BIC.result[distance])[1] == 0 | dim(no.part.result[distance])[1] == 0){ difference <- NA}#
		else{ difference <- no.part.result[distance] - rclust.BIC.result[distance] }#
	}#
	if(partitioning.criterion == "AICc"){#
		if(dim(rclust.AICc.result[distance])[1] == 0 | dim(no.part.result[distance])[1] == 0){ difference <- NA}#
		else{ difference <- no.part.result[distance] - rclust.AICc.result[distance] }#
	}#
	return(as.numeric(difference))			#
}#
#
#####################################
#
get.boxplot.dat <- function(dat, samp.size, spp, partitioning.criterion, distance){	#
	samp.size.dists <- NULL#
	for(j in unique(dat$replicate)){#
		dist <- get.rep.difference(dat, rep=j, samp.size=samp.size, spp=spp, partitioning.criterion=partitioning.criterion, distance=distance)#
		samp.size.dists <- c(samp.size.dists, dist)#
	}#
	return(samp.size.dists)#
}#
#
#####################################
#
get.partition.dat <- function(dat, samp.size, spp, partitioning.criterion){	#
	partition.numbers <- NULL#
	for(j in unique(dat$replicate)){#
		temp.dat <- dat[dat$replicate == j & dat$samp.size == samp.size & dat$species == spp , ]#
		rclust.AIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AIC" ,]#
		rclust.BIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "BIC" ,]#
		rclust.AICc.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AICc",]#
		if(partitioning.criterion == "AIC"){#
			if(length(rclust.AIC.result$num.partitions)[1] == 0){ num.parts <- NA}#
			else{ num.parts <- rclust.AIC.result$num.partitions }#
		}#
		if(partitioning.criterion == "BIC"){#
			if(length(rclust.BIC.result$num.partitions)[1] == 0){ num.parts <- NA}#
			else{ num.parts <- rclust.BIC.result$num.partitions }#
		}#
		if(partitioning.criterion == "AICc"){#
			if(length(rclust.AICc.result$num.partitions)[1] == 0){ num.parts <- NA}#
			else{ num.parts <- rclust.AICc.result$num.partitions }#
		}#
		partition.numbers <- c(partition.numbers, num.parts)#
	}#
	return(partition.numbers)#
}#
#
#####################################
# mut rate 1000#
#
infiles.a <- c("AllStatsOutput_New_Rep1_100-1000.csv",#
				"AllStatsOutput_New_Rep2_100-1000.csv",#
				"AllStatsOutput_New_Rep3_100-1000.csv",#
				"AllStatsOutput_New_Rep4_100-1000.csv",#
				"AllStatsOutput_New_Rep5_100-1000.csv",#
				"AllStatsOutput_New_Rep6_100-1000.csv",#
				"AllStatsOutput_Newest_Rep7_100-1000.csv",#
				"AllStatsOutput_Newest_Rep8_100-1000.csv",#
				"AllStatsOutput_Newest_Rep9_100-1000.csv",#
				"AllStatsOutput_Newest_Rep10_100-1000.csv",#
				"AllStatsOutput_Newest_Rep11_100-1000.csv",#
				"AllStatsOutput_Newest_Rep12_100-1000.csv",#
				"AllStatsOutput_Newest_Rep13_100-1000.csv",#
				"AllStatsOutput_Newest_Rep14_100-1000.csv",#
				"AllStatsOutput_Newest_Rep15_100-1000.csv",#
				"AllStatsOutput_Newest_Rep16_100-1000.csv",#
				"AllStatsOutput_Newest_Rep17_100-1000.csv",#
				"AllStatsOutput_Newest_Rep18_100-1000.csv",#
				"AllStatsOutput_Newest_Rep19_100-1000.csv",#
				"AllStatsOutput_Newest_Rep20_100-1000.csv"#
				)#
infiles.b <- c("RF_Eucl_results_New_Rep1_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep2_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep3_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep4_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep5_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep6_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep7_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep8_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep9_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep10_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep11_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep12_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep13_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep14_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep15_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep16_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep17_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep18_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep19_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep20_100-1000_wConsensus.txt"#
				)#
#
dat <- NULL#
for(i in c(1:5,7:20)){#length(infiles.a)){ #**************UNCOMMENT ME FOR ALL REPS#
	temp.dat1 <- read.csv(infiles.a[i], header=TRUE, stringsAsFactors=FALSE)#
	temp.dat1$uniqueID <- paste(temp.dat1$species, temp.dat1$samp.size, temp.dat1$search.algo, temp.dat1$part.IC, sep="_")#
	temp.dat2 <- read.table(infiles.b[i], header=TRUE, stringsAsFactors=FALSE)#
	# because also have consenseus trees now:#
	temp.dat2 <- cbind(temp.dat2[1:32,], temp.dat2[33:64, 2:3])#
	names(temp.dat2) <- c("filename", "rf_dist", "eucl_dist", "cons_rf_dist", "cons_eucl_dist")#
	temp.dat2$uniqueID <- make.merge.id(temp.dat2)#
	temp.dat <- merge(temp.dat1, temp.dat2, by="uniqueID")#
	temp.dat$gene.size <- 100#
	temp.dat$mut.rate <- 1000#
	temp.dat$replicate <- i#
	dat <- rbind(dat, temp.dat)#
}#
#
no.part.dat <- dat[dat$part.IC == "noPart" ,]
head(dat)
range(dat$rf_dist)
quartile(dat$rf_dist)
sd(dat$rf_dist)
mean(dat$rf_dist)
head(dat)
dat[c("species", "samp.size", "search.algo", "part.IC", "eucl_dist")]
dat[c("species", "samp.size", "search.algo", "part.IC", "eucl_dist", "replicate")]
dat[c("species", "samp.size", "search.algo", "part.IC", "eucl_dist", "replicate"), which(dat$replicate == "18")]
dat[c("species", "samp.size", "search.algo", "part.IC", "eucl_dist", "replicate")][,which(dat$replicate == "18")]
dat[c("species", "samp.size", "search.algo", "part.IC", "eucl_dist", "replicate")]
dat[c("species", "samp.size", "search.algo", "part.IC", "eucl_dist", "replicate")][1:10,]
dat[c("species", "samp.size", "search.algo", "part.IC", "eucl_dist", "replicate")][which(dat$replicate == "18"),]
dat[c("species", "samp.size", "search.algo", "part.IC", "eucl_dist", "replicate")][which(dat$replicate == "18") & which(dat$samp.size == "80"),]
which(dat$replicate == "18") & which(dat$samp.size == "80")
dat[c("species", "samp.size", "search.algo", "part.IC", "eucl_dist", "replicate")][which(dat$replicate == "18" & dat$samp.size == "80"),]
head(dat)
dat[c(3:20,22:25,28)][which(dat$replicate == "18" & dat$samp.size == "80"),]
dat[c(3:20,22:25,28)][which(dat$replicate == "18" | dat$replicate == "20" & dat$samp.size == "80"),]
dat[c(3:20,22:25,28)][which(dat$replicate == "18" & dat$samp.size == "80" | dat$replicate == "20" & dat$samp.size == "80"),]
dat[dat$replicate == "6" ,]
dat[c(3:20,22:25,28)][which(dat$replicate == "18" & dat$samp.size == "80" | dat$replicate == "20" & dat$samp.size == "80"),]
library(scales)#
setwd("~/Documents/UNIL/PartitioningMethods_SimulationProject/FunctioningPipeline/AnalysisResults")#
make.merge.id <- function(dat){#
	id.col <- rep(NA, dim(dat)[1])#
	for(i in 1:dim(dat)[1]){#
		if(length(grep("lopho", dat$file[i])) > 0) spp <- "lopho_"#
		if(length(grep("myria", dat$file[i])) > 0) spp <- "myria_"#
		if(length(grep("10", dat$file[i])) > 0) samp <- "10_"#
		if(length(grep("20", dat$file[i])) > 0) samp <- "20_"#
		if(length(grep("40", dat$file[i])) > 0) samp <- "40_"#
		if(length(grep("80", dat$file[i])) > 0) samp <- "80_"#
		if(length(grep("rcluster", dat$file[i])) > 0) algo <- "rcluster_"#
		if(length(grep("greedy", dat$file[i])) > 0) algo <- "greedy_"#
		if(length(grep("noPart", dat$file[i])) > 0) algo <- "noPart_"#
		if(length(grep("AIC", dat$file[i])) > 0) crit <- "AIC"#
		if(length(grep("AICc", dat$file[i])) > 0) crit <- "AICc"#
		if(length(grep("BIC", dat$file[i])) > 0) crit <- "BIC"#
		if(length(grep("noPart", dat$file[i])) > 0) crit <- "noPart"#
		id.col[i] <- paste(c(spp, samp, algo, crit), collapse="")#
	}#
	return(id.col)#
}#
#####################################
#
get.rep.difference <- function(dat, rep, samp.size, spp, partitioning.criterion, distance){#
	temp.dat <- dat[dat$replicate == rep & dat$samp.size == samp.size & dat$species == spp , ]#
	no.part.result <- temp.dat[temp.dat$search.algo == "noPart" ,]#
	rclust.AIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AIC" ,]#
	rclust.BIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "BIC" ,]#
	rclust.AICc.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AICc",]#
	if(partitioning.criterion == "AIC"){#
		if(dim(rclust.AIC.result[distance])[1] == 0 | dim(no.part.result[distance])[1] == 0){ difference <- NA}#
		else{ difference <- no.part.result[distance] - rclust.AIC.result[distance] }#
	}#
	if(partitioning.criterion == "BIC"){#
		if(dim(rclust.BIC.result[distance])[1] == 0 | dim(no.part.result[distance])[1] == 0){ difference <- NA}#
		else{ difference <- no.part.result[distance] - rclust.BIC.result[distance] }#
	}#
	if(partitioning.criterion == "AICc"){#
		if(dim(rclust.AICc.result[distance])[1] == 0 | dim(no.part.result[distance])[1] == 0){ difference <- NA}#
		else{ difference <- no.part.result[distance] - rclust.AICc.result[distance] }#
	}#
	return(as.numeric(difference))			#
}#
#
#####################################
#
get.boxplot.dat <- function(dat, samp.size, spp, partitioning.criterion, distance){	#
	samp.size.dists <- NULL#
	for(j in unique(dat$replicate)){#
		dist <- get.rep.difference(dat, rep=j, samp.size=samp.size, spp=spp, partitioning.criterion=partitioning.criterion, distance=distance)#
		samp.size.dists <- c(samp.size.dists, dist)#
	}#
	return(samp.size.dists)#
}#
#
#####################################
#
get.partition.dat <- function(dat, samp.size, spp, partitioning.criterion){	#
	partition.numbers <- NULL#
	for(j in unique(dat$replicate)){#
		temp.dat <- dat[dat$replicate == j & dat$samp.size == samp.size & dat$species == spp , ]#
		rclust.AIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AIC" ,]#
		rclust.BIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "BIC" ,]#
		rclust.AICc.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AICc",]#
		if(partitioning.criterion == "AIC"){#
			if(length(rclust.AIC.result$num.partitions)[1] == 0){ num.parts <- NA}#
			else{ num.parts <- rclust.AIC.result$num.partitions }#
		}#
		if(partitioning.criterion == "BIC"){#
			if(length(rclust.BIC.result$num.partitions)[1] == 0){ num.parts <- NA}#
			else{ num.parts <- rclust.BIC.result$num.partitions }#
		}#
		if(partitioning.criterion == "AICc"){#
			if(length(rclust.AICc.result$num.partitions)[1] == 0){ num.parts <- NA}#
			else{ num.parts <- rclust.AICc.result$num.partitions }#
		}#
		partition.numbers <- c(partition.numbers, num.parts)#
	}#
	return(partition.numbers)#
}#
#
#####################################
# mut rate 1000#
#
infiles.a <- c("AllStatsOutput_New_Rep1_100-1000.csv",#
				"AllStatsOutput_New_Rep2_100-1000.csv",#
				"AllStatsOutput_New_Rep3_100-1000.csv",#
				"AllStatsOutput_New_Rep4_100-1000.csv",#
				"AllStatsOutput_New_Rep5_100-1000.csv",#
				"AllStatsOutput_New_Rep6_100-1000.csv",#
				"AllStatsOutput_Newest_Rep7_100-1000.csv",#
				"AllStatsOutput_Newest_Rep8_100-1000.csv",#
				"AllStatsOutput_Newest_Rep9_100-1000.csv",#
				"AllStatsOutput_Newest_Rep10_100-1000.csv",#
				"AllStatsOutput_Newest_Rep11_100-1000.csv",#
				"AllStatsOutput_Newest_Rep12_100-1000.csv",#
				"AllStatsOutput_Newest_Rep13_100-1000.csv",#
				"AllStatsOutput_Newest_Rep14_100-1000.csv",#
				"AllStatsOutput_Newest_Rep15_100-1000.csv",#
				"AllStatsOutput_Newest_Rep16_100-1000.csv",#
				"AllStatsOutput_Newest_Rep17_100-1000.csv",#
				"AllStatsOutput_Newest_Rep18_100-1000.csv",#
				"AllStatsOutput_Newest_Rep19_100-1000.csv",#
				"AllStatsOutput_Newest_Rep20_100-1000.csv"#
				)#
infiles.b <- c("RF_Eucl_results_New_Rep1_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep2_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep3_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep4_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep5_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep6_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep7_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep8_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep9_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep10_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep11_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep12_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep13_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep14_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep15_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep16_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep17_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep18_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep19_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep20_100-1000_wConsensus.txt"#
				)#
#
dat <- NULL#
for(i in c(1:5,7:20)){#length(infiles.a)){ #**************UNCOMMENT ME FOR ALL REPS#
	temp.dat1 <- read.csv(infiles.a[i], header=TRUE, stringsAsFactors=FALSE)#
	temp.dat1$uniqueID <- paste(temp.dat1$species, temp.dat1$samp.size, temp.dat1$search.algo, temp.dat1$part.IC, sep="_")#
	temp.dat2 <- read.table(infiles.b[i], header=TRUE, stringsAsFactors=FALSE)#
	# because also have consenseus trees now:#
	temp.dat2 <- cbind(temp.dat2[1:32,], temp.dat2[33:64, 2:3])#
	names(temp.dat2) <- c("filename", "rf_dist", "eucl_dist", "cons_rf_dist", "cons_eucl_dist")#
	temp.dat2$uniqueID <- make.merge.id(temp.dat2)#
	temp.dat <- merge(temp.dat1, temp.dat2, by="uniqueID")#
	temp.dat$gene.size <- 100#
	temp.dat$mut.rate <- 1000#
	temp.dat$replicate <- i#
	dat <- rbind(dat, temp.dat)#
}#
#
no.part.dat <- dat[dat$part.IC == "noPart" ,]#
## IS there a statistically significant difference between the RF/eucl distance to true tree of no partitioning vs with partitioning??#
# compare at each sample size, for each species, for both RF and euclidean distance#
#
spp <- c("myria", "lopho")#
samps <- c(10,20,40,80)#
stat.data.set <- data.frame(matrix(NA, ncol=14, nrow=8))#
names(stat.data.set) <- c("species", "samp.size", "rf_twoside_p", "rf_less_p", "rf_greater_p", "eucl_twoside_p", "eucl_less_p", "eucl_greater_p", "cons_rf_twoside_p", "cons_rf_less_p", "cons_rf_greater_p", "cons_eucl_twoside_p", "cons_eucl_less_p", "cons_eucl_greater_p")#
#
iterate <- 1#
for(j in spp){#
	for(k in samps){#
		temp.dat.no.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "noPart" , ]#
		temp.dat.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "BIC" , ]#
		rf_ts_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		rf_less_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		rf_greater_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		eucl_ts_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		eucl_less_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		eucl_greater_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
#
		# also for the consensus tree#
		cons_rf_ts_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		cons_rf_less_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		cons_rf_greater_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		cons_eucl_ts_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		cons_eucl_less_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		cons_eucl_greater_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
		stat.data.set[iterate, ] <- c(j, k, rf_ts_p, rf_less_p, rf_greater_p, eucl_ts_p, eucl_less_p, eucl_greater_p, cons_rf_ts_p, cons_rf_less_p, cons_rf_greater_p, cons_eucl_ts_p, cons_eucl_less_p, cons_eucl_greater_p)#
		iterate <- iterate + 1#
	}#
}#
#####################################
samp.size.col <- c("steelblue4", "darkorange2", "green4", "red3")#
outline.col <- "gray30"#
samp.sizes <- c(10,20,40,80)#
#####################################
ylim1 <- c(-0.155, 0.155)#
ylim2 <- c(-1.35, 1.35)#
ylim3 <- c(0.5,10)#
box.width <- 1#
line.type <- 1#
line.width <- 1.75#
ytext1 <- 0.13#
ytext2 <- 1.075#
p.height1 <- 0.15#
p.height2 <- 1.3#
criteria <- c("AIC", "BIC", "AICc")#
for(criterion in criteria){#
#
part.crit <- criterion#
#
pdf(paste(c("Results_Plots/Boxplots_", part.crit, "_StatsParts.pdf"), collapse=""), width=6, height=10)#
##par(mfrow=c(3,1), mar=c(2.5,4.25,1.75,0.25))#
par(mar=c(2.5,4.25,1.75,0.25))#
layout(matrix(c(1,1,2,2,3), ncol=1))#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim1, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Robinson Fould distance", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext1, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext1, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
# add p values from 2-sided wilcoxon test#
text(x=c(0.5,1:4), y=rep(p.height1, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height1, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
legend("bottomright", c("10", "20", "40", "80"), pch=15, col=samp.size.col, title = "num. genes", cex=0.875, pt.cex=1.5) # , bg="white"#
# eucl distance#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim2, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Euclidean distance", mgp=c(3,0.9,0))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext2, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext2, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=c(0.5,1:4), y=rep(p.height2, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height2, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
# number partitions#
par(mar=c(2.5,4.25,0.25,0.25))#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim3, xlab="", xaxt="n", ylab="number partitions inferred", main="", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
# AND NOW USING CONSENSUS TREE DISTANCE INSTEAD#
#
par(mar=c(2.5,4.25,1.75,0.25))#
#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim1, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Robinson Fould distance", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext1, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext1, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="cons_rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
# add p values from 2-sided wilcoxon test#
text(x=c(0.5,1:4), y=rep(p.height1, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="cons_rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height1, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
legend("bottomright", c("10", "20", "40", "80"), pch=15, col=samp.size.col, title = "num. genes", cex=0.875, pt.cex=1.5) # , bg="white"#
# eucl distance#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim2, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Euclidean distance", mgp=c(3,0.9,0))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext2, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext2, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="cons_eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=c(0.5,1:4), y=rep(p.height2, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="cons_eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height2, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
#SAME # number partitions#
par(mar=c(2.5,4.25,0.25,0.25))#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim3, xlab="", xaxt="n", ylab="number partitions inferred", main="", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
dev.off()#
}
dat[c(3:20,22:25,28)][which(dat$replicate == "18" & dat$samp.size == "80" | dat$replicate == "20" & dat$samp.size == "80"),]
library(scales)#
setwd("~/Documents/UNIL/PartitioningMethods_SimulationProject/FunctioningPipeline/AnalysisResults")#
make.merge.id <- function(dat){#
	id.col <- rep(NA, dim(dat)[1])#
	for(i in 1:dim(dat)[1]){#
		if(length(grep("lopho", dat$file[i])) > 0) spp <- "lopho_"#
		if(length(grep("myria", dat$file[i])) > 0) spp <- "myria_"#
		if(length(grep("10", dat$file[i])) > 0) samp <- "10_"#
		if(length(grep("20", dat$file[i])) > 0) samp <- "20_"#
		if(length(grep("40", dat$file[i])) > 0) samp <- "40_"#
		if(length(grep("80", dat$file[i])) > 0) samp <- "80_"#
		if(length(grep("rcluster", dat$file[i])) > 0) algo <- "rcluster_"#
		if(length(grep("greedy", dat$file[i])) > 0) algo <- "greedy_"#
		if(length(grep("noPart", dat$file[i])) > 0) algo <- "noPart_"#
		if(length(grep("AIC", dat$file[i])) > 0) crit <- "AIC"#
		if(length(grep("AICc", dat$file[i])) > 0) crit <- "AICc"#
		if(length(grep("BIC", dat$file[i])) > 0) crit <- "BIC"#
		if(length(grep("noPart", dat$file[i])) > 0) crit <- "noPart"#
		id.col[i] <- paste(c(spp, samp, algo, crit), collapse="")#
	}#
	return(id.col)#
}#
#####################################
#
get.rep.difference <- function(dat, rep, samp.size, spp, partitioning.criterion, distance){#
	temp.dat <- dat[dat$replicate == rep & dat$samp.size == samp.size & dat$species == spp , ]#
	no.part.result <- temp.dat[temp.dat$search.algo == "noPart" ,]#
	rclust.AIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AIC" ,]#
	rclust.BIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "BIC" ,]#
	rclust.AICc.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AICc",]#
	if(partitioning.criterion == "AIC"){#
		if(dim(rclust.AIC.result[distance])[1] == 0 | dim(no.part.result[distance])[1] == 0){ difference <- NA}#
		else{ difference <- no.part.result[distance] - rclust.AIC.result[distance] }#
	}#
	if(partitioning.criterion == "BIC"){#
		if(dim(rclust.BIC.result[distance])[1] == 0 | dim(no.part.result[distance])[1] == 0){ difference <- NA}#
		else{ difference <- no.part.result[distance] - rclust.BIC.result[distance] }#
	}#
	if(partitioning.criterion == "AICc"){#
		if(dim(rclust.AICc.result[distance])[1] == 0 | dim(no.part.result[distance])[1] == 0){ difference <- NA}#
		else{ difference <- no.part.result[distance] - rclust.AICc.result[distance] }#
	}#
	return(as.numeric(difference))			#
}#
#
#####################################
#
get.boxplot.dat <- function(dat, samp.size, spp, partitioning.criterion, distance){	#
	samp.size.dists <- NULL#
	for(j in unique(dat$replicate)){#
		dist <- get.rep.difference(dat, rep=j, samp.size=samp.size, spp=spp, partitioning.criterion=partitioning.criterion, distance=distance)#
		samp.size.dists <- c(samp.size.dists, dist)#
	}#
	return(samp.size.dists)#
}#
#
#####################################
#
get.partition.dat <- function(dat, samp.size, spp, partitioning.criterion){	#
	partition.numbers <- NULL#
	for(j in unique(dat$replicate)){#
		temp.dat <- dat[dat$replicate == j & dat$samp.size == samp.size & dat$species == spp , ]#
		rclust.AIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AIC" ,]#
		rclust.BIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "BIC" ,]#
		rclust.AICc.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AICc",]#
		if(partitioning.criterion == "AIC"){#
			if(length(rclust.AIC.result$num.partitions)[1] == 0){ num.parts <- NA}#
			else{ num.parts <- rclust.AIC.result$num.partitions }#
		}#
		if(partitioning.criterion == "BIC"){#
			if(length(rclust.BIC.result$num.partitions)[1] == 0){ num.parts <- NA}#
			else{ num.parts <- rclust.BIC.result$num.partitions }#
		}#
		if(partitioning.criterion == "AICc"){#
			if(length(rclust.AICc.result$num.partitions)[1] == 0){ num.parts <- NA}#
			else{ num.parts <- rclust.AICc.result$num.partitions }#
		}#
		partition.numbers <- c(partition.numbers, num.parts)#
	}#
	return(partition.numbers)#
}#
#
#####################################
# mut rate 1000#
#
infiles.a <- c("AllStatsOutput_New_Rep1_100-1000.csv",#
				"AllStatsOutput_New_Rep2_100-1000.csv",#
				"AllStatsOutput_New_Rep3_100-1000.csv",#
				"AllStatsOutput_New_Rep4_100-1000.csv",#
				"AllStatsOutput_New_Rep5_100-1000.csv",#
				"AllStatsOutput_New_Rep6_100-1000.csv",#
				"AllStatsOutput_Newest_Rep7_100-1000.csv",#
				"AllStatsOutput_Newest_Rep8_100-1000.csv",#
				"AllStatsOutput_Newest_Rep9_100-1000.csv",#
				"AllStatsOutput_Newest_Rep10_100-1000.csv",#
				"AllStatsOutput_Newest_Rep11_100-1000.csv",#
				"AllStatsOutput_Newest_Rep12_100-1000.csv",#
				"AllStatsOutput_Newest_Rep13_100-1000.csv",#
				"AllStatsOutput_Newest_Rep14_100-1000.csv",#
				"AllStatsOutput_Newest_Rep15_100-1000.csv",#
				"AllStatsOutput_Newest_Rep16_100-1000.csv",#
				"AllStatsOutput_Newest_Rep17_100-1000.csv",#
				"AllStatsOutput_Newest_Rep18_100-1000.csv",#
				"AllStatsOutput_Newest_Rep19_100-1000.csv",#
				"AllStatsOutput_Newest_Rep20_100-1000.csv"#
				)#
infiles.b <- c("RF_Eucl_results_New_Rep1_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep2_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep3_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep4_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep5_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep6_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep7_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep8_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep9_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep10_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep11_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep12_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep13_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep14_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep15_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep16_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep17_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep18_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep19_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep20_100-1000_wConsensus.txt"#
				)#
#
dat <- NULL#
for(i in c(1:5,7:20)){#length(infiles.a)){ #**************UNCOMMENT ME FOR ALL REPS#
	temp.dat1 <- read.csv(infiles.a[i], header=TRUE, stringsAsFactors=FALSE)#
	temp.dat1$uniqueID <- paste(temp.dat1$species, temp.dat1$samp.size, temp.dat1$search.algo, temp.dat1$part.IC, sep="_")#
	temp.dat2 <- read.table(infiles.b[i], header=TRUE, stringsAsFactors=FALSE)#
	# because also have consenseus trees now:#
	temp.dat2 <- cbind(temp.dat2[1:32,], temp.dat2[33:64, 2:3])#
	names(temp.dat2) <- c("filename", "rf_dist", "eucl_dist", "cons_rf_dist", "cons_eucl_dist")#
	temp.dat2$uniqueID <- make.merge.id(temp.dat2)#
	temp.dat <- merge(temp.dat1, temp.dat2, by="uniqueID")#
	temp.dat$gene.size <- 100#
	temp.dat$mut.rate <- 1000#
	temp.dat$replicate <- i#
	dat <- rbind(dat, temp.dat)#
}#
#
no.part.dat <- dat[dat$part.IC == "noPart" ,]#
## IS there a statistically significant difference between the RF/eucl distance to true tree of no partitioning vs with partitioning??#
# compare at each sample size, for each species, for both RF and euclidean distance#
#
spp <- c("myria", "lopho")#
samps <- c(10,20,40,80)#
stat.data.set.BIC <- data.frame(matrix(NA, ncol=14, nrow=8))#
names(stat.data.set.BIC) <- c("species", "samp.size", "rf_twoside_p", "rf_less_p", "rf_greater_p", "eucl_twoside_p", "eucl_less_p", "eucl_greater_p", "cons_rf_twoside_p", "cons_rf_less_p", "cons_rf_greater_p", "cons_eucl_twoside_p", "cons_eucl_less_p", "cons_eucl_greater_p")#
#
iterate <- 1#
for(j in spp){#
	for(k in samps){#
		temp.dat.no.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "noPart" , ]#
		temp.dat.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "BIC" , ]#
		rf_ts_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		rf_less_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		rf_greater_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		eucl_ts_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		eucl_less_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		eucl_greater_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
#
		# also for the consensus tree#
		cons_rf_ts_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		cons_rf_less_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		cons_rf_greater_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		cons_eucl_ts_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		cons_eucl_less_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		cons_eucl_greater_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
		stat.data.set.BIC[iterate, ] <- c(j, k, rf_ts_p, rf_less_p, rf_greater_p, eucl_ts_p, eucl_less_p, eucl_greater_p, cons_rf_ts_p, cons_rf_less_p, cons_rf_greater_p, cons_eucl_ts_p, cons_eucl_less_p, cons_eucl_greater_p)#
		iterate <- iterate + 1#
	}#
}#
## AIC STATS#
#
spp <- c("myria", "lopho")#
samps <- c(10,20,40,80)#
stat.data.set.AIC <- data.frame(matrix(NA, ncol=14, nrow=8))#
names(stat.data.set.AIC) <- c("species", "samp.size", "rf_twoside_p", "rf_less_p", "rf_greater_p", "eucl_twoside_p", "eucl_less_p", "eucl_greater_p", "cons_rf_twoside_p", "cons_rf_less_p", "cons_rf_greater_p", "cons_eucl_twoside_p", "cons_eucl_less_p", "cons_eucl_greater_p")#
#
iterate <- 1#
for(j in spp){#
	for(k in samps){#
		temp.dat.no.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "noPart" , ]#
		temp.dat.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "BIC" , ]#
		rf_ts_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		rf_less_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		rf_greater_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		eucl_ts_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		eucl_less_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		eucl_greater_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
#
		# also for the consensus tree#
		cons_rf_ts_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		cons_rf_less_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		cons_rf_greater_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		cons_eucl_ts_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		cons_eucl_less_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		cons_eucl_greater_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
		stat.data.set.AIC[iterate, ] <- c(j, k, rf_ts_p, rf_less_p, rf_greater_p, eucl_ts_p, eucl_less_p, eucl_greater_p, cons_rf_ts_p, cons_rf_less_p, cons_rf_greater_p, cons_eucl_ts_p, cons_eucl_less_p, cons_eucl_greater_p)#
		iterate <- iterate + 1#
	}#
}#
### AICc STATS#
#
spp <- c("myria", "lopho")#
samps <- c(10,20,40,80)#
stat.data.set.AICc <- data.frame(matrix(NA, ncol=14, nrow=8))#
names(stat.data.set.AICc) <- c("species", "samp.size", "rf_twoside_p", "rf_less_p", "rf_greater_p", "eucl_twoside_p", "eucl_less_p", "eucl_greater_p", "cons_rf_twoside_p", "cons_rf_less_p", "cons_rf_greater_p", "cons_eucl_twoside_p", "cons_eucl_less_p", "cons_eucl_greater_p")#
#
iterate <- 1#
for(j in spp){#
	for(k in samps){#
		temp.dat.no.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "noPart" , ]#
		temp.dat.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "BIC" , ]#
		rf_ts_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		rf_less_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		rf_greater_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		eucl_ts_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		eucl_less_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		eucl_greater_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
#
		# also for the consensus tree#
		cons_rf_ts_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		cons_rf_less_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		cons_rf_greater_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		cons_eucl_ts_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		cons_eucl_less_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		cons_eucl_greater_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
		stat.data.set.AICc[iterate, ] <- c(j, k, rf_ts_p, rf_less_p, rf_greater_p, eucl_ts_p, eucl_less_p, eucl_greater_p, cons_rf_ts_p, cons_rf_less_p, cons_rf_greater_p, cons_eucl_ts_p, cons_eucl_less_p, cons_eucl_greater_p)#
		iterate <- iterate + 1#
	}#
}#
#####################################
samp.size.col <- c("steelblue4", "darkorange2", "green4", "red3")#
outline.col <- "gray30"#
samp.sizes <- c(10,20,40,80)#
#####################################
ylim1 <- c(-0.155, 0.155)#
ylim2 <- c(-1.35, 1.35)#
ylim3 <- c(0.5,10)#
box.width <- 1#
line.type <- 1#
line.width <- 1.75#
ytext1 <- 0.13#
ytext2 <- 1.075#
p.height1 <- 0.15#
p.height2 <- 1.3#
criteria <- c("AIC", "BIC", "AICc")#
for(criterion in criteria){#
#
if(criteria == "AIC") stats.data.set <- stat.data.set.AIC#
if(criteria == "BIC") stats.data.set <- stat.data.set.BIC#
if(criteria == "AICc") stats.data.set <- stat.data.set.AICc#
part.crit <- criterion#
#
pdf(paste(c("Results_Plots/Boxplots_", part.crit, "_StatsParts.pdf"), collapse=""), width=6, height=10)#
##par(mfrow=c(3,1), mar=c(2.5,4.25,1.75,0.25))#
par(mar=c(2.5,4.25,1.75,0.25))#
layout(matrix(c(1,1,2,2,3), ncol=1))#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim1, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Robinson Fould distance", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext1, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext1, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
# add p values from 2-sided wilcoxon test#
text(x=c(0.5,1:4), y=rep(p.height1, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height1, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
legend("bottomright", c("10", "20", "40", "80"), pch=15, col=samp.size.col, title = "num. genes", cex=0.875, pt.cex=1.5) # , bg="white"#
# eucl distance#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim2, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Euclidean distance", mgp=c(3,0.9,0))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext2, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext2, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=c(0.5,1:4), y=rep(p.height2, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height2, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
# number partitions#
par(mar=c(2.5,4.25,0.25,0.25))#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim3, xlab="", xaxt="n", ylab="number partitions inferred", main="", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
# AND NOW USING CONSENSUS TREE DISTANCE INSTEAD#
#
par(mar=c(2.5,4.25,1.75,0.25))#
#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim1, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Robinson Fould distance", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext1, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext1, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="cons_rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
# add p values from 2-sided wilcoxon test#
text(x=c(0.5,1:4), y=rep(p.height1, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="cons_rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height1, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
legend("bottomright", c("10", "20", "40", "80"), pch=15, col=samp.size.col, title = "num. genes", cex=0.875, pt.cex=1.5) # , bg="white"#
# eucl distance#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim2, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Euclidean distance", mgp=c(3,0.9,0))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext2, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext2, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="cons_eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=c(0.5,1:4), y=rep(p.height2, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="cons_eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height2, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
#SAME # number partitions#
par(mar=c(2.5,4.25,0.25,0.25))#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim3, xlab="", xaxt="n", ylab="number partitions inferred", main="", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
dev.off()#
}
stat.data.set.BIC
stat.data.set.AIC
dat[c(3:20,22:25,28)][which(dat$replicate == "18" & dat$samp.size == "80" | dat$replicate == "20" & dat$samp.size == "80"),]
library(scales)#
setwd("~/Documents/UNIL/PartitioningMethods_SimulationProject/FunctioningPipeline/AnalysisResults")#
make.merge.id <- function(dat){#
	id.col <- rep(NA, dim(dat)[1])#
	for(i in 1:dim(dat)[1]){#
		if(length(grep("lopho", dat$file[i])) > 0) spp <- "lopho_"#
		if(length(grep("myria", dat$file[i])) > 0) spp <- "myria_"#
		if(length(grep("10", dat$file[i])) > 0) samp <- "10_"#
		if(length(grep("20", dat$file[i])) > 0) samp <- "20_"#
		if(length(grep("40", dat$file[i])) > 0) samp <- "40_"#
		if(length(grep("80", dat$file[i])) > 0) samp <- "80_"#
		if(length(grep("rcluster", dat$file[i])) > 0) algo <- "rcluster_"#
		if(length(grep("greedy", dat$file[i])) > 0) algo <- "greedy_"#
		if(length(grep("noPart", dat$file[i])) > 0) algo <- "noPart_"#
		if(length(grep("AIC", dat$file[i])) > 0) crit <- "AIC"#
		if(length(grep("AICc", dat$file[i])) > 0) crit <- "AICc"#
		if(length(grep("BIC", dat$file[i])) > 0) crit <- "BIC"#
		if(length(grep("noPart", dat$file[i])) > 0) crit <- "noPart"#
		id.col[i] <- paste(c(spp, samp, algo, crit), collapse="")#
	}#
	return(id.col)#
}#
#####################################
#
get.rep.difference <- function(dat, rep, samp.size, spp, partitioning.criterion, distance){#
	temp.dat <- dat[dat$replicate == rep & dat$samp.size == samp.size & dat$species == spp , ]#
	no.part.result <- temp.dat[temp.dat$search.algo == "noPart" ,]#
	rclust.AIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AIC" ,]#
	rclust.BIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "BIC" ,]#
	rclust.AICc.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AICc",]#
	if(partitioning.criterion == "AIC"){#
		if(dim(rclust.AIC.result[distance])[1] == 0 | dim(no.part.result[distance])[1] == 0){ difference <- NA}#
		else{ difference <- no.part.result[distance] - rclust.AIC.result[distance] }#
	}#
	if(partitioning.criterion == "BIC"){#
		if(dim(rclust.BIC.result[distance])[1] == 0 | dim(no.part.result[distance])[1] == 0){ difference <- NA}#
		else{ difference <- no.part.result[distance] - rclust.BIC.result[distance] }#
	}#
	if(partitioning.criterion == "AICc"){#
		if(dim(rclust.AICc.result[distance])[1] == 0 | dim(no.part.result[distance])[1] == 0){ difference <- NA}#
		else{ difference <- no.part.result[distance] - rclust.AICc.result[distance] }#
	}#
	return(as.numeric(difference))			#
}#
#
#####################################
#
get.boxplot.dat <- function(dat, samp.size, spp, partitioning.criterion, distance){	#
	samp.size.dists <- NULL#
	for(j in unique(dat$replicate)){#
		dist <- get.rep.difference(dat, rep=j, samp.size=samp.size, spp=spp, partitioning.criterion=partitioning.criterion, distance=distance)#
		samp.size.dists <- c(samp.size.dists, dist)#
	}#
	return(samp.size.dists)#
}#
#
#####################################
#
get.partition.dat <- function(dat, samp.size, spp, partitioning.criterion){	#
	partition.numbers <- NULL#
	for(j in unique(dat$replicate)){#
		temp.dat <- dat[dat$replicate == j & dat$samp.size == samp.size & dat$species == spp , ]#
		rclust.AIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AIC" ,]#
		rclust.BIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "BIC" ,]#
		rclust.AICc.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AICc",]#
		if(partitioning.criterion == "AIC"){#
			if(length(rclust.AIC.result$num.partitions)[1] == 0){ num.parts <- NA}#
			else{ num.parts <- rclust.AIC.result$num.partitions }#
		}#
		if(partitioning.criterion == "BIC"){#
			if(length(rclust.BIC.result$num.partitions)[1] == 0){ num.parts <- NA}#
			else{ num.parts <- rclust.BIC.result$num.partitions }#
		}#
		if(partitioning.criterion == "AICc"){#
			if(length(rclust.AICc.result$num.partitions)[1] == 0){ num.parts <- NA}#
			else{ num.parts <- rclust.AICc.result$num.partitions }#
		}#
		partition.numbers <- c(partition.numbers, num.parts)#
	}#
	return(partition.numbers)#
}#
#
#####################################
# mut rate 1000#
#
infiles.a <- c("AllStatsOutput_New_Rep1_100-1000.csv",#
				"AllStatsOutput_New_Rep2_100-1000.csv",#
				"AllStatsOutput_New_Rep3_100-1000.csv",#
				"AllStatsOutput_New_Rep4_100-1000.csv",#
				"AllStatsOutput_New_Rep5_100-1000.csv",#
				"AllStatsOutput_New_Rep6_100-1000.csv",#
				"AllStatsOutput_Newest_Rep7_100-1000.csv",#
				"AllStatsOutput_Newest_Rep8_100-1000.csv",#
				"AllStatsOutput_Newest_Rep9_100-1000.csv",#
				"AllStatsOutput_Newest_Rep10_100-1000.csv",#
				"AllStatsOutput_Newest_Rep11_100-1000.csv",#
				"AllStatsOutput_Newest_Rep12_100-1000.csv",#
				"AllStatsOutput_Newest_Rep13_100-1000.csv",#
				"AllStatsOutput_Newest_Rep14_100-1000.csv",#
				"AllStatsOutput_Newest_Rep15_100-1000.csv",#
				"AllStatsOutput_Newest_Rep16_100-1000.csv",#
				"AllStatsOutput_Newest_Rep17_100-1000.csv",#
				"AllStatsOutput_Newest_Rep18_100-1000.csv",#
				"AllStatsOutput_Newest_Rep19_100-1000.csv",#
				"AllStatsOutput_Newest_Rep20_100-1000.csv"#
				)#
infiles.b <- c("RF_Eucl_results_New_Rep1_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep2_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep3_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep4_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep5_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep6_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep7_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep8_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep9_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep10_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep11_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep12_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep13_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep14_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep15_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep16_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep17_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep18_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep19_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep20_100-1000_wConsensus.txt"#
				)#
#
dat <- NULL#
for(i in c(1:5,7:20)){#length(infiles.a)){ #**************UNCOMMENT ME FOR ALL REPS#
	temp.dat1 <- read.csv(infiles.a[i], header=TRUE, stringsAsFactors=FALSE)#
	temp.dat1$uniqueID <- paste(temp.dat1$species, temp.dat1$samp.size, temp.dat1$search.algo, temp.dat1$part.IC, sep="_")#
	temp.dat2 <- read.table(infiles.b[i], header=TRUE, stringsAsFactors=FALSE)#
	# because also have consenseus trees now:#
	temp.dat2 <- cbind(temp.dat2[1:32,], temp.dat2[33:64, 2:3])#
	names(temp.dat2) <- c("filename", "rf_dist", "eucl_dist", "cons_rf_dist", "cons_eucl_dist")#
	temp.dat2$uniqueID <- make.merge.id(temp.dat2)#
	temp.dat <- merge(temp.dat1, temp.dat2, by="uniqueID")#
	temp.dat$gene.size <- 100#
	temp.dat$mut.rate <- 1000#
	temp.dat$replicate <- i#
	dat <- rbind(dat, temp.dat)#
}#
#
no.part.dat <- dat[dat$part.IC == "noPart" ,]#
## IS there a statistically significant difference between the RF/eucl distance to true tree of no partitioning vs with partitioning??#
# compare at each sample size, for each species, for both RF and euclidean distance#
#
spp <- c("myria", "lopho")#
samps <- c(10,20,40,80)#
stat.data.set.BIC <- data.frame(matrix(NA, ncol=14, nrow=8))#
names(stat.data.set.BIC) <- c("species", "samp.size", "rf_twoside_p", "rf_less_p", "rf_greater_p", "eucl_twoside_p", "eucl_less_p", "eucl_greater_p", "cons_rf_twoside_p", "cons_rf_less_p", "cons_rf_greater_p", "cons_eucl_twoside_p", "cons_eucl_less_p", "cons_eucl_greater_p")#
#
iterate <- 1#
for(j in spp){#
	for(k in samps){#
		temp.dat.no.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "noPart" , ]#
		temp.dat.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "BIC" , ]#
		rf_ts_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		rf_less_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		rf_greater_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		eucl_ts_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		eucl_less_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		eucl_greater_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
#
		# also for the consensus tree#
		cons_rf_ts_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		cons_rf_less_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		cons_rf_greater_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		cons_eucl_ts_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		cons_eucl_less_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		cons_eucl_greater_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
		stat.data.set.BIC[iterate, ] <- c(j, k, rf_ts_p, rf_less_p, rf_greater_p, eucl_ts_p, eucl_less_p, eucl_greater_p, cons_rf_ts_p, cons_rf_less_p, cons_rf_greater_p, cons_eucl_ts_p, cons_eucl_less_p, cons_eucl_greater_p)#
		iterate <- iterate + 1#
	}#
}#
## AIC STATS#
#
spp <- c("myria", "lopho")#
samps <- c(10,20,40,80)#
stat.data.set.AIC <- data.frame(matrix(NA, ncol=14, nrow=8))#
names(stat.data.set.AIC) <- c("species", "samp.size", "rf_twoside_p", "rf_less_p", "rf_greater_p", "eucl_twoside_p", "eucl_less_p", "eucl_greater_p", "cons_rf_twoside_p", "cons_rf_less_p", "cons_rf_greater_p", "cons_eucl_twoside_p", "cons_eucl_less_p", "cons_eucl_greater_p")#
#
iterate <- 1#
for(j in spp){#
	for(k in samps){#
		temp.dat.no.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "noPart" , ]#
		temp.dat.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "AIC" , ]#
		rf_ts_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		rf_less_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		rf_greater_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		eucl_ts_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		eucl_less_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		eucl_greater_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
#
		# also for the consensus tree#
		cons_rf_ts_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		cons_rf_less_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		cons_rf_greater_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		cons_eucl_ts_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		cons_eucl_less_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		cons_eucl_greater_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
		stat.data.set.AIC[iterate, ] <- c(j, k, rf_ts_p, rf_less_p, rf_greater_p, eucl_ts_p, eucl_less_p, eucl_greater_p, cons_rf_ts_p, cons_rf_less_p, cons_rf_greater_p, cons_eucl_ts_p, cons_eucl_less_p, cons_eucl_greater_p)#
		iterate <- iterate + 1#
	}#
}#
### AICc STATS#
#
spp <- c("myria", "lopho")#
samps <- c(10,20,40,80)#
stat.data.set.AICc <- data.frame(matrix(NA, ncol=14, nrow=8))#
names(stat.data.set.AICc) <- c("species", "samp.size", "rf_twoside_p", "rf_less_p", "rf_greater_p", "eucl_twoside_p", "eucl_less_p", "eucl_greater_p", "cons_rf_twoside_p", "cons_rf_less_p", "cons_rf_greater_p", "cons_eucl_twoside_p", "cons_eucl_less_p", "cons_eucl_greater_p")#
#
iterate <- 1#
for(j in spp){#
	for(k in samps){#
		temp.dat.no.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "noPart" , ]#
		temp.dat.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "AICc" , ]#
		rf_ts_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		rf_less_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		rf_greater_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		eucl_ts_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		eucl_less_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		eucl_greater_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
#
		# also for the consensus tree#
		cons_rf_ts_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		cons_rf_less_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		cons_rf_greater_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		cons_eucl_ts_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		cons_eucl_less_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		cons_eucl_greater_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
		stat.data.set.AICc[iterate, ] <- c(j, k, rf_ts_p, rf_less_p, rf_greater_p, eucl_ts_p, eucl_less_p, eucl_greater_p, cons_rf_ts_p, cons_rf_less_p, cons_rf_greater_p, cons_eucl_ts_p, cons_eucl_less_p, cons_eucl_greater_p)#
		iterate <- iterate + 1#
	}#
}#
#####################################
samp.size.col <- c("steelblue4", "darkorange2", "green4", "red3")#
outline.col <- "gray30"#
samp.sizes <- c(10,20,40,80)#
#####################################
ylim1 <- c(-0.155, 0.155)#
ylim2 <- c(-1.35, 1.35)#
ylim3 <- c(0.5,10)#
box.width <- 1#
line.type <- 1#
line.width <- 1.75#
ytext1 <- 0.13#
ytext2 <- 1.075#
p.height1 <- 0.15#
p.height2 <- 1.3#
criteria <- c("AIC", "BIC", "AICc")#
for(criterion in criteria){#
#
if(criteria == "AIC") stats.data.set <- stat.data.set.AIC#
if(criteria == "BIC") stats.data.set <- stat.data.set.BIC#
if(criteria == "AICc") stats.data.set <- stat.data.set.AICc#
part.crit <- criterion#
#
pdf(paste(c("Results_Plots/Boxplots_", part.crit, "_StatsParts.pdf"), collapse=""), width=6, height=10)#
##par(mfrow=c(3,1), mar=c(2.5,4.25,1.75,0.25))#
par(mar=c(2.5,4.25,1.75,0.25))#
layout(matrix(c(1,1,2,2,3), ncol=1))#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim1, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Robinson Fould distance", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext1, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext1, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
# add p values from 2-sided wilcoxon test#
text(x=c(0.5,1:4), y=rep(p.height1, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height1, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
legend("bottomright", c("10", "20", "40", "80"), pch=15, col=samp.size.col, title = "num. genes", cex=0.875, pt.cex=1.5) # , bg="white"#
# eucl distance#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim2, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Euclidean distance", mgp=c(3,0.9,0))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext2, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext2, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=c(0.5,1:4), y=rep(p.height2, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height2, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
# number partitions#
par(mar=c(2.5,4.25,0.25,0.25))#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim3, xlab="", xaxt="n", ylab="number partitions inferred", main="", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
# AND NOW USING CONSENSUS TREE DISTANCE INSTEAD#
#
par(mar=c(2.5,4.25,1.75,0.25))#
#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim1, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Robinson Fould distance", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext1, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext1, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="cons_rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
# add p values from 2-sided wilcoxon test#
text(x=c(0.5,1:4), y=rep(p.height1, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="cons_rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height1, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
legend("bottomright", c("10", "20", "40", "80"), pch=15, col=samp.size.col, title = "num. genes", cex=0.875, pt.cex=1.5) # , bg="white"#
# eucl distance#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim2, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Euclidean distance", mgp=c(3,0.9,0))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext2, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext2, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="cons_eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=c(0.5,1:4), y=rep(p.height2, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="cons_eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height2, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
#SAME # number partitions#
par(mar=c(2.5,4.25,0.25,0.25))#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim3, xlab="", xaxt="n", ylab="number partitions inferred", main="", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
dev.off()#
}
dat[c(3:20,22:25,28)][which(dat$replicate == "18" & dat$samp.size == "80" | dat$replicate == "20" & dat$samp.size == "80"),]
library(scales)#
setwd("~/Documents/UNIL/PartitioningMethods_SimulationProject/FunctioningPipeline/AnalysisResults")#
make.merge.id <- function(dat){#
	id.col <- rep(NA, dim(dat)[1])#
	for(i in 1:dim(dat)[1]){#
		if(length(grep("lopho", dat$file[i])) > 0) spp <- "lopho_"#
		if(length(grep("myria", dat$file[i])) > 0) spp <- "myria_"#
		if(length(grep("10", dat$file[i])) > 0) samp <- "10_"#
		if(length(grep("20", dat$file[i])) > 0) samp <- "20_"#
		if(length(grep("40", dat$file[i])) > 0) samp <- "40_"#
		if(length(grep("80", dat$file[i])) > 0) samp <- "80_"#
		if(length(grep("rcluster", dat$file[i])) > 0) algo <- "rcluster_"#
		if(length(grep("greedy", dat$file[i])) > 0) algo <- "greedy_"#
		if(length(grep("noPart", dat$file[i])) > 0) algo <- "noPart_"#
		if(length(grep("AIC", dat$file[i])) > 0) crit <- "AIC"#
		if(length(grep("AICc", dat$file[i])) > 0) crit <- "AICc"#
		if(length(grep("BIC", dat$file[i])) > 0) crit <- "BIC"#
		if(length(grep("noPart", dat$file[i])) > 0) crit <- "noPart"#
		id.col[i] <- paste(c(spp, samp, algo, crit), collapse="")#
	}#
	return(id.col)#
}#
#####################################
#
get.rep.difference <- function(dat, rep, samp.size, spp, partitioning.criterion, distance){#
	temp.dat <- dat[dat$replicate == rep & dat$samp.size == samp.size & dat$species == spp , ]#
	no.part.result <- temp.dat[temp.dat$search.algo == "noPart" ,]#
	rclust.AIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AIC" ,]#
	rclust.BIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "BIC" ,]#
	rclust.AICc.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AICc",]#
	if(partitioning.criterion == "AIC"){#
		if(dim(rclust.AIC.result[distance])[1] == 0 | dim(no.part.result[distance])[1] == 0){ difference <- NA}#
		else{ difference <- no.part.result[distance] - rclust.AIC.result[distance] }#
	}#
	if(partitioning.criterion == "BIC"){#
		if(dim(rclust.BIC.result[distance])[1] == 0 | dim(no.part.result[distance])[1] == 0){ difference <- NA}#
		else{ difference <- no.part.result[distance] - rclust.BIC.result[distance] }#
	}#
	if(partitioning.criterion == "AICc"){#
		if(dim(rclust.AICc.result[distance])[1] == 0 | dim(no.part.result[distance])[1] == 0){ difference <- NA}#
		else{ difference <- no.part.result[distance] - rclust.AICc.result[distance] }#
	}#
	return(as.numeric(difference))			#
}#
#
#####################################
#
get.boxplot.dat <- function(dat, samp.size, spp, partitioning.criterion, distance){	#
	samp.size.dists <- NULL#
	for(j in unique(dat$replicate)){#
		dist <- get.rep.difference(dat, rep=j, samp.size=samp.size, spp=spp, partitioning.criterion=partitioning.criterion, distance=distance)#
		samp.size.dists <- c(samp.size.dists, dist)#
	}#
	return(samp.size.dists)#
}#
#
#####################################
#
get.partition.dat <- function(dat, samp.size, spp, partitioning.criterion){	#
	partition.numbers <- NULL#
	for(j in unique(dat$replicate)){#
		temp.dat <- dat[dat$replicate == j & dat$samp.size == samp.size & dat$species == spp , ]#
		rclust.AIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AIC" ,]#
		rclust.BIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "BIC" ,]#
		rclust.AICc.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AICc",]#
		if(partitioning.criterion == "AIC"){#
			if(length(rclust.AIC.result$num.partitions)[1] == 0){ num.parts <- NA}#
			else{ num.parts <- rclust.AIC.result$num.partitions }#
		}#
		if(partitioning.criterion == "BIC"){#
			if(length(rclust.BIC.result$num.partitions)[1] == 0){ num.parts <- NA}#
			else{ num.parts <- rclust.BIC.result$num.partitions }#
		}#
		if(partitioning.criterion == "AICc"){#
			if(length(rclust.AICc.result$num.partitions)[1] == 0){ num.parts <- NA}#
			else{ num.parts <- rclust.AICc.result$num.partitions }#
		}#
		partition.numbers <- c(partition.numbers, num.parts)#
	}#
	return(partition.numbers)#
}#
#
#####################################
# mut rate 1000#
#
infiles.a <- c("AllStatsOutput_New_Rep1_100-1000.csv",#
				"AllStatsOutput_New_Rep2_100-1000.csv",#
				"AllStatsOutput_New_Rep3_100-1000.csv",#
				"AllStatsOutput_New_Rep4_100-1000.csv",#
				"AllStatsOutput_New_Rep5_100-1000.csv",#
				"AllStatsOutput_New_Rep6_100-1000.csv",#
				"AllStatsOutput_Newest_Rep7_100-1000.csv",#
				"AllStatsOutput_Newest_Rep8_100-1000.csv",#
				"AllStatsOutput_Newest_Rep9_100-1000.csv",#
				"AllStatsOutput_Newest_Rep10_100-1000.csv",#
				"AllStatsOutput_Newest_Rep11_100-1000.csv",#
				"AllStatsOutput_Newest_Rep12_100-1000.csv",#
				"AllStatsOutput_Newest_Rep13_100-1000.csv",#
				"AllStatsOutput_Newest_Rep14_100-1000.csv",#
				"AllStatsOutput_Newest_Rep15_100-1000.csv",#
				"AllStatsOutput_Newest_Rep16_100-1000.csv",#
				"AllStatsOutput_Newest_Rep17_100-1000.csv",#
				"AllStatsOutput_Newest_Rep18_100-1000.csv",#
				"AllStatsOutput_Newest_Rep19_100-1000.csv",#
				"AllStatsOutput_Newest_Rep20_100-1000.csv"#
				)#
infiles.b <- c("RF_Eucl_results_New_Rep1_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep2_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep3_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep4_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep5_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep6_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep7_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep8_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep9_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep10_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep11_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep12_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep13_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep14_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep15_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep16_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep17_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep18_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep19_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep20_100-1000_wConsensus.txt"#
				)#
#
dat <- NULL#
for(i in c(1:5,7:20)){#length(infiles.a)){ #**************UNCOMMENT ME FOR ALL REPS#
	temp.dat1 <- read.csv(infiles.a[i], header=TRUE, stringsAsFactors=FALSE)#
	temp.dat1$uniqueID <- paste(temp.dat1$species, temp.dat1$samp.size, temp.dat1$search.algo, temp.dat1$part.IC, sep="_")#
	temp.dat2 <- read.table(infiles.b[i], header=TRUE, stringsAsFactors=FALSE)#
	# because also have consenseus trees now:#
	temp.dat2 <- cbind(temp.dat2[1:32,], temp.dat2[33:64, 2:3])#
	names(temp.dat2) <- c("filename", "rf_dist", "eucl_dist", "cons_rf_dist", "cons_eucl_dist")#
	temp.dat2$uniqueID <- make.merge.id(temp.dat2)#
	temp.dat <- merge(temp.dat1, temp.dat2, by="uniqueID")#
	temp.dat$gene.size <- 100#
	temp.dat$mut.rate <- 1000#
	temp.dat$replicate <- i#
	dat <- rbind(dat, temp.dat)#
}#
#
no.part.dat <- dat[dat$part.IC == "noPart" ,]#
## IS there a statistically significant difference between the RF/eucl distance to true tree of no partitioning vs with partitioning??#
# compare at each sample size, for each species, for both RF and euclidean distance#
#
spp <- c("myria", "lopho")#
samps <- c(10,20,40,80)#
stat.data.set.BIC <- data.frame(matrix(NA, ncol=14, nrow=8))#
names(stat.data.set.BIC) <- c("species", "samp.size", "rf_twoside_p", "rf_less_p", "rf_greater_p", "eucl_twoside_p", "eucl_less_p", "eucl_greater_p", "cons_rf_twoside_p", "cons_rf_less_p", "cons_rf_greater_p", "cons_eucl_twoside_p", "cons_eucl_less_p", "cons_eucl_greater_p")#
#
iterate <- 1#
for(j in spp){#
	for(k in samps){#
		temp.dat.no.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "noPart" , ]#
		temp.dat.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "BIC" , ]#
		rf_ts_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		rf_less_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		rf_greater_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		eucl_ts_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		eucl_less_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		eucl_greater_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
#
		# also for the consensus tree#
		cons_rf_ts_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		cons_rf_less_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		cons_rf_greater_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		cons_eucl_ts_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		cons_eucl_less_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		cons_eucl_greater_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
		stat.data.set.BIC[iterate, ] <- c(j, k, rf_ts_p, rf_less_p, rf_greater_p, eucl_ts_p, eucl_less_p, eucl_greater_p, cons_rf_ts_p, cons_rf_less_p, cons_rf_greater_p, cons_eucl_ts_p, cons_eucl_less_p, cons_eucl_greater_p)#
		iterate <- iterate + 1#
	}#
}#
## AIC STATS#
#
spp <- c("myria", "lopho")#
samps <- c(10,20,40,80)#
stat.data.set.AIC <- data.frame(matrix(NA, ncol=14, nrow=8))#
names(stat.data.set.AIC) <- c("species", "samp.size", "rf_twoside_p", "rf_less_p", "rf_greater_p", "eucl_twoside_p", "eucl_less_p", "eucl_greater_p", "cons_rf_twoside_p", "cons_rf_less_p", "cons_rf_greater_p", "cons_eucl_twoside_p", "cons_eucl_less_p", "cons_eucl_greater_p")#
#
iterate <- 1#
for(j in spp){#
	for(k in samps){#
		temp.dat.no.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "noPart" , ]#
		temp.dat.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "AIC" , ]#
		rf_ts_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		rf_less_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		rf_greater_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		eucl_ts_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		eucl_less_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		eucl_greater_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
#
		# also for the consensus tree#
		cons_rf_ts_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		cons_rf_less_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		cons_rf_greater_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		cons_eucl_ts_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		cons_eucl_less_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		cons_eucl_greater_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
		stat.data.set.AIC[iterate, ] <- c(j, k, rf_ts_p, rf_less_p, rf_greater_p, eucl_ts_p, eucl_less_p, eucl_greater_p, cons_rf_ts_p, cons_rf_less_p, cons_rf_greater_p, cons_eucl_ts_p, cons_eucl_less_p, cons_eucl_greater_p)#
		iterate <- iterate + 1#
	}#
}#
### AICc STATS#
#
spp <- c("myria", "lopho")#
samps <- c(10,20,40,80)#
stat.data.set.AICc <- data.frame(matrix(NA, ncol=14, nrow=8))#
names(stat.data.set.AICc) <- c("species", "samp.size", "rf_twoside_p", "rf_less_p", "rf_greater_p", "eucl_twoside_p", "eucl_less_p", "eucl_greater_p", "cons_rf_twoside_p", "cons_rf_less_p", "cons_rf_greater_p", "cons_eucl_twoside_p", "cons_eucl_less_p", "cons_eucl_greater_p")#
#
iterate <- 1#
for(j in spp){#
	for(k in samps){#
		temp.dat.no.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "noPart" , ]#
		temp.dat.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "AICc" , ]#
		rf_ts_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		rf_less_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		rf_greater_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		eucl_ts_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		eucl_less_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		eucl_greater_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
#
		# also for the consensus tree#
		cons_rf_ts_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		cons_rf_less_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		cons_rf_greater_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		cons_eucl_ts_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		cons_eucl_less_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		cons_eucl_greater_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
		stat.data.set.AICc[iterate, ] <- c(j, k, rf_ts_p, rf_less_p, rf_greater_p, eucl_ts_p, eucl_less_p, eucl_greater_p, cons_rf_ts_p, cons_rf_less_p, cons_rf_greater_p, cons_eucl_ts_p, cons_eucl_less_p, cons_eucl_greater_p)#
		iterate <- iterate + 1#
	}#
}#
#####################################
samp.size.col <- c("steelblue4", "darkorange2", "green4", "red3")#
outline.col <- "gray30"#
samp.sizes <- c(10,20,40,80)#
#####################################
ylim1 <- c(-0.155, 0.155)#
ylim2 <- c(-1.35, 1.35)#
ylim3 <- c(0.5,10)#
box.width <- 1#
line.type <- 1#
line.width <- 1.75#
ytext1 <- 0.13#
ytext2 <- 1.075#
p.height1 <- 0.15#
p.height2 <- 1.3#
criteria <- c("AIC", "BIC", "AICc")#
for(criterion in criteria){#
#
if(criterion == "AIC") stat.data.set <- stat.data.set.AIC#
if(criterion == "BIC") stat.data.set <- stat.data.set.BIC#
if(criterion == "AICc") stat.data.set <- stat.data.set.AICc#
part.crit <- criterion#
#
pdf(paste(c("Results_Plots/Boxplots_", part.crit, "_StatsParts.pdf"), collapse=""), width=6, height=10)#
##par(mfrow=c(3,1), mar=c(2.5,4.25,1.75,0.25))#
par(mar=c(2.5,4.25,1.75,0.25))#
layout(matrix(c(1,1,2,2,3), ncol=1))#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim1, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Robinson Fould distance", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext1, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext1, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
# add p values from 2-sided wilcoxon test#
text(x=c(0.5,1:4), y=rep(p.height1, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height1, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
legend("bottomright", c("10", "20", "40", "80"), pch=15, col=samp.size.col, title = "num. genes", cex=0.875, pt.cex=1.5) # , bg="white"#
# eucl distance#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim2, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Euclidean distance", mgp=c(3,0.9,0))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext2, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext2, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=c(0.5,1:4), y=rep(p.height2, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height2, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
# number partitions#
par(mar=c(2.5,4.25,0.25,0.25))#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim3, xlab="", xaxt="n", ylab="number partitions inferred", main="", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
# AND NOW USING CONSENSUS TREE DISTANCE INSTEAD#
#
par(mar=c(2.5,4.25,1.75,0.25))#
#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim1, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Robinson Fould distance", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext1, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext1, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="cons_rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
# add p values from 2-sided wilcoxon test#
text(x=c(0.5,1:4), y=rep(p.height1, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="cons_rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height1, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
legend("bottomright", c("10", "20", "40", "80"), pch=15, col=samp.size.col, title = "num. genes", cex=0.875, pt.cex=1.5) # , bg="white"#
# eucl distance#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim2, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Euclidean distance", mgp=c(3,0.9,0))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext2, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext2, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="cons_eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=c(0.5,1:4), y=rep(p.height2, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="cons_eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height2, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
#SAME # number partitions#
par(mar=c(2.5,4.25,0.25,0.25))#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim3, xlab="", xaxt="n", ylab="number partitions inferred", main="", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
dev.off()#
}
dat[c(3:20,22:25,28)][which(dat$replicate == "18" & dat$samp.size == "80" | dat$replicate == "20" & dat$samp.size == "80"),]
criteria <- c("AIC"
)
criterion
criterion <- "AIC"
if(criterion == "AIC") stat.data.set <- stat.data.set.AIC
part.crit <- criterion
pdf(paste(c("Results_Plots/Boxplots_", part.crit, "_StatsParts.pdf"), collapse=""), width=6, height=10)#
##par(mfrow=c(3,1), mar=c(2.5,4.25,1.75,0.25))#
par(mar=c(2.5,4.25,1.75,0.25))#
layout(matrix(c(1,1,2,2,3), ncol=1))
plot(0, type="n", xlim=c(0.5,9), ylim=ylim1, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Robinson Fould distance", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext1, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext1, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
# add p values from 2-sided wilcoxon test#
text(x=c(0.5,1:4), y=rep(p.height1, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height1, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
legend("bottomright", c("10", "20", "40", "80"), pch=15, col=samp.size.col, title = "num. genes", cex=0.875, pt.cex=1.5) # , bg="white"
# eucl distance#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim2, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Euclidean distance", mgp=c(3,0.9,0))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext2, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext2, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=c(0.5,1:4), y=rep(p.height2, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height2, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))
# number partitions#
par(mar=c(2.5,4.25,0.25,0.25))#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim3, xlab="", xaxt="n", ylab="number partitions inferred", main="", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}
# AND NOW USING CONSENSUS TREE DISTANCE INSTEAD#
#
par(mar=c(2.5,4.25,1.75,0.25))#
#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim1, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Robinson Fould distance", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext1, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext1, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="cons_rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
# add p values from 2-sided wilcoxon test#
text(x=c(0.5,1:4), y=rep(p.height1, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="cons_rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height1, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
legend("bottomright", c("10", "20", "40", "80"), pch=15, col=samp.size.col, title = "num. genes", cex=0.875, pt.cex=1.5) # , bg="white"
# eucl distance#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim2, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Euclidean distance", mgp=c(3,0.9,0))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext2, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext2, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="cons_eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=c(0.5,1:4), y=rep(p.height2, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="cons_eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height2, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))
#SAME # number partitions#
par(mar=c(2.5,4.25,0.25,0.25))#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim3, xlab="", xaxt="n", ylab="number partitions inferred", main="", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
dev.off()
dat[c(3:20,22:25,28)][which(dat$replicate == "18" & dat$samp.size == "80" | dat$replicate == "20" & dat$samp.size == "80"),]
library(scales)#
setwd("~/Documents/UNIL/PartitioningMethods_SimulationProject/FunctioningPipeline/AnalysisResults")#
make.merge.id <- function(dat){#
	id.col <- rep(NA, dim(dat)[1])#
	for(i in 1:dim(dat)[1]){#
		if(length(grep("lopho", dat$file[i])) > 0) spp <- "lopho_"#
		if(length(grep("myria", dat$file[i])) > 0) spp <- "myria_"#
		if(length(grep("10", dat$file[i])) > 0) samp <- "10_"#
		if(length(grep("20", dat$file[i])) > 0) samp <- "20_"#
		if(length(grep("40", dat$file[i])) > 0) samp <- "40_"#
		if(length(grep("80", dat$file[i])) > 0) samp <- "80_"#
		if(length(grep("rcluster", dat$file[i])) > 0) algo <- "rcluster_"#
		if(length(grep("greedy", dat$file[i])) > 0) algo <- "greedy_"#
		if(length(grep("noPart", dat$file[i])) > 0) algo <- "noPart_"#
		if(length(grep("AIC", dat$file[i])) > 0) crit <- "AIC"#
		if(length(grep("AICc", dat$file[i])) > 0) crit <- "AICc"#
		if(length(grep("BIC", dat$file[i])) > 0) crit <- "BIC"#
		if(length(grep("noPart", dat$file[i])) > 0) crit <- "noPart"#
		id.col[i] <- paste(c(spp, samp, algo, crit), collapse="")#
	}#
	return(id.col)#
}#
#####################################
#
get.rep.difference <- function(dat, rep, samp.size, spp, partitioning.criterion, distance){#
	temp.dat <- dat[dat$replicate == rep & dat$samp.size == samp.size & dat$species == spp , ]#
	no.part.result <- temp.dat[temp.dat$search.algo == "noPart" ,]#
	rclust.AIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AIC" ,]#
	rclust.BIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "BIC" ,]#
	rclust.AICc.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AICc",]#
	if(partitioning.criterion == "AIC"){#
		if(dim(rclust.AIC.result[distance])[1] == 0 | dim(no.part.result[distance])[1] == 0){ difference <- NA}#
		else{ difference <- no.part.result[distance] - rclust.AIC.result[distance] }#
	}#
	if(partitioning.criterion == "BIC"){#
		if(dim(rclust.BIC.result[distance])[1] == 0 | dim(no.part.result[distance])[1] == 0){ difference <- NA}#
		else{ difference <- no.part.result[distance] - rclust.BIC.result[distance] }#
	}#
	if(partitioning.criterion == "AICc"){#
		if(dim(rclust.AICc.result[distance])[1] == 0 | dim(no.part.result[distance])[1] == 0){ difference <- NA}#
		else{ difference <- no.part.result[distance] - rclust.AICc.result[distance] }#
	}#
	return(as.numeric(difference))			#
}#
#
#####################################
#
get.boxplot.dat <- function(dat, samp.size, spp, partitioning.criterion, distance){	#
	samp.size.dists <- NULL#
	for(j in unique(dat$replicate)){#
		dist <- get.rep.difference(dat, rep=j, samp.size=samp.size, spp=spp, partitioning.criterion=partitioning.criterion, distance=distance)#
		samp.size.dists <- c(samp.size.dists, dist)#
	}#
	return(samp.size.dists)#
}#
#
#####################################
#
get.partition.dat <- function(dat, samp.size, spp, partitioning.criterion){	#
	partition.numbers <- NULL#
	for(j in unique(dat$replicate)){#
		temp.dat <- dat[dat$replicate == j & dat$samp.size == samp.size & dat$species == spp , ]#
		rclust.AIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AIC" ,]#
		rclust.BIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "BIC" ,]#
		rclust.AICc.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AICc",]#
		if(partitioning.criterion == "AIC"){#
			if(length(rclust.AIC.result$num.partitions)[1] == 0){ num.parts <- NA}#
			else{ num.parts <- rclust.AIC.result$num.partitions }#
		}#
		if(partitioning.criterion == "BIC"){#
			if(length(rclust.BIC.result$num.partitions)[1] == 0){ num.parts <- NA}#
			else{ num.parts <- rclust.BIC.result$num.partitions }#
		}#
		if(partitioning.criterion == "AICc"){#
			if(length(rclust.AICc.result$num.partitions)[1] == 0){ num.parts <- NA}#
			else{ num.parts <- rclust.AICc.result$num.partitions }#
		}#
		partition.numbers <- c(partition.numbers, num.parts)#
	}#
	return(partition.numbers)#
}#
#
#####################################
# mut rate 1000#
#
infiles.a <- c("AllStatsOutput_New_Rep1_100-1000.csv",#
				"AllStatsOutput_New_Rep2_100-1000.csv",#
				"AllStatsOutput_New_Rep3_100-1000.csv",#
				"AllStatsOutput_New_Rep4_100-1000.csv",#
				"AllStatsOutput_New_Rep5_100-1000.csv",#
				"AllStatsOutput_New_Rep6_100-1000.csv",#
				"AllStatsOutput_Newest_Rep7_100-1000.csv",#
				"AllStatsOutput_Newest_Rep8_100-1000.csv",#
				"AllStatsOutput_Newest_Rep9_100-1000.csv",#
				"AllStatsOutput_Newest_Rep10_100-1000.csv",#
				"AllStatsOutput_Newest_Rep11_100-1000.csv",#
				"AllStatsOutput_Newest_Rep12_100-1000.csv",#
				"AllStatsOutput_Newest_Rep13_100-1000.csv",#
				"AllStatsOutput_Newest_Rep14_100-1000.csv",#
				"AllStatsOutput_Newest_Rep15_100-1000.csv",#
				"AllStatsOutput_Newest_Rep16_100-1000.csv",#
				"AllStatsOutput_Newest_Rep17_100-1000.csv",#
				"AllStatsOutput_Newest_Rep18_100-1000.csv",#
				"AllStatsOutput_Newest_Rep19_100-1000.csv",#
				"AllStatsOutput_Newest_Rep20_100-1000.csv"#
				)#
infiles.b <- c("RF_Eucl_results_New_Rep1_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep2_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep3_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep4_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep5_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep6_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep7_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep8_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep9_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep10_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep11_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep12_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep13_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep14_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep15_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep16_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep17_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep18_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep19_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep20_100-1000_wConsensus.txt"#
				)#
#
dat <- NULL#
for(i in c(1:5,7:20)){#length(infiles.a)){ #**************UNCOMMENT ME FOR ALL REPS#
	temp.dat1 <- read.csv(infiles.a[i], header=TRUE, stringsAsFactors=FALSE)#
	temp.dat1$uniqueID <- paste(temp.dat1$species, temp.dat1$samp.size, temp.dat1$search.algo, temp.dat1$part.IC, sep="_")#
	temp.dat2 <- read.table(infiles.b[i], header=TRUE, stringsAsFactors=FALSE)#
	# because also have consenseus trees now:#
	temp.dat2 <- cbind(temp.dat2[1:32,], temp.dat2[33:64, 2:3])#
	names(temp.dat2) <- c("filename", "rf_dist", "eucl_dist", "cons_rf_dist", "cons_eucl_dist")#
	temp.dat2$uniqueID <- make.merge.id(temp.dat2)#
	temp.dat <- merge(temp.dat1, temp.dat2, by="uniqueID")#
	temp.dat$gene.size <- 100#
	temp.dat$mut.rate <- 1000#
	temp.dat$replicate <- i#
	dat <- rbind(dat, temp.dat)#
}#
#
no.part.dat <- dat[dat$part.IC == "noPart" ,]#
## IS there a statistically significant difference between the RF/eucl distance to true tree of no partitioning vs with partitioning??#
# compare at each sample size, for each species, for both RF and euclidean distance#
#
spp <- c("myria", "lopho")#
samps <- c(10,20,40,80)#
stat.data.set.BIC <- data.frame(matrix(NA, ncol=14, nrow=8))#
names(stat.data.set.BIC) <- c("species", "samp.size", "rf_twoside_p", "rf_less_p", "rf_greater_p", "eucl_twoside_p", "eucl_less_p", "eucl_greater_p", "cons_rf_twoside_p", "cons_rf_less_p", "cons_rf_greater_p", "cons_eucl_twoside_p", "cons_eucl_less_p", "cons_eucl_greater_p")#
#
iterate <- 1#
for(j in spp){#
	for(k in samps){#
		temp.dat.no.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "noPart" , ]#
		temp.dat.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "BIC" , ]#
		rf_ts_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		rf_less_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		rf_greater_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		eucl_ts_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		eucl_less_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		eucl_greater_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
#
		# also for the consensus tree#
		cons_rf_ts_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		cons_rf_less_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		cons_rf_greater_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		cons_eucl_ts_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		cons_eucl_less_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		cons_eucl_greater_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
		stat.data.set.BIC[iterate, ] <- c(j, k, rf_ts_p, rf_less_p, rf_greater_p, eucl_ts_p, eucl_less_p, eucl_greater_p, cons_rf_ts_p, cons_rf_less_p, cons_rf_greater_p, cons_eucl_ts_p, cons_eucl_less_p, cons_eucl_greater_p)#
		iterate <- iterate + 1#
	}#
}#
## AIC STATS#
#
spp <- c("myria", "lopho")#
samps <- c(10,20,40,80)#
stat.data.set.AIC <- data.frame(matrix(NA, ncol=14, nrow=8))#
names(stat.data.set.AIC) <- c("species", "samp.size", "rf_twoside_p", "rf_less_p", "rf_greater_p", "eucl_twoside_p", "eucl_less_p", "eucl_greater_p", "cons_rf_twoside_p", "cons_rf_less_p", "cons_rf_greater_p", "cons_eucl_twoside_p", "cons_eucl_less_p", "cons_eucl_greater_p")#
#
iterate <- 1#
for(j in spp){#
	for(k in samps){#
		temp.dat.no.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "noPart" , ]#
		temp.dat.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "AIC" , ]#
		rf_ts_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		rf_less_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		rf_greater_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		eucl_ts_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		eucl_less_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		eucl_greater_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
#
		# also for the consensus tree#
		cons_rf_ts_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		cons_rf_less_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		cons_rf_greater_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		cons_eucl_ts_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		cons_eucl_less_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		cons_eucl_greater_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
		stat.data.set.AIC[iterate, ] <- c(j, k, rf_ts_p, rf_less_p, rf_greater_p, eucl_ts_p, eucl_less_p, eucl_greater_p, cons_rf_ts_p, cons_rf_less_p, cons_rf_greater_p, cons_eucl_ts_p, cons_eucl_less_p, cons_eucl_greater_p)#
		iterate <- iterate + 1#
	}#
}#
### AICc STATS#
#
spp <- c("myria", "lopho")#
samps <- c(10,20,40,80)#
stat.data.set.AICc <- data.frame(matrix(NA, ncol=14, nrow=8))#
names(stat.data.set.AICc) <- c("species", "samp.size", "rf_twoside_p", "rf_less_p", "rf_greater_p", "eucl_twoside_p", "eucl_less_p", "eucl_greater_p", "cons_rf_twoside_p", "cons_rf_less_p", "cons_rf_greater_p", "cons_eucl_twoside_p", "cons_eucl_less_p", "cons_eucl_greater_p")#
#
iterate <- 1#
for(j in spp){#
	for(k in samps){#
		temp.dat.no.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "noPart" , ]#
		temp.dat.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "AICc" , ]#
		rf_ts_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		rf_less_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		rf_greater_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		eucl_ts_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		eucl_less_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		eucl_greater_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
#
		# also for the consensus tree#
		cons_rf_ts_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		cons_rf_less_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		cons_rf_greater_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		cons_eucl_ts_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		cons_eucl_less_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		cons_eucl_greater_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
		stat.data.set.AICc[iterate, ] <- c(j, k, rf_ts_p, rf_less_p, rf_greater_p, eucl_ts_p, eucl_less_p, eucl_greater_p, cons_rf_ts_p, cons_rf_less_p, cons_rf_greater_p, cons_eucl_ts_p, cons_eucl_less_p, cons_eucl_greater_p)#
		iterate <- iterate + 1#
	}#
}#
#####################################
samp.size.col <- c("steelblue4", "darkorange2", "green4", "red3")#
outline.col <- "gray30"#
samp.sizes <- c(10,20,40,80)#
#####################################
ylim1 <- c(-0.155, 0.155)#
ylim2 <- c(-1.35, 1.35)#
ylim3 <- c(0.5,10)#
box.width <- 1#
line.type <- 1#
line.width <- 1.75#
ytext1 <- 0.13#
ytext2 <- 1.075#
p.height1 <- 0.15#
p.height2 <- 1.3#
criteria <- c("AIC", "BIC", "AICc")#
for(criterion in criteria){#
#
if(criterion == "AIC") stat.data.set <- stat.data.set.AIC#
if(criterion == "BIC") stat.data.set <- stat.data.set.BIC#
if(criterion == "AICc") stat.data.set <- stat.data.set.AICc#
part.crit <- criterion#
#
pdf(paste(c("Results_Plots/Boxplots_", part.crit, "_StatsParts.pdf"), collapse=""), width=6, height=10)#
##par(mfrow=c(3,1), mar=c(2.5,4.25,1.75,0.25))#
par(mar=c(2.5,4.25,1.75,0.25))#
layout(matrix(c(1,1,2,2,3), ncol=1))#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim1, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Robinson Fould distance", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext1, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext1, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
# add p values from 2-sided wilcoxon test#
text(x=c(0.5,1:4), y=rep(p.height1, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height1, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
legend("bottomright", c("10", "20", "40", "80"), pch=15, col=samp.size.col, title = "num. genes", cex=0.875, pt.cex=1.5) # , bg="white"#
# eucl distance#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim2, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Euclidean distance", mgp=c(3,0.9,0))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext2, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext2, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=c(0.5,1:4), y=rep(p.height2, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height2, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
# number partitions#
par(mar=c(2.5,4.25,0.25,0.25))#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim3, xlab="", xaxt="n", ylab="number partitions inferred", main="", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
# AND NOW USING CONSENSUS TREE DISTANCE INSTEAD#
#
par(mar=c(2.5,4.25,1.75,0.25))#
#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim1, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Robinson Fould distance", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext1, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext1, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="cons_rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
# add p values from 2-sided wilcoxon test#
text(x=c(0.5,1:4), y=rep(p.height1, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="cons_rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height1, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
legend("bottomright", c("10", "20", "40", "80"), pch=15, col=samp.size.col, title = "num. genes", cex=0.875, pt.cex=1.5) # , bg="white"#
# eucl distance#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim2, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Euclidean distance", mgp=c(3,0.9,0))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext2, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext2, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="cons_eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=c(0.5,1:4), y=rep(p.height2, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="cons_eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height2, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
#SAME # number partitions#
par(mar=c(2.5,4.25,0.25,0.25))#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim3, xlab="", xaxt="n", ylab="number partitions inferred", main="", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
dev.off()#
}
library(scales)#
setwd("~/Documents/UNIL/PartitioningMethods_SimulationProject/FunctioningPipeline/AnalysisResults")#
make.merge.id <- function(dat){#
	id.col <- rep(NA, dim(dat)[1])#
	for(i in 1:dim(dat)[1]){#
		if(length(grep("lopho", dat$file[i])) > 0) spp <- "lopho_"#
		if(length(grep("myria", dat$file[i])) > 0) spp <- "myria_"#
		if(length(grep("10", dat$file[i])) > 0) samp <- "10_"#
		if(length(grep("20", dat$file[i])) > 0) samp <- "20_"#
		if(length(grep("40", dat$file[i])) > 0) samp <- "40_"#
		if(length(grep("80", dat$file[i])) > 0) samp <- "80_"#
		if(length(grep("rcluster", dat$file[i])) > 0) algo <- "rcluster_"#
		if(length(grep("greedy", dat$file[i])) > 0) algo <- "greedy_"#
		if(length(grep("noPart", dat$file[i])) > 0) algo <- "noPart_"#
		if(length(grep("AIC", dat$file[i])) > 0) crit <- "AIC"#
		if(length(grep("AICc", dat$file[i])) > 0) crit <- "AICc"#
		if(length(grep("BIC", dat$file[i])) > 0) crit <- "BIC"#
		if(length(grep("noPart", dat$file[i])) > 0) crit <- "noPart"#
		id.col[i] <- paste(c(spp, samp, algo, crit), collapse="")#
	}#
	return(id.col)#
}#
#####################################
#
get.rep.difference <- function(dat, rep, samp.size, spp, partitioning.criterion, distance){#
	temp.dat <- dat[dat$replicate == rep & dat$samp.size == samp.size & dat$species == spp , ]#
	no.part.result <- temp.dat[temp.dat$search.algo == "noPart" ,]#
	rclust.AIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AIC" ,]#
	rclust.BIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "BIC" ,]#
	rclust.AICc.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AICc",]#
	if(partitioning.criterion == "AIC"){#
		if(dim(rclust.AIC.result[distance])[1] == 0 | dim(no.part.result[distance])[1] == 0){ difference <- NA}#
		else{ difference <- no.part.result[distance] - rclust.AIC.result[distance] }#
	}#
	if(partitioning.criterion == "BIC"){#
		if(dim(rclust.BIC.result[distance])[1] == 0 | dim(no.part.result[distance])[1] == 0){ difference <- NA}#
		else{ difference <- no.part.result[distance] - rclust.BIC.result[distance] }#
	}#
	if(partitioning.criterion == "AICc"){#
		if(dim(rclust.AICc.result[distance])[1] == 0 | dim(no.part.result[distance])[1] == 0){ difference <- NA}#
		else{ difference <- no.part.result[distance] - rclust.AICc.result[distance] }#
	}#
	return(as.numeric(difference))			#
}#
#
#####################################
#
get.boxplot.dat <- function(dat, samp.size, spp, partitioning.criterion, distance){	#
	samp.size.dists <- NULL#
	for(j in unique(dat$replicate)){#
		dist <- get.rep.difference(dat, rep=j, samp.size=samp.size, spp=spp, partitioning.criterion=partitioning.criterion, distance=distance)#
		samp.size.dists <- c(samp.size.dists, dist)#
	}#
	return(samp.size.dists)#
}#
#
#####################################
#
get.partition.dat <- function(dat, samp.size, spp, partitioning.criterion){	#
	partition.numbers <- NULL#
	for(j in unique(dat$replicate)){#
		temp.dat <- dat[dat$replicate == j & dat$samp.size == samp.size & dat$species == spp , ]#
		rclust.AIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AIC" ,]#
		rclust.BIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "BIC" ,]#
		rclust.AICc.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AICc",]#
		if(partitioning.criterion == "AIC"){#
			if(length(rclust.AIC.result$num.partitions)[1] == 0){ num.parts <- NA}#
			else{ num.parts <- rclust.AIC.result$num.partitions }#
		}#
		if(partitioning.criterion == "BIC"){#
			if(length(rclust.BIC.result$num.partitions)[1] == 0){ num.parts <- NA}#
			else{ num.parts <- rclust.BIC.result$num.partitions }#
		}#
		if(partitioning.criterion == "AICc"){#
			if(length(rclust.AICc.result$num.partitions)[1] == 0){ num.parts <- NA}#
			else{ num.parts <- rclust.AICc.result$num.partitions }#
		}#
		partition.numbers <- c(partition.numbers, num.parts)#
	}#
	return(partition.numbers)#
}#
#
#####################################
# mut rate 1000#
#
infiles.a <- c("AllStatsOutput_New_Rep1_100-1000.csv",#
				"AllStatsOutput_New_Rep2_100-1000.csv",#
				"AllStatsOutput_New_Rep3_100-1000.csv",#
				"AllStatsOutput_New_Rep4_100-1000.csv",#
				"AllStatsOutput_New_Rep5_100-1000.csv",#
				"AllStatsOutput_New_Rep6_100-1000.csv",#
				"AllStatsOutput_Newest_Rep7_100-1000.csv",#
				"AllStatsOutput_Newest_Rep8_100-1000.csv",#
				"AllStatsOutput_Newest_Rep9_100-1000.csv",#
				"AllStatsOutput_Newest_Rep10_100-1000.csv",#
				"AllStatsOutput_Newest_Rep11_100-1000.csv",#
				"AllStatsOutput_Newest_Rep12_100-1000.csv",#
				"AllStatsOutput_Newest_Rep13_100-1000.csv",#
				"AllStatsOutput_Newest_Rep14_100-1000.csv",#
				"AllStatsOutput_Newest_Rep15_100-1000.csv",#
				"AllStatsOutput_Newest_Rep16_100-1000.csv",#
				"AllStatsOutput_Newest_Rep17_100-1000.csv",#
				"AllStatsOutput_Newest_Rep18_100-1000.csv",#
				"AllStatsOutput_Newest_Rep19_100-1000.csv",#
				"AllStatsOutput_Newest_Rep20_100-1000.csv",#
				"AllStatsOutput_Newest_Rep21_100-1000.csv",#
				"AllStatsOutput_Newest_Rep22_100-1000.csv",#
				"AllStatsOutput_Newest_Rep23_100-1000.csv",#
				"AllStatsOutput_Newest_Rep24_100-1000.csv",#
				"AllStatsOutput_Newest_Rep25_100-1000.csv"#,#
#				"AllStatsOutput_Newest_Rep26_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep27_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep28_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep29_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep30_100-1000.csv"#
				)#
infiles.b <- c("RF_Eucl_results_New_Rep1_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep2_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep3_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep4_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep5_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep6_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep7_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep8_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep9_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep10_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep11_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep12_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep13_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep14_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep15_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep16_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep17_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep18_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep19_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep20_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep21_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep22_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep23_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep24_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep25_100-1000_wConsensus.txt"#,#
#				"RF_Eucl_results_New_Rep26_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep27_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep28_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep29_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep30_100-1000_wConsensus.txt"#
				)#
#
dat <- NULL#
for(i in c(1:5,7:25)){#length(infiles.a)){ #**************UNCOMMENT ME FOR ALL REPS#
	temp.dat1 <- read.csv(infiles.a[i], header=TRUE, stringsAsFactors=FALSE)#
	temp.dat1$uniqueID <- paste(temp.dat1$species, temp.dat1$samp.size, temp.dat1$search.algo, temp.dat1$part.IC, sep="_")#
	temp.dat2 <- read.table(infiles.b[i], header=TRUE, stringsAsFactors=FALSE)#
	# because also have consenseus trees now:#
	temp.dat2 <- cbind(temp.dat2[1:32,], temp.dat2[33:64, 2:3])#
	names(temp.dat2) <- c("filename", "rf_dist", "eucl_dist", "cons_rf_dist", "cons_eucl_dist")#
	temp.dat2$uniqueID <- make.merge.id(temp.dat2)#
	temp.dat <- merge(temp.dat1, temp.dat2, by="uniqueID")#
	temp.dat$gene.size <- 100#
	temp.dat$mut.rate <- 1000#
	temp.dat$replicate <- i#
	dat <- rbind(dat, temp.dat)#
}#
#
no.part.dat <- dat[dat$part.IC == "noPart" ,]#
## IS there a statistically significant difference between the RF/eucl distance to true tree of no partitioning vs with partitioning??#
# compare at each sample size, for each species, for both RF and euclidean distance#
#
spp <- c("myria", "lopho")#
samps <- c(10,20,40,80)#
stat.data.set.BIC <- data.frame(matrix(NA, ncol=14, nrow=8))#
names(stat.data.set.BIC) <- c("species", "samp.size", "rf_twoside_p", "rf_less_p", "rf_greater_p", "eucl_twoside_p", "eucl_less_p", "eucl_greater_p", "cons_rf_twoside_p", "cons_rf_less_p", "cons_rf_greater_p", "cons_eucl_twoside_p", "cons_eucl_less_p", "cons_eucl_greater_p")#
#
iterate <- 1#
for(j in spp){#
	for(k in samps){#
		temp.dat.no.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "noPart" , ]#
		temp.dat.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "BIC" , ]#
		rf_ts_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		rf_less_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		rf_greater_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		eucl_ts_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		eucl_less_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		eucl_greater_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
#
		# also for the consensus tree#
		cons_rf_ts_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		cons_rf_less_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		cons_rf_greater_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		cons_eucl_ts_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		cons_eucl_less_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		cons_eucl_greater_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
		stat.data.set.BIC[iterate, ] <- c(j, k, rf_ts_p, rf_less_p, rf_greater_p, eucl_ts_p, eucl_less_p, eucl_greater_p, cons_rf_ts_p, cons_rf_less_p, cons_rf_greater_p, cons_eucl_ts_p, cons_eucl_less_p, cons_eucl_greater_p)#
		iterate <- iterate + 1#
	}#
}#
## AIC STATS#
#
spp <- c("myria", "lopho")#
samps <- c(10,20,40,80)#
stat.data.set.AIC <- data.frame(matrix(NA, ncol=14, nrow=8))#
names(stat.data.set.AIC) <- c("species", "samp.size", "rf_twoside_p", "rf_less_p", "rf_greater_p", "eucl_twoside_p", "eucl_less_p", "eucl_greater_p", "cons_rf_twoside_p", "cons_rf_less_p", "cons_rf_greater_p", "cons_eucl_twoside_p", "cons_eucl_less_p", "cons_eucl_greater_p")#
#
iterate <- 1#
for(j in spp){#
	for(k in samps){#
		temp.dat.no.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "noPart" , ]#
		temp.dat.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "AIC" , ]#
		rf_ts_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		rf_less_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		rf_greater_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		eucl_ts_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		eucl_less_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		eucl_greater_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
#
		# also for the consensus tree#
		cons_rf_ts_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		cons_rf_less_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		cons_rf_greater_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		cons_eucl_ts_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		cons_eucl_less_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		cons_eucl_greater_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
		stat.data.set.AIC[iterate, ] <- c(j, k, rf_ts_p, rf_less_p, rf_greater_p, eucl_ts_p, eucl_less_p, eucl_greater_p, cons_rf_ts_p, cons_rf_less_p, cons_rf_greater_p, cons_eucl_ts_p, cons_eucl_less_p, cons_eucl_greater_p)#
		iterate <- iterate + 1#
	}#
}#
### AICc STATS#
#
spp <- c("myria", "lopho")#
samps <- c(10,20,40,80)#
stat.data.set.AICc <- data.frame(matrix(NA, ncol=14, nrow=8))#
names(stat.data.set.AICc) <- c("species", "samp.size", "rf_twoside_p", "rf_less_p", "rf_greater_p", "eucl_twoside_p", "eucl_less_p", "eucl_greater_p", "cons_rf_twoside_p", "cons_rf_less_p", "cons_rf_greater_p", "cons_eucl_twoside_p", "cons_eucl_less_p", "cons_eucl_greater_p")#
#
iterate <- 1#
for(j in spp){#
	for(k in samps){#
		temp.dat.no.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "noPart" , ]#
		temp.dat.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "AICc" , ]#
		rf_ts_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		rf_less_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		rf_greater_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		eucl_ts_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		eucl_less_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		eucl_greater_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
#
		# also for the consensus tree#
		cons_rf_ts_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		cons_rf_less_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		cons_rf_greater_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		cons_eucl_ts_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		cons_eucl_less_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		cons_eucl_greater_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
		stat.data.set.AICc[iterate, ] <- c(j, k, rf_ts_p, rf_less_p, rf_greater_p, eucl_ts_p, eucl_less_p, eucl_greater_p, cons_rf_ts_p, cons_rf_less_p, cons_rf_greater_p, cons_eucl_ts_p, cons_eucl_less_p, cons_eucl_greater_p)#
		iterate <- iterate + 1#
	}#
}#
#####################################
samp.size.col <- c("steelblue4", "darkorange2", "green4", "red3")#
outline.col <- "gray30"#
samp.sizes <- c(10,20,40,80)#
#####################################
ylim1 <- c(-0.155, 0.155)#
ylim2 <- c(-1.35, 1.35)#
ylim3 <- c(0.5,10)#
box.width <- 1#
line.type <- 1#
line.width <- 1.75#
ytext1 <- 0.13#
ytext2 <- 1.075#
p.height1 <- 0.15#
p.height2 <- 1.3#
criteria <- c("AIC", "BIC", "AICc")#
for(criterion in criteria){#
#
if(criterion == "AIC") stat.data.set <- stat.data.set.AIC#
if(criterion == "BIC") stat.data.set <- stat.data.set.BIC#
if(criterion == "AICc") stat.data.set <- stat.data.set.AICc#
part.crit <- criterion#
#
pdf(paste(c("Results_Plots/Boxplots_", part.crit, "_StatsParts.pdf"), collapse=""), width=6, height=10)#
##par(mfrow=c(3,1), mar=c(2.5,4.25,1.75,0.25))#
par(mar=c(2.5,4.25,1.75,0.25))#
layout(matrix(c(1,1,2,2,3), ncol=1))#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim1, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Robinson Fould distance", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext1, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext1, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
# add p values from 2-sided wilcoxon test#
text(x=c(0.5,1:4), y=rep(p.height1, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height1, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
legend("bottomright", c("10", "20", "40", "80"), pch=15, col=samp.size.col, title = "num. genes", cex=0.875, pt.cex=1.5) # , bg="white"#
# eucl distance#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim2, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Euclidean distance", mgp=c(3,0.9,0))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext2, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext2, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=c(0.5,1:4), y=rep(p.height2, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height2, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
# number partitions#
par(mar=c(2.5,4.25,0.25,0.25))#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim3, xlab="", xaxt="n", ylab="number partitions inferred", main="", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
# AND NOW USING CONSENSUS TREE DISTANCE INSTEAD#
#
par(mar=c(2.5,4.25,1.75,0.25))#
#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim1, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Robinson Fould distance", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext1, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext1, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="cons_rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
# add p values from 2-sided wilcoxon test#
text(x=c(0.5,1:4), y=rep(p.height1, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="cons_rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height1, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
legend("bottomright", c("10", "20", "40", "80"), pch=15, col=samp.size.col, title = "num. genes", cex=0.875, pt.cex=1.5) # , bg="white"#
# eucl distance#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim2, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Euclidean distance", mgp=c(3,0.9,0))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext2, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext2, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="cons_eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=c(0.5,1:4), y=rep(p.height2, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="cons_eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height2, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
#SAME # number partitions#
par(mar=c(2.5,4.25,0.25,0.25))#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim3, xlab="", xaxt="n", ylab="number partitions inferred", main="", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
dev.off()#
}
library(scales)#
setwd("~/Documents/UNIL/PartitioningMethods_SimulationProject/FunctioningPipeline/AnalysisResults")#
make.merge.id <- function(dat){#
	id.col <- rep(NA, dim(dat)[1])#
	for(i in 1:dim(dat)[1]){#
		if(length(grep("lopho", dat$file[i])) > 0) spp <- "lopho_"#
		if(length(grep("myria", dat$file[i])) > 0) spp <- "myria_"#
		if(length(grep("10", dat$file[i])) > 0) samp <- "10_"#
		if(length(grep("20", dat$file[i])) > 0) samp <- "20_"#
		if(length(grep("40", dat$file[i])) > 0) samp <- "40_"#
		if(length(grep("80", dat$file[i])) > 0) samp <- "80_"#
		if(length(grep("rcluster", dat$file[i])) > 0) algo <- "rcluster_"#
		if(length(grep("greedy", dat$file[i])) > 0) algo <- "greedy_"#
		if(length(grep("noPart", dat$file[i])) > 0) algo <- "noPart_"#
		if(length(grep("AIC", dat$file[i])) > 0) crit <- "AIC"#
		if(length(grep("AICc", dat$file[i])) > 0) crit <- "AICc"#
		if(length(grep("BIC", dat$file[i])) > 0) crit <- "BIC"#
		if(length(grep("noPart", dat$file[i])) > 0) crit <- "noPart"#
		id.col[i] <- paste(c(spp, samp, algo, crit), collapse="")#
	}#
	return(id.col)#
}#
#####################################
#
get.rep.difference <- function(dat, rep, samp.size, spp, partitioning.criterion, distance){#
	temp.dat <- dat[dat$replicate == rep & dat$samp.size == samp.size & dat$species == spp , ]#
	no.part.result <- temp.dat[temp.dat$search.algo == "noPart" ,]#
	rclust.AIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AIC" ,]#
	rclust.BIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "BIC" ,]#
	rclust.AICc.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AICc",]#
	if(partitioning.criterion == "AIC"){#
		if(dim(rclust.AIC.result[distance])[1] == 0 | dim(no.part.result[distance])[1] == 0){ difference <- NA}#
		else{ difference <- no.part.result[distance] - rclust.AIC.result[distance] }#
	}#
	if(partitioning.criterion == "BIC"){#
		if(dim(rclust.BIC.result[distance])[1] == 0 | dim(no.part.result[distance])[1] == 0){ difference <- NA}#
		else{ difference <- no.part.result[distance] - rclust.BIC.result[distance] }#
	}#
	if(partitioning.criterion == "AICc"){#
		if(dim(rclust.AICc.result[distance])[1] == 0 | dim(no.part.result[distance])[1] == 0){ difference <- NA}#
		else{ difference <- no.part.result[distance] - rclust.AICc.result[distance] }#
	}#
	return(as.numeric(difference))			#
}#
#
#####################################
#
get.boxplot.dat <- function(dat, samp.size, spp, partitioning.criterion, distance){	#
	samp.size.dists <- NULL#
	for(j in unique(dat$replicate)){#
		dist <- get.rep.difference(dat, rep=j, samp.size=samp.size, spp=spp, partitioning.criterion=partitioning.criterion, distance=distance)#
		samp.size.dists <- c(samp.size.dists, dist)#
	}#
	return(samp.size.dists)#
}#
#
#####################################
#
get.partition.dat <- function(dat, samp.size, spp, partitioning.criterion){	#
	partition.numbers <- NULL#
	for(j in unique(dat$replicate)){#
		temp.dat <- dat[dat$replicate == j & dat$samp.size == samp.size & dat$species == spp , ]#
		rclust.AIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AIC" ,]#
		rclust.BIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "BIC" ,]#
		rclust.AICc.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AICc",]#
		if(partitioning.criterion == "AIC"){#
			if(length(rclust.AIC.result$num.partitions)[1] == 0){ num.parts <- NA}#
			else{ num.parts <- rclust.AIC.result$num.partitions }#
		}#
		if(partitioning.criterion == "BIC"){#
			if(length(rclust.BIC.result$num.partitions)[1] == 0){ num.parts <- NA}#
			else{ num.parts <- rclust.BIC.result$num.partitions }#
		}#
		if(partitioning.criterion == "AICc"){#
			if(length(rclust.AICc.result$num.partitions)[1] == 0){ num.parts <- NA}#
			else{ num.parts <- rclust.AICc.result$num.partitions }#
		}#
		partition.numbers <- c(partition.numbers, num.parts)#
	}#
	return(partition.numbers)#
}#
#
#####################################
# mut rate 1000#
#
infiles.a <- c("AllStatsOutput_New_Rep1_100-1000.csv",#
				"AllStatsOutput_New_Rep2_100-1000.csv",#
				"AllStatsOutput_New_Rep3_100-1000.csv",#
				"AllStatsOutput_New_Rep4_100-1000.csv",#
				"AllStatsOutput_New_Rep5_100-1000.csv",#
				"AllStatsOutput_New_Rep6_100-1000.csv",#
				"AllStatsOutput_Newest_Rep7_100-1000.csv",#
				"AllStatsOutput_Newest_Rep8_100-1000.csv",#
				"AllStatsOutput_Newest_Rep9_100-1000.csv",#
				"AllStatsOutput_Newest_Rep10_100-1000.csv",#
				"AllStatsOutput_Newest_Rep11_100-1000.csv",#
				"AllStatsOutput_Newest_Rep12_100-1000.csv",#
				"AllStatsOutput_Newest_Rep13_100-1000.csv",#
				"AllStatsOutput_Newest_Rep14_100-1000.csv",#
				"AllStatsOutput_Newest_Rep15_100-1000.csv",#
				"AllStatsOutput_Newest_Rep16_100-1000.csv",#
				"AllStatsOutput_Newest_Rep17_100-1000.csv",#
				"AllStatsOutput_Newest_Rep18_100-1000.csv",#
				"AllStatsOutput_Newest_Rep19_100-1000.csv",#
				"AllStatsOutput_Newest_Rep20_100-1000.csv",#
				"AllStatsOutput_Newest_Rep21_100-1000.csv",#
				"AllStatsOutput_Newest_Rep22_100-1000.csv",#
				"AllStatsOutput_Newest_Rep23_100-1000.csv",#
				"AllStatsOutput_Newest_Rep24_100-1000.csv",#
				"AllStatsOutput_Newest_Rep25_100-1000.csv"#,#
#				"AllStatsOutput_Newest_Rep26_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep27_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep28_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep29_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep30_100-1000.csv"#
				)#
infiles.b <- c("RF_Eucl_results_New_Rep1_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep2_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep3_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep4_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep5_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep6_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep7_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep8_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep9_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep10_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep11_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep12_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep13_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep14_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep15_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep16_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep17_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep18_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep19_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep20_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep21_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep22_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep23_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep24_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep25_100-1000_wConsensus.txt"#,#
#				"RF_Eucl_results_New_Rep26_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep27_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep28_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep29_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep30_100-1000_wConsensus.txt"#
				)
dat <- NULL#
for(i in c(1:5,7:25)){#length(infiles.a)){ #**************UNCOMMENT ME FOR ALL REPS#
	temp.dat1 <- read.csv(infiles.a[i], header=TRUE, stringsAsFactors=FALSE)#
	temp.dat1$uniqueID <- paste(temp.dat1$species, temp.dat1$samp.size, temp.dat1$search.algo, temp.dat1$part.IC, sep="_")#
	temp.dat2 <- read.table(infiles.b[i], header=TRUE, stringsAsFactors=FALSE)#
	# because also have consenseus trees now:#
	temp.dat2 <- cbind(temp.dat2[1:32,], temp.dat2[33:64, 2:3])#
	names(temp.dat2) <- c("filename", "rf_dist", "eucl_dist", "cons_rf_dist", "cons_eucl_dist")#
	temp.dat2$uniqueID <- make.merge.id(temp.dat2)#
	temp.dat <- merge(temp.dat1, temp.dat2, by="uniqueID")#
	temp.dat$gene.size <- 100#
	temp.dat$mut.rate <- 1000#
	temp.dat$replicate <- i#
	dat <- rbind(dat, temp.dat)#
}
no.part.dat <- dat[dat$part.IC == "noPart" ,]#
## IS there a statistically significant difference between the RF/eucl distance to true tree of no partitioning vs with partitioning??#
# compare at each sample size, for each species, for both RF and euclidean distance#
#
spp <- c("myria", "lopho")#
samps <- c(10,20,40,80)#
stat.data.set.BIC <- data.frame(matrix(NA, ncol=14, nrow=8))#
names(stat.data.set.BIC) <- c("species", "samp.size", "rf_twoside_p", "rf_less_p", "rf_greater_p", "eucl_twoside_p", "eucl_less_p", "eucl_greater_p", "cons_rf_twoside_p", "cons_rf_less_p", "cons_rf_greater_p", "cons_eucl_twoside_p", "cons_eucl_less_p", "cons_eucl_greater_p")#
#
iterate <- 1#
for(j in spp){#
	for(k in samps){#
		temp.dat.no.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "noPart" , ]#
		temp.dat.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "BIC" , ]#
		rf_ts_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		rf_less_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		rf_greater_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		eucl_ts_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		eucl_less_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		eucl_greater_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
#
		# also for the consensus tree#
		cons_rf_ts_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		cons_rf_less_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		cons_rf_greater_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		cons_eucl_ts_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		cons_eucl_less_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		cons_eucl_greater_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
		stat.data.set.BIC[iterate, ] <- c(j, k, rf_ts_p, rf_less_p, rf_greater_p, eucl_ts_p, eucl_less_p, eucl_greater_p, cons_rf_ts_p, cons_rf_less_p, cons_rf_greater_p, cons_eucl_ts_p, cons_eucl_less_p, cons_eucl_greater_p)#
		iterate <- iterate + 1#
	}#
}
## AIC STATS#
#
spp <- c("myria", "lopho")#
samps <- c(10,20,40,80)#
stat.data.set.AIC <- data.frame(matrix(NA, ncol=14, nrow=8))#
names(stat.data.set.AIC) <- c("species", "samp.size", "rf_twoside_p", "rf_less_p", "rf_greater_p", "eucl_twoside_p", "eucl_less_p", "eucl_greater_p", "cons_rf_twoside_p", "cons_rf_less_p", "cons_rf_greater_p", "cons_eucl_twoside_p", "cons_eucl_less_p", "cons_eucl_greater_p")#
#
iterate <- 1#
for(j in spp){#
	for(k in samps){#
		temp.dat.no.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "noPart" , ]#
		temp.dat.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "AIC" , ]#
		rf_ts_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		rf_less_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		rf_greater_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		eucl_ts_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		eucl_less_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		eucl_greater_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
#
		# also for the consensus tree#
		cons_rf_ts_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		cons_rf_less_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		cons_rf_greater_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		cons_eucl_ts_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		cons_eucl_less_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		cons_eucl_greater_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
		stat.data.set.AIC[iterate, ] <- c(j, k, rf_ts_p, rf_less_p, rf_greater_p, eucl_ts_p, eucl_less_p, eucl_greater_p, cons_rf_ts_p, cons_rf_less_p, cons_rf_greater_p, cons_eucl_ts_p, cons_eucl_less_p, cons_eucl_greater_p)#
		iterate <- iterate + 1#
	}#
}
spp <- c("myria", "lopho")#
samps <- c(10,20,40,80)#
stat.data.set.AICc <- data.frame(matrix(NA, ncol=14, nrow=8))#
names(stat.data.set.AICc) <- c("species", "samp.size", "rf_twoside_p", "rf_less_p", "rf_greater_p", "eucl_twoside_p", "eucl_less_p", "eucl_greater_p", "cons_rf_twoside_p", "cons_rf_less_p", "cons_rf_greater_p", "cons_eucl_twoside_p", "cons_eucl_less_p", "cons_eucl_greater_p")#
#
iterate <- 1#
for(j in spp){#
	for(k in samps){#
		temp.dat.no.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "noPart" , ]#
		temp.dat.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "AICc" , ]#
		rf_ts_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		rf_less_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		rf_greater_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		eucl_ts_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		eucl_less_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		eucl_greater_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
#
		# also for the consensus tree#
		cons_rf_ts_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		cons_rf_less_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		cons_rf_greater_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		cons_eucl_ts_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		cons_eucl_less_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		cons_eucl_greater_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
		stat.data.set.AICc[iterate, ] <- c(j, k, rf_ts_p, rf_less_p, rf_greater_p, eucl_ts_p, eucl_less_p, eucl_greater_p, cons_rf_ts_p, cons_rf_less_p, cons_rf_greater_p, cons_eucl_ts_p, cons_eucl_less_p, cons_eucl_greater_p)#
		iterate <- iterate + 1#
	}#
}#
#####################################
samp.size.col <- c("steelblue4", "darkorange2", "green4", "red3")#
outline.col <- "gray30"#
samp.sizes <- c(10,20,40,80)#
#####################################
ylim1 <- c(-0.155, 0.155)#
ylim2 <- c(-1.35, 1.35)#
ylim3 <- c(0.5,10)#
box.width <- 1#
line.type <- 1#
line.width <- 1.75#
ytext1 <- 0.13#
ytext2 <- 1.075#
p.height1 <- 0.15#
p.height2 <- 1.3
criteria <- c("AIC", "BIC", "AICc")#
for(criterion in criteria){#
#
if(criterion == "AIC") stat.data.set <- stat.data.set.AIC#
if(criterion == "BIC") stat.data.set <- stat.data.set.BIC#
if(criterion == "AICc") stat.data.set <- stat.data.set.AICc#
part.crit <- criterion#
#
pdf(paste(c("Results_Plots/Boxplots_", part.crit, "_StatsParts.pdf"), collapse=""), width=6, height=10)#
##par(mfrow=c(3,1), mar=c(2.5,4.25,1.75,0.25))#
par(mar=c(2.5,4.25,1.75,0.25))#
layout(matrix(c(1,1,2,2,3), ncol=1))#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim1, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Robinson Fould distance", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext1, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext1, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
# add p values from 2-sided wilcoxon test#
text(x=c(0.5,1:4), y=rep(p.height1, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height1, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
legend("bottomright", c("10", "20", "40", "80"), pch=15, col=samp.size.col, title = "num. genes", cex=0.875, pt.cex=1.5) # , bg="white"#
# eucl distance#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim2, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Euclidean distance", mgp=c(3,0.9,0))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext2, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext2, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=c(0.5,1:4), y=rep(p.height2, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height2, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
# number partitions#
par(mar=c(2.5,4.25,0.25,0.25))#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim3, xlab="", xaxt="n", ylab="number partitions inferred", main="", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
# AND NOW USING CONSENSUS TREE DISTANCE INSTEAD#
#
par(mar=c(2.5,4.25,1.75,0.25))#
#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim1, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Robinson Fould distance", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext1, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext1, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="cons_rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
# add p values from 2-sided wilcoxon test#
text(x=c(0.5,1:4), y=rep(p.height1, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="cons_rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height1, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
legend("bottomright", c("10", "20", "40", "80"), pch=15, col=samp.size.col, title = "num. genes", cex=0.875, pt.cex=1.5) # , bg="white"#
# eucl distance#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim2, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Euclidean distance", mgp=c(3,0.9,0))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext2, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext2, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="cons_eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=c(0.5,1:4), y=rep(p.height2, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="cons_eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height2, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
#SAME # number partitions#
par(mar=c(2.5,4.25,0.25,0.25))#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim3, xlab="", xaxt="n", ylab="number partitions inferred", main="", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
dev.off()#
}
library(scales)#
setwd("~/Documents/UNIL/PartitioningMethods_SimulationProject/FunctioningPipeline/AnalysisResults")#
make.merge.id <- function(dat){#
	id.col <- rep(NA, dim(dat)[1])#
	for(i in 1:dim(dat)[1]){#
		if(length(grep("lopho", dat$file[i])) > 0) spp <- "lopho_"#
		if(length(grep("myria", dat$file[i])) > 0) spp <- "myria_"#
		if(length(grep("10", dat$file[i])) > 0) samp <- "10_"#
		if(length(grep("20", dat$file[i])) > 0) samp <- "20_"#
		if(length(grep("40", dat$file[i])) > 0) samp <- "40_"#
		if(length(grep("80", dat$file[i])) > 0) samp <- "80_"#
		if(length(grep("rcluster", dat$file[i])) > 0) algo <- "rcluster_"#
		if(length(grep("greedy", dat$file[i])) > 0) algo <- "greedy_"#
		if(length(grep("noPart", dat$file[i])) > 0) algo <- "noPart_"#
		if(length(grep("AIC", dat$file[i])) > 0) crit <- "AIC"#
		if(length(grep("AICc", dat$file[i])) > 0) crit <- "AICc"#
		if(length(grep("BIC", dat$file[i])) > 0) crit <- "BIC"#
		if(length(grep("noPart", dat$file[i])) > 0) crit <- "noPart"#
		id.col[i] <- paste(c(spp, samp, algo, crit), collapse="")#
	}#
	return(id.col)#
}#
#####################################
#
get.rep.difference <- function(dat, rep, samp.size, spp, partitioning.criterion, distance){#
	temp.dat <- dat[dat$replicate == rep & dat$samp.size == samp.size & dat$species == spp , ]#
	no.part.result <- temp.dat[temp.dat$search.algo == "noPart" ,]#
	rclust.AIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AIC" ,]#
	rclust.BIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "BIC" ,]#
	rclust.AICc.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AICc",]#
	if(partitioning.criterion == "AIC"){#
		if(dim(rclust.AIC.result[distance])[1] == 0 | dim(no.part.result[distance])[1] == 0){ difference <- NA}#
		else{ difference <- no.part.result[distance] - rclust.AIC.result[distance] }#
	}#
	if(partitioning.criterion == "BIC"){#
		if(dim(rclust.BIC.result[distance])[1] == 0 | dim(no.part.result[distance])[1] == 0){ difference <- NA}#
		else{ difference <- no.part.result[distance] - rclust.BIC.result[distance] }#
	}#
	if(partitioning.criterion == "AICc"){#
		if(dim(rclust.AICc.result[distance])[1] == 0 | dim(no.part.result[distance])[1] == 0){ difference <- NA}#
		else{ difference <- no.part.result[distance] - rclust.AICc.result[distance] }#
	}#
	return(as.numeric(difference))			#
}#
#
#####################################
#
get.boxplot.dat <- function(dat, samp.size, spp, partitioning.criterion, distance){	#
	samp.size.dists <- NULL#
	for(j in unique(dat$replicate)){#
		dist <- get.rep.difference(dat, rep=j, samp.size=samp.size, spp=spp, partitioning.criterion=partitioning.criterion, distance=distance)#
		samp.size.dists <- c(samp.size.dists, dist)#
	}#
	return(samp.size.dists)#
}#
#
#####################################
#
get.partition.dat <- function(dat, samp.size, spp, partitioning.criterion){	#
	partition.numbers <- NULL#
	for(j in unique(dat$replicate)){#
		temp.dat <- dat[dat$replicate == j & dat$samp.size == samp.size & dat$species == spp , ]#
		rclust.AIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AIC" ,]#
		rclust.BIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "BIC" ,]#
		rclust.AICc.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AICc",]#
		if(partitioning.criterion == "AIC"){#
			if(length(rclust.AIC.result$num.partitions)[1] == 0){ num.parts <- NA}#
			else{ num.parts <- rclust.AIC.result$num.partitions }#
		}#
		if(partitioning.criterion == "BIC"){#
			if(length(rclust.BIC.result$num.partitions)[1] == 0){ num.parts <- NA}#
			else{ num.parts <- rclust.BIC.result$num.partitions }#
		}#
		if(partitioning.criterion == "AICc"){#
			if(length(rclust.AICc.result$num.partitions)[1] == 0){ num.parts <- NA}#
			else{ num.parts <- rclust.AICc.result$num.partitions }#
		}#
		partition.numbers <- c(partition.numbers, num.parts)#
	}#
	return(partition.numbers)#
}#
#
#####################################
# mut rate 1000#
#
infiles.a <- c("AllStatsOutput_New_Rep1_100-1000.csv",#
				"AllStatsOutput_New_Rep2_100-1000.csv",#
				"AllStatsOutput_New_Rep3_100-1000.csv",#
				"AllStatsOutput_New_Rep4_100-1000.csv",#
				"AllStatsOutput_New_Rep5_100-1000.csv",#
				"AllStatsOutput_New_Rep6_100-1000.csv",#
				"AllStatsOutput_Newest_Rep7_100-1000.csv",#
				"AllStatsOutput_Newest_Rep8_100-1000.csv",#
				"AllStatsOutput_Newest_Rep9_100-1000.csv",#
				"AllStatsOutput_Newest_Rep10_100-1000.csv",#
				"AllStatsOutput_Newest_Rep11_100-1000.csv",#
				"AllStatsOutput_Newest_Rep12_100-1000.csv",#
				"AllStatsOutput_Newest_Rep13_100-1000.csv",#
				"AllStatsOutput_Newest_Rep14_100-1000.csv",#
				"AllStatsOutput_Newest_Rep15_100-1000.csv",#
				"AllStatsOutput_Newest_Rep16_100-1000.csv",#
				"AllStatsOutput_Newest_Rep17_100-1000.csv",#
				"AllStatsOutput_Newest_Rep18_100-1000.csv",#
				"AllStatsOutput_Newest_Rep19_100-1000.csv",#
				"AllStatsOutput_Newest_Rep20_100-1000.csv",#
				"AllStatsOutput_Newest_Rep21_100-1000.csv",#
				"AllStatsOutput_Newest_Rep22_100-1000.csv",#
				"AllStatsOutput_Newest_Rep23_100-1000.csv",#
				"AllStatsOutput_Newest_Rep24_100-1000.csv",#
				"AllStatsOutput_Newest_Rep25_100-1000.csv"#,#
#				"AllStatsOutput_Newest_Rep26_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep27_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep28_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep29_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep30_100-1000.csv"#
				)#
infiles.b <- c("RF_Eucl_results_New_Rep1_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep2_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep3_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep4_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep5_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep6_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep7_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep8_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep9_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep10_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep11_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep12_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep13_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep14_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep15_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep16_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep17_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep18_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep19_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep20_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep21_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep22_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep23_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep24_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep25_100-1000_wConsensus.txt"#,#
#				"RF_Eucl_results_New_Rep26_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep27_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep28_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep29_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep30_100-1000_wConsensus.txt"#
				)#
#
dat <- NULL#
for(i in c(1:5,7:20)){#length(infiles.a)){ #**************UNCOMMENT ME FOR ALL REPS#
	temp.dat1 <- read.csv(infiles.a[i], header=TRUE, stringsAsFactors=FALSE)#
	temp.dat1$uniqueID <- paste(temp.dat1$species, temp.dat1$samp.size, temp.dat1$search.algo, temp.dat1$part.IC, sep="_")#
	temp.dat2 <- read.table(infiles.b[i], header=TRUE, stringsAsFactors=FALSE)#
	# because also have consenseus trees now:#
	temp.dat2 <- cbind(temp.dat2[1:32,], temp.dat2[33:64, 2:3])#
	names(temp.dat2) <- c("filename", "rf_dist", "eucl_dist", "cons_rf_dist", "cons_eucl_dist")#
	temp.dat2$uniqueID <- make.merge.id(temp.dat2)#
	temp.dat <- merge(temp.dat1, temp.dat2, by="uniqueID")#
	temp.dat$gene.size <- 100#
	temp.dat$mut.rate <- 1000#
	temp.dat$replicate <- i#
	dat <- rbind(dat, temp.dat)#
}#
#
no.part.dat <- dat[dat$part.IC == "noPart" ,]#
## IS there a statistically significant difference between the RF/eucl distance to true tree of no partitioning vs with partitioning??#
# compare at each sample size, for each species, for both RF and euclidean distance#
#
spp <- c("myria", "lopho")#
samps <- c(10,20,40,80)#
stat.data.set.BIC <- data.frame(matrix(NA, ncol=14, nrow=8))#
names(stat.data.set.BIC) <- c("species", "samp.size", "rf_twoside_p", "rf_less_p", "rf_greater_p", "eucl_twoside_p", "eucl_less_p", "eucl_greater_p", "cons_rf_twoside_p", "cons_rf_less_p", "cons_rf_greater_p", "cons_eucl_twoside_p", "cons_eucl_less_p", "cons_eucl_greater_p")#
#
iterate <- 1#
for(j in spp){#
	for(k in samps){#
		temp.dat.no.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "noPart" , ]#
		temp.dat.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "BIC" , ]#
		rf_ts_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		rf_less_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		rf_greater_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		eucl_ts_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		eucl_less_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		eucl_greater_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
#
		# also for the consensus tree#
		cons_rf_ts_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		cons_rf_less_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		cons_rf_greater_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		cons_eucl_ts_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		cons_eucl_less_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		cons_eucl_greater_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
		stat.data.set.BIC[iterate, ] <- c(j, k, rf_ts_p, rf_less_p, rf_greater_p, eucl_ts_p, eucl_less_p, eucl_greater_p, cons_rf_ts_p, cons_rf_less_p, cons_rf_greater_p, cons_eucl_ts_p, cons_eucl_less_p, cons_eucl_greater_p)#
		iterate <- iterate + 1#
	}#
}#
## AIC STATS#
#
spp <- c("myria", "lopho")#
samps <- c(10,20,40,80)#
stat.data.set.AIC <- data.frame(matrix(NA, ncol=14, nrow=8))#
names(stat.data.set.AIC) <- c("species", "samp.size", "rf_twoside_p", "rf_less_p", "rf_greater_p", "eucl_twoside_p", "eucl_less_p", "eucl_greater_p", "cons_rf_twoside_p", "cons_rf_less_p", "cons_rf_greater_p", "cons_eucl_twoside_p", "cons_eucl_less_p", "cons_eucl_greater_p")#
#
iterate <- 1#
for(j in spp){#
	for(k in samps){#
		temp.dat.no.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "noPart" , ]#
		temp.dat.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "AIC" , ]#
		rf_ts_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		rf_less_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		rf_greater_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		eucl_ts_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		eucl_less_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		eucl_greater_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
#
		# also for the consensus tree#
		cons_rf_ts_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		cons_rf_less_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		cons_rf_greater_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		cons_eucl_ts_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		cons_eucl_less_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		cons_eucl_greater_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
		stat.data.set.AIC[iterate, ] <- c(j, k, rf_ts_p, rf_less_p, rf_greater_p, eucl_ts_p, eucl_less_p, eucl_greater_p, cons_rf_ts_p, cons_rf_less_p, cons_rf_greater_p, cons_eucl_ts_p, cons_eucl_less_p, cons_eucl_greater_p)#
		iterate <- iterate + 1#
	}#
}#
### AICc STATS#
#
spp <- c("myria", "lopho")#
samps <- c(10,20,40,80)#
stat.data.set.AICc <- data.frame(matrix(NA, ncol=14, nrow=8))#
names(stat.data.set.AICc) <- c("species", "samp.size", "rf_twoside_p", "rf_less_p", "rf_greater_p", "eucl_twoside_p", "eucl_less_p", "eucl_greater_p", "cons_rf_twoside_p", "cons_rf_less_p", "cons_rf_greater_p", "cons_eucl_twoside_p", "cons_eucl_less_p", "cons_eucl_greater_p")#
#
iterate <- 1#
for(j in spp){#
	for(k in samps){#
		temp.dat.no.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "noPart" , ]#
		temp.dat.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "AICc" , ]#
		rf_ts_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		rf_less_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		rf_greater_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		eucl_ts_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		eucl_less_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		eucl_greater_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
#
		# also for the consensus tree#
		cons_rf_ts_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		cons_rf_less_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		cons_rf_greater_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		cons_eucl_ts_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		cons_eucl_less_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		cons_eucl_greater_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
		stat.data.set.AICc[iterate, ] <- c(j, k, rf_ts_p, rf_less_p, rf_greater_p, eucl_ts_p, eucl_less_p, eucl_greater_p, cons_rf_ts_p, cons_rf_less_p, cons_rf_greater_p, cons_eucl_ts_p, cons_eucl_less_p, cons_eucl_greater_p)#
		iterate <- iterate + 1#
	}#
}#
#####################################
samp.size.col <- c("steelblue4", "darkorange2", "green4", "red3")#
outline.col <- "gray30"#
samp.sizes <- c(10,20,40,80)#
#####################################
ylim1 <- c(-0.155, 0.155)#
ylim2 <- c(-1.35, 1.35)#
ylim3 <- c(0.5,10)#
box.width <- 1#
line.type <- 1#
line.width <- 1.75#
ytext1 <- 0.13#
ytext2 <- 1.075#
p.height1 <- 0.15#
p.height2 <- 1.3#
criteria <- c("AIC", "BIC", "AICc")#
for(criterion in criteria){#
#
if(criterion == "AIC") stat.data.set <- stat.data.set.AIC#
if(criterion == "BIC") stat.data.set <- stat.data.set.BIC#
if(criterion == "AICc") stat.data.set <- stat.data.set.AICc#
part.crit <- criterion#
#
pdf(paste(c("Results_Plots/Boxplots_", part.crit, "_StatsParts.pdf"), collapse=""), width=6, height=10)#
##par(mfrow=c(3,1), mar=c(2.5,4.25,1.75,0.25))#
par(mar=c(2.5,4.25,1.75,0.25))#
layout(matrix(c(1,1,2,2,3), ncol=1))#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim1, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Robinson Fould distance", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext1, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext1, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
# add p values from 2-sided wilcoxon test#
text(x=c(0.5,1:4), y=rep(p.height1, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height1, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
legend("bottomright", c("10", "20", "40", "80"), pch=15, col=samp.size.col, title = "num. genes", cex=0.875, pt.cex=1.5) # , bg="white"#
# eucl distance#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim2, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Euclidean distance", mgp=c(3,0.9,0))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext2, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext2, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=c(0.5,1:4), y=rep(p.height2, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height2, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
# number partitions#
par(mar=c(2.5,4.25,0.25,0.25))#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim3, xlab="", xaxt="n", ylab="number partitions inferred", main="", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
# AND NOW USING CONSENSUS TREE DISTANCE INSTEAD#
#
par(mar=c(2.5,4.25,1.75,0.25))#
#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim1, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Robinson Fould distance", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext1, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext1, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="cons_rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
# add p values from 2-sided wilcoxon test#
text(x=c(0.5,1:4), y=rep(p.height1, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="cons_rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height1, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
legend("bottomright", c("10", "20", "40", "80"), pch=15, col=samp.size.col, title = "num. genes", cex=0.875, pt.cex=1.5) # , bg="white"#
# eucl distance#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim2, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Euclidean distance", mgp=c(3,0.9,0))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext2, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext2, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="cons_eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=c(0.5,1:4), y=rep(p.height2, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="cons_eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height2, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
#SAME # number partitions#
par(mar=c(2.5,4.25,0.25,0.25))#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim3, xlab="", xaxt="n", ylab="number partitions inferred", main="", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
dev.off()#
}
library(scales)#
setwd("~/Documents/UNIL/PartitioningMethods_SimulationProject/FunctioningPipeline/AnalysisResults")#
make.merge.id <- function(dat){#
	id.col <- rep(NA, dim(dat)[1])#
	for(i in 1:dim(dat)[1]){#
		if(length(grep("lopho", dat$file[i])) > 0) spp <- "lopho_"#
		if(length(grep("myria", dat$file[i])) > 0) spp <- "myria_"#
		if(length(grep("10", dat$file[i])) > 0) samp <- "10_"#
		if(length(grep("20", dat$file[i])) > 0) samp <- "20_"#
		if(length(grep("40", dat$file[i])) > 0) samp <- "40_"#
		if(length(grep("80", dat$file[i])) > 0) samp <- "80_"#
		if(length(grep("rcluster", dat$file[i])) > 0) algo <- "rcluster_"#
		if(length(grep("greedy", dat$file[i])) > 0) algo <- "greedy_"#
		if(length(grep("noPart", dat$file[i])) > 0) algo <- "noPart_"#
		if(length(grep("AIC", dat$file[i])) > 0) crit <- "AIC"#
		if(length(grep("AICc", dat$file[i])) > 0) crit <- "AICc"#
		if(length(grep("BIC", dat$file[i])) > 0) crit <- "BIC"#
		if(length(grep("noPart", dat$file[i])) > 0) crit <- "noPart"#
		id.col[i] <- paste(c(spp, samp, algo, crit), collapse="")#
	}#
	return(id.col)#
}#
#####################################
#
get.rep.difference <- function(dat, rep, samp.size, spp, partitioning.criterion, distance){#
	temp.dat <- dat[dat$replicate == rep & dat$samp.size == samp.size & dat$species == spp , ]#
	no.part.result <- temp.dat[temp.dat$search.algo == "noPart" ,]#
	rclust.AIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AIC" ,]#
	rclust.BIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "BIC" ,]#
	rclust.AICc.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AICc",]#
	if(partitioning.criterion == "AIC"){#
		if(dim(rclust.AIC.result[distance])[1] == 0 | dim(no.part.result[distance])[1] == 0){ difference <- NA}#
		else{ difference <- no.part.result[distance] - rclust.AIC.result[distance] }#
	}#
	if(partitioning.criterion == "BIC"){#
		if(dim(rclust.BIC.result[distance])[1] == 0 | dim(no.part.result[distance])[1] == 0){ difference <- NA}#
		else{ difference <- no.part.result[distance] - rclust.BIC.result[distance] }#
	}#
	if(partitioning.criterion == "AICc"){#
		if(dim(rclust.AICc.result[distance])[1] == 0 | dim(no.part.result[distance])[1] == 0){ difference <- NA}#
		else{ difference <- no.part.result[distance] - rclust.AICc.result[distance] }#
	}#
	return(as.numeric(difference))			#
}#
#
#####################################
#
get.boxplot.dat <- function(dat, samp.size, spp, partitioning.criterion, distance){	#
	samp.size.dists <- NULL#
	for(j in unique(dat$replicate)){#
		dist <- get.rep.difference(dat, rep=j, samp.size=samp.size, spp=spp, partitioning.criterion=partitioning.criterion, distance=distance)#
		samp.size.dists <- c(samp.size.dists, dist)#
	}#
	return(samp.size.dists)#
}#
#
#####################################
#
get.partition.dat <- function(dat, samp.size, spp, partitioning.criterion){	#
	partition.numbers <- NULL#
	for(j in unique(dat$replicate)){#
		temp.dat <- dat[dat$replicate == j & dat$samp.size == samp.size & dat$species == spp , ]#
		rclust.AIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AIC" ,]#
		rclust.BIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "BIC" ,]#
		rclust.AICc.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AICc",]#
		if(partitioning.criterion == "AIC"){#
			if(length(rclust.AIC.result$num.partitions)[1] == 0){ num.parts <- NA}#
			else{ num.parts <- rclust.AIC.result$num.partitions }#
		}#
		if(partitioning.criterion == "BIC"){#
			if(length(rclust.BIC.result$num.partitions)[1] == 0){ num.parts <- NA}#
			else{ num.parts <- rclust.BIC.result$num.partitions }#
		}#
		if(partitioning.criterion == "AICc"){#
			if(length(rclust.AICc.result$num.partitions)[1] == 0){ num.parts <- NA}#
			else{ num.parts <- rclust.AICc.result$num.partitions }#
		}#
		partition.numbers <- c(partition.numbers, num.parts)#
	}#
	return(partition.numbers)#
}#
#
#####################################
# mut rate 1000#
#
infiles.a <- c("AllStatsOutput_New_Rep1_100-1000.csv",#
				"AllStatsOutput_New_Rep2_100-1000.csv",#
				"AllStatsOutput_New_Rep3_100-1000.csv",#
				"AllStatsOutput_New_Rep4_100-1000.csv",#
				"AllStatsOutput_New_Rep5_100-1000.csv",#
				"AllStatsOutput_New_Rep6_100-1000.csv",#
				"AllStatsOutput_Newest_Rep7_100-1000.csv",#
				"AllStatsOutput_Newest_Rep8_100-1000.csv",#
				"AllStatsOutput_Newest_Rep9_100-1000.csv",#
				"AllStatsOutput_Newest_Rep10_100-1000.csv",#
				"AllStatsOutput_Newest_Rep11_100-1000.csv",#
				"AllStatsOutput_Newest_Rep12_100-1000.csv",#
				"AllStatsOutput_Newest_Rep13_100-1000.csv",#
				"AllStatsOutput_Newest_Rep14_100-1000.csv",#
				"AllStatsOutput_Newest_Rep15_100-1000.csv",#
				"AllStatsOutput_Newest_Rep16_100-1000.csv",#
				"AllStatsOutput_Newest_Rep17_100-1000.csv",#
				"AllStatsOutput_Newest_Rep18_100-1000.csv",#
				"AllStatsOutput_Newest_Rep19_100-1000.csv",#
				"AllStatsOutput_Newest_Rep20_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep21_100-1000.csv",#
				"AllStatsOutput_Newest_Rep22_100-1000.csv"#,#
#				"AllStatsOutput_Newest_Rep23_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep24_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep25_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep26_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep27_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep28_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep29_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep30_100-1000.csv"#
				)#
infiles.b <- c("RF_Eucl_results_New_Rep1_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep2_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep3_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep4_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep5_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep6_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep7_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep8_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep9_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep10_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep11_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep12_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep13_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep14_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep15_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep16_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep17_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep18_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep19_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep20_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep21_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep22_100-1000_wConsensus.txt"#,#
#				"RF_Eucl_results_New_Rep23_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep24_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep25_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep26_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep27_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep28_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep29_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep30_100-1000_wConsensus.txt"#
				)#
#
dat <- NULL#
for(i in c(1:5,7:20,22)){#length(infiles.a)){ #**************UNCOMMENT ME FOR ALL REPS#
	temp.dat1 <- read.csv(infiles.a[i], header=TRUE, stringsAsFactors=FALSE)#
	temp.dat1$uniqueID <- paste(temp.dat1$species, temp.dat1$samp.size, temp.dat1$search.algo, temp.dat1$part.IC, sep="_")#
	temp.dat2 <- read.table(infiles.b[i], header=TRUE, stringsAsFactors=FALSE)#
	# because also have consenseus trees now:#
	temp.dat2 <- cbind(temp.dat2[1:32,], temp.dat2[33:64, 2:3])#
	names(temp.dat2) <- c("filename", "rf_dist", "eucl_dist", "cons_rf_dist", "cons_eucl_dist")#
	temp.dat2$uniqueID <- make.merge.id(temp.dat2)#
	temp.dat <- merge(temp.dat1, temp.dat2, by="uniqueID")#
	temp.dat$gene.size <- 100#
	temp.dat$mut.rate <- 1000#
	temp.dat$replicate <- i#
	dat <- rbind(dat, temp.dat)#
}#
#
no.part.dat <- dat[dat$part.IC == "noPart" ,]#
## IS there a statistically significant difference between the RF/eucl distance to true tree of no partitioning vs with partitioning??#
# compare at each sample size, for each species, for both RF and euclidean distance#
#
spp <- c("myria", "lopho")#
samps <- c(10,20,40,80)#
stat.data.set.BIC <- data.frame(matrix(NA, ncol=14, nrow=8))#
names(stat.data.set.BIC) <- c("species", "samp.size", "rf_twoside_p", "rf_less_p", "rf_greater_p", "eucl_twoside_p", "eucl_less_p", "eucl_greater_p", "cons_rf_twoside_p", "cons_rf_less_p", "cons_rf_greater_p", "cons_eucl_twoside_p", "cons_eucl_less_p", "cons_eucl_greater_p")#
#
iterate <- 1#
for(j in spp){#
	for(k in samps){#
		temp.dat.no.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "noPart" , ]#
		temp.dat.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "BIC" , ]#
		rf_ts_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		rf_less_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		rf_greater_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		eucl_ts_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		eucl_less_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		eucl_greater_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
#
		# also for the consensus tree#
		cons_rf_ts_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		cons_rf_less_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		cons_rf_greater_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		cons_eucl_ts_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		cons_eucl_less_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		cons_eucl_greater_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
		stat.data.set.BIC[iterate, ] <- c(j, k, rf_ts_p, rf_less_p, rf_greater_p, eucl_ts_p, eucl_less_p, eucl_greater_p, cons_rf_ts_p, cons_rf_less_p, cons_rf_greater_p, cons_eucl_ts_p, cons_eucl_less_p, cons_eucl_greater_p)#
		iterate <- iterate + 1#
	}#
}#
## AIC STATS#
#
spp <- c("myria", "lopho")#
samps <- c(10,20,40,80)#
stat.data.set.AIC <- data.frame(matrix(NA, ncol=14, nrow=8))#
names(stat.data.set.AIC) <- c("species", "samp.size", "rf_twoside_p", "rf_less_p", "rf_greater_p", "eucl_twoside_p", "eucl_less_p", "eucl_greater_p", "cons_rf_twoside_p", "cons_rf_less_p", "cons_rf_greater_p", "cons_eucl_twoside_p", "cons_eucl_less_p", "cons_eucl_greater_p")#
#
iterate <- 1#
for(j in spp){#
	for(k in samps){#
		temp.dat.no.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "noPart" , ]#
		temp.dat.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "AIC" , ]#
		rf_ts_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		rf_less_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		rf_greater_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		eucl_ts_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		eucl_less_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		eucl_greater_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
#
		# also for the consensus tree#
		cons_rf_ts_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		cons_rf_less_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		cons_rf_greater_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		cons_eucl_ts_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		cons_eucl_less_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		cons_eucl_greater_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
		stat.data.set.AIC[iterate, ] <- c(j, k, rf_ts_p, rf_less_p, rf_greater_p, eucl_ts_p, eucl_less_p, eucl_greater_p, cons_rf_ts_p, cons_rf_less_p, cons_rf_greater_p, cons_eucl_ts_p, cons_eucl_less_p, cons_eucl_greater_p)#
		iterate <- iterate + 1#
	}#
}#
### AICc STATS#
#
spp <- c("myria", "lopho")#
samps <- c(10,20,40,80)#
stat.data.set.AICc <- data.frame(matrix(NA, ncol=14, nrow=8))#
names(stat.data.set.AICc) <- c("species", "samp.size", "rf_twoside_p", "rf_less_p", "rf_greater_p", "eucl_twoside_p", "eucl_less_p", "eucl_greater_p", "cons_rf_twoside_p", "cons_rf_less_p", "cons_rf_greater_p", "cons_eucl_twoside_p", "cons_eucl_less_p", "cons_eucl_greater_p")#
#
iterate <- 1#
for(j in spp){#
	for(k in samps){#
		temp.dat.no.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "noPart" , ]#
		temp.dat.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "AICc" , ]#
		rf_ts_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		rf_less_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		rf_greater_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		eucl_ts_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		eucl_less_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		eucl_greater_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
#
		# also for the consensus tree#
		cons_rf_ts_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		cons_rf_less_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		cons_rf_greater_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		cons_eucl_ts_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		cons_eucl_less_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		cons_eucl_greater_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
		stat.data.set.AICc[iterate, ] <- c(j, k, rf_ts_p, rf_less_p, rf_greater_p, eucl_ts_p, eucl_less_p, eucl_greater_p, cons_rf_ts_p, cons_rf_less_p, cons_rf_greater_p, cons_eucl_ts_p, cons_eucl_less_p, cons_eucl_greater_p)#
		iterate <- iterate + 1#
	}#
}#
#####################################
samp.size.col <- c("steelblue4", "darkorange2", "green4", "red3")#
outline.col <- "gray30"#
samp.sizes <- c(10,20,40,80)#
#####################################
ylim1 <- c(-0.155, 0.155)#
ylim2 <- c(-1.35, 1.35)#
ylim3 <- c(0.5,10)#
box.width <- 1#
line.type <- 1#
line.width <- 1.75#
ytext1 <- 0.13#
ytext2 <- 1.075#
p.height1 <- 0.15#
p.height2 <- 1.3#
criteria <- c("AIC", "BIC", "AICc")#
for(criterion in criteria){#
#
if(criterion == "AIC") stat.data.set <- stat.data.set.AIC#
if(criterion == "BIC") stat.data.set <- stat.data.set.BIC#
if(criterion == "AICc") stat.data.set <- stat.data.set.AICc#
part.crit <- criterion#
#
pdf(paste(c("Results_Plots/Boxplots_", part.crit, "_StatsParts.pdf"), collapse=""), width=6, height=10)#
##par(mfrow=c(3,1), mar=c(2.5,4.25,1.75,0.25))#
par(mar=c(2.5,4.25,1.75,0.25))#
layout(matrix(c(1,1,2,2,3), ncol=1))#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim1, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Robinson Fould distance", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext1, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext1, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
# add p values from 2-sided wilcoxon test#
text(x=c(0.5,1:4), y=rep(p.height1, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height1, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
legend("bottomright", c("10", "20", "40", "80"), pch=15, col=samp.size.col, title = "num. genes", cex=0.875, pt.cex=1.5) # , bg="white"#
# eucl distance#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim2, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Euclidean distance", mgp=c(3,0.9,0))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext2, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext2, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=c(0.5,1:4), y=rep(p.height2, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height2, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
# number partitions#
par(mar=c(2.5,4.25,0.25,0.25))#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim3, xlab="", xaxt="n", ylab="number partitions inferred", main="", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
# AND NOW USING CONSENSUS TREE DISTANCE INSTEAD#
#
par(mar=c(2.5,4.25,1.75,0.25))#
#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim1, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Robinson Fould distance", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext1, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext1, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="cons_rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
# add p values from 2-sided wilcoxon test#
text(x=c(0.5,1:4), y=rep(p.height1, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="cons_rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height1, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
legend("bottomright", c("10", "20", "40", "80"), pch=15, col=samp.size.col, title = "num. genes", cex=0.875, pt.cex=1.5) # , bg="white"#
# eucl distance#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim2, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Euclidean distance", mgp=c(3,0.9,0))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext2, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext2, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="cons_eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=c(0.5,1:4), y=rep(p.height2, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="cons_eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height2, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
#SAME # number partitions#
par(mar=c(2.5,4.25,0.25,0.25))#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim3, xlab="", xaxt="n", ylab="number partitions inferred", main="", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
dev.off()#
}
library(scales)#
setwd("~/Documents/UNIL/PartitioningMethods_SimulationProject/FunctioningPipeline/AnalysisResults")#
make.merge.id <- function(dat){#
	id.col <- rep(NA, dim(dat)[1])#
	for(i in 1:dim(dat)[1]){#
		if(length(grep("lopho", dat$file[i])) > 0) spp <- "lopho_"#
		if(length(grep("myria", dat$file[i])) > 0) spp <- "myria_"#
		if(length(grep("10", dat$file[i])) > 0) samp <- "10_"#
		if(length(grep("20", dat$file[i])) > 0) samp <- "20_"#
		if(length(grep("40", dat$file[i])) > 0) samp <- "40_"#
		if(length(grep("80", dat$file[i])) > 0) samp <- "80_"#
		if(length(grep("rcluster", dat$file[i])) > 0) algo <- "rcluster_"#
		if(length(grep("greedy", dat$file[i])) > 0) algo <- "greedy_"#
		if(length(grep("noPart", dat$file[i])) > 0) algo <- "noPart_"#
		if(length(grep("AIC", dat$file[i])) > 0) crit <- "AIC"#
		if(length(grep("AICc", dat$file[i])) > 0) crit <- "AICc"#
		if(length(grep("BIC", dat$file[i])) > 0) crit <- "BIC"#
		if(length(grep("noPart", dat$file[i])) > 0) crit <- "noPart"#
		id.col[i] <- paste(c(spp, samp, algo, crit), collapse="")#
	}#
	return(id.col)#
}#
#####################################
#
get.rep.difference <- function(dat, rep, samp.size, spp, partitioning.criterion, distance){#
	temp.dat <- dat[dat$replicate == rep & dat$samp.size == samp.size & dat$species == spp , ]#
	no.part.result <- temp.dat[temp.dat$search.algo == "noPart" ,]#
	rclust.AIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AIC" ,]#
	rclust.BIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "BIC" ,]#
	rclust.AICc.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AICc",]#
	if(partitioning.criterion == "AIC"){#
		if(dim(rclust.AIC.result[distance])[1] == 0 | dim(no.part.result[distance])[1] == 0){ difference <- NA}#
		else{ difference <- no.part.result[distance] - rclust.AIC.result[distance] }#
	}#
	if(partitioning.criterion == "BIC"){#
		if(dim(rclust.BIC.result[distance])[1] == 0 | dim(no.part.result[distance])[1] == 0){ difference <- NA}#
		else{ difference <- no.part.result[distance] - rclust.BIC.result[distance] }#
	}#
	if(partitioning.criterion == "AICc"){#
		if(dim(rclust.AICc.result[distance])[1] == 0 | dim(no.part.result[distance])[1] == 0){ difference <- NA}#
		else{ difference <- no.part.result[distance] - rclust.AICc.result[distance] }#
	}#
	return(as.numeric(difference))			#
}#
#
#####################################
#
get.boxplot.dat <- function(dat, samp.size, spp, partitioning.criterion, distance){	#
	samp.size.dists <- NULL#
	for(j in unique(dat$replicate)){#
		dist <- get.rep.difference(dat, rep=j, samp.size=samp.size, spp=spp, partitioning.criterion=partitioning.criterion, distance=distance)#
		samp.size.dists <- c(samp.size.dists, dist)#
	}#
	return(samp.size.dists)#
}#
#
#####################################
#
get.partition.dat <- function(dat, samp.size, spp, partitioning.criterion){	#
	partition.numbers <- NULL#
	for(j in unique(dat$replicate)){#
		temp.dat <- dat[dat$replicate == j & dat$samp.size == samp.size & dat$species == spp , ]#
		rclust.AIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AIC" ,]#
		rclust.BIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "BIC" ,]#
		rclust.AICc.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AICc",]#
		if(partitioning.criterion == "AIC"){#
			if(length(rclust.AIC.result$num.partitions)[1] == 0){ num.parts <- NA}#
			else{ num.parts <- rclust.AIC.result$num.partitions }#
		}#
		if(partitioning.criterion == "BIC"){#
			if(length(rclust.BIC.result$num.partitions)[1] == 0){ num.parts <- NA}#
			else{ num.parts <- rclust.BIC.result$num.partitions }#
		}#
		if(partitioning.criterion == "AICc"){#
			if(length(rclust.AICc.result$num.partitions)[1] == 0){ num.parts <- NA}#
			else{ num.parts <- rclust.AICc.result$num.partitions }#
		}#
		partition.numbers <- c(partition.numbers, num.parts)#
	}#
	return(partition.numbers)#
}#
#
#####################################
# mut rate 1000#
#
infiles.a <- c("AllStatsOutput_New_Rep1_100-1000.csv",#
				"AllStatsOutput_New_Rep2_100-1000.csv",#
				"AllStatsOutput_New_Rep3_100-1000.csv",#
				"AllStatsOutput_New_Rep4_100-1000.csv",#
				"AllStatsOutput_New_Rep5_100-1000.csv",#
				"AllStatsOutput_New_Rep6_100-1000.csv",#
				"AllStatsOutput_Newest_Rep7_100-1000.csv",#
				"AllStatsOutput_Newest_Rep8_100-1000.csv",#
				"AllStatsOutput_Newest_Rep9_100-1000.csv",#
				"AllStatsOutput_Newest_Rep10_100-1000.csv",#
				"AllStatsOutput_Newest_Rep11_100-1000.csv",#
				"AllStatsOutput_Newest_Rep12_100-1000.csv",#
				"AllStatsOutput_Newest_Rep13_100-1000.csv",#
				"AllStatsOutput_Newest_Rep14_100-1000.csv",#
				"AllStatsOutput_Newest_Rep15_100-1000.csv",#
				"AllStatsOutput_Newest_Rep16_100-1000.csv",#
				"AllStatsOutput_Newest_Rep17_100-1000.csv",#
				"AllStatsOutput_Newest_Rep18_100-1000.csv",#
				"AllStatsOutput_Newest_Rep19_100-1000.csv",#
				"AllStatsOutput_Newest_Rep20_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep21_100-1000.csv",#
				"AllStatsOutput_Newest_Rep22_100-1000.csv"#,#
#				"AllStatsOutput_Newest_Rep23_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep24_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep25_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep26_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep27_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep28_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep29_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep30_100-1000.csv"#
				)#
infiles.b <- c("RF_Eucl_results_New_Rep1_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep2_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep3_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep4_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep5_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep6_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep7_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep8_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep9_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep10_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep11_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep12_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep13_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep14_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep15_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep16_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep17_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep18_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep19_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep20_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep21_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep22_100-1000_wConsensus.txt"#,#
#				"RF_Eucl_results_New_Rep23_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep24_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep25_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep26_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep27_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep28_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep29_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep30_100-1000_wConsensus.txt"#
				)#
#
dat <- NULL#
for(i in c(1:20,22)){#length(infiles.a)){ #**************UNCOMMENT ME FOR ALL REPS#
	temp.dat1 <- read.csv(infiles.a[i], header=TRUE, stringsAsFactors=FALSE)#
	temp.dat1$uniqueID <- paste(temp.dat1$species, temp.dat1$samp.size, temp.dat1$search.algo, temp.dat1$part.IC, sep="_")#
	temp.dat2 <- read.table(infiles.b[i], header=TRUE, stringsAsFactors=FALSE)#
	# because also have consenseus trees now:#
	temp.dat2 <- cbind(temp.dat2[1:32,], temp.dat2[33:64, 2:3])#
	names(temp.dat2) <- c("filename", "rf_dist", "eucl_dist", "cons_rf_dist", "cons_eucl_dist")#
	temp.dat2$uniqueID <- make.merge.id(temp.dat2)#
	temp.dat <- merge(temp.dat1, temp.dat2, by="uniqueID")#
	temp.dat$gene.size <- 100#
	temp.dat$mut.rate <- 1000#
	temp.dat$replicate <- i#
	dat <- rbind(dat, temp.dat)#
}#
#
no.part.dat <- dat[dat$part.IC == "noPart" ,]#
## IS there a statistically significant difference between the RF/eucl distance to true tree of no partitioning vs with partitioning??#
# compare at each sample size, for each species, for both RF and euclidean distance#
#
spp <- c("myria", "lopho")#
samps <- c(10,20,40,80)#
stat.data.set.BIC <- data.frame(matrix(NA, ncol=14, nrow=8))#
names(stat.data.set.BIC) <- c("species", "samp.size", "rf_twoside_p", "rf_less_p", "rf_greater_p", "eucl_twoside_p", "eucl_less_p", "eucl_greater_p", "cons_rf_twoside_p", "cons_rf_less_p", "cons_rf_greater_p", "cons_eucl_twoside_p", "cons_eucl_less_p", "cons_eucl_greater_p")#
#
iterate <- 1#
for(j in spp){#
	for(k in samps){#
		temp.dat.no.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "noPart" , ]#
		temp.dat.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "BIC" , ]#
		rf_ts_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		rf_less_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		rf_greater_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		eucl_ts_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		eucl_less_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		eucl_greater_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
#
		# also for the consensus tree#
		cons_rf_ts_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		cons_rf_less_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		cons_rf_greater_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		cons_eucl_ts_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		cons_eucl_less_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		cons_eucl_greater_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
		stat.data.set.BIC[iterate, ] <- c(j, k, rf_ts_p, rf_less_p, rf_greater_p, eucl_ts_p, eucl_less_p, eucl_greater_p, cons_rf_ts_p, cons_rf_less_p, cons_rf_greater_p, cons_eucl_ts_p, cons_eucl_less_p, cons_eucl_greater_p)#
		iterate <- iterate + 1#
	}#
}#
## AIC STATS#
#
spp <- c("myria", "lopho")#
samps <- c(10,20,40,80)#
stat.data.set.AIC <- data.frame(matrix(NA, ncol=14, nrow=8))#
names(stat.data.set.AIC) <- c("species", "samp.size", "rf_twoside_p", "rf_less_p", "rf_greater_p", "eucl_twoside_p", "eucl_less_p", "eucl_greater_p", "cons_rf_twoside_p", "cons_rf_less_p", "cons_rf_greater_p", "cons_eucl_twoside_p", "cons_eucl_less_p", "cons_eucl_greater_p")#
#
iterate <- 1#
for(j in spp){#
	for(k in samps){#
		temp.dat.no.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "noPart" , ]#
		temp.dat.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "AIC" , ]#
		rf_ts_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		rf_less_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		rf_greater_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		eucl_ts_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		eucl_less_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		eucl_greater_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
#
		# also for the consensus tree#
		cons_rf_ts_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		cons_rf_less_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		cons_rf_greater_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		cons_eucl_ts_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		cons_eucl_less_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		cons_eucl_greater_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
		stat.data.set.AIC[iterate, ] <- c(j, k, rf_ts_p, rf_less_p, rf_greater_p, eucl_ts_p, eucl_less_p, eucl_greater_p, cons_rf_ts_p, cons_rf_less_p, cons_rf_greater_p, cons_eucl_ts_p, cons_eucl_less_p, cons_eucl_greater_p)#
		iterate <- iterate + 1#
	}#
}#
### AICc STATS#
#
spp <- c("myria", "lopho")#
samps <- c(10,20,40,80)#
stat.data.set.AICc <- data.frame(matrix(NA, ncol=14, nrow=8))#
names(stat.data.set.AICc) <- c("species", "samp.size", "rf_twoside_p", "rf_less_p", "rf_greater_p", "eucl_twoside_p", "eucl_less_p", "eucl_greater_p", "cons_rf_twoside_p", "cons_rf_less_p", "cons_rf_greater_p", "cons_eucl_twoside_p", "cons_eucl_less_p", "cons_eucl_greater_p")#
#
iterate <- 1#
for(j in spp){#
	for(k in samps){#
		temp.dat.no.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "noPart" , ]#
		temp.dat.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "AICc" , ]#
		rf_ts_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		rf_less_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		rf_greater_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		eucl_ts_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		eucl_less_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		eucl_greater_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
#
		# also for the consensus tree#
		cons_rf_ts_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		cons_rf_less_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		cons_rf_greater_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		cons_eucl_ts_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		cons_eucl_less_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		cons_eucl_greater_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
		stat.data.set.AICc[iterate, ] <- c(j, k, rf_ts_p, rf_less_p, rf_greater_p, eucl_ts_p, eucl_less_p, eucl_greater_p, cons_rf_ts_p, cons_rf_less_p, cons_rf_greater_p, cons_eucl_ts_p, cons_eucl_less_p, cons_eucl_greater_p)#
		iterate <- iterate + 1#
	}#
}#
#####################################
samp.size.col <- c("steelblue4", "darkorange2", "green4", "red3")#
outline.col <- "gray30"#
samp.sizes <- c(10,20,40,80)#
#####################################
ylim1 <- c(-0.155, 0.155)#
ylim2 <- c(-1.35, 1.35)#
ylim3 <- c(0.5,10)#
box.width <- 1#
line.type <- 1#
line.width <- 1.75#
ytext1 <- 0.13#
ytext2 <- 1.075#
p.height1 <- 0.15#
p.height2 <- 1.3#
criteria <- c("AIC", "BIC", "AICc")#
for(criterion in criteria){#
#
if(criterion == "AIC") stat.data.set <- stat.data.set.AIC#
if(criterion == "BIC") stat.data.set <- stat.data.set.BIC#
if(criterion == "AICc") stat.data.set <- stat.data.set.AICc#
part.crit <- criterion#
#
pdf(paste(c("Results_Plots/Boxplots_", part.crit, "_StatsParts.pdf"), collapse=""), width=6, height=10)#
##par(mfrow=c(3,1), mar=c(2.5,4.25,1.75,0.25))#
par(mar=c(2.5,4.25,1.75,0.25))#
layout(matrix(c(1,1,2,2,3), ncol=1))#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim1, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Robinson Fould distance", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext1, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext1, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
# add p values from 2-sided wilcoxon test#
text(x=c(0.5,1:4), y=rep(p.height1, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height1, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
legend("bottomright", c("10", "20", "40", "80"), pch=15, col=samp.size.col, title = "num. genes", cex=0.875, pt.cex=1.5) # , bg="white"#
# eucl distance#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim2, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Euclidean distance", mgp=c(3,0.9,0))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext2, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext2, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=c(0.5,1:4), y=rep(p.height2, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height2, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
# number partitions#
par(mar=c(2.5,4.25,0.25,0.25))#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim3, xlab="", xaxt="n", ylab="number partitions inferred", main="", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
# AND NOW USING CONSENSUS TREE DISTANCE INSTEAD#
#
par(mar=c(2.5,4.25,1.75,0.25))#
#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim1, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Robinson Fould distance", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext1, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext1, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="cons_rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
# add p values from 2-sided wilcoxon test#
text(x=c(0.5,1:4), y=rep(p.height1, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="cons_rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height1, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
legend("bottomright", c("10", "20", "40", "80"), pch=15, col=samp.size.col, title = "num. genes", cex=0.875, pt.cex=1.5) # , bg="white"#
# eucl distance#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim2, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Euclidean distance", mgp=c(3,0.9,0))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext2, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext2, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="cons_eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=c(0.5,1:4), y=rep(p.height2, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="cons_eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height2, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
#SAME # number partitions#
par(mar=c(2.5,4.25,0.25,0.25))#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim3, xlab="", xaxt="n", ylab="number partitions inferred", main="", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
dev.off()#
}
library(scales)#
setwd("~/Documents/UNIL/PartitioningMethods_SimulationProject/FunctioningPipeline/AnalysisResults")#
make.merge.id <- function(dat){#
	id.col <- rep(NA, dim(dat)[1])#
	for(i in 1:dim(dat)[1]){#
		if(length(grep("lopho", dat$file[i])) > 0) spp <- "lopho_"#
		if(length(grep("myria", dat$file[i])) > 0) spp <- "myria_"#
		if(length(grep("10", dat$file[i])) > 0) samp <- "10_"#
		if(length(grep("20", dat$file[i])) > 0) samp <- "20_"#
		if(length(grep("40", dat$file[i])) > 0) samp <- "40_"#
		if(length(grep("80", dat$file[i])) > 0) samp <- "80_"#
		if(length(grep("rcluster", dat$file[i])) > 0) algo <- "rcluster_"#
		if(length(grep("greedy", dat$file[i])) > 0) algo <- "greedy_"#
		if(length(grep("noPart", dat$file[i])) > 0) algo <- "noPart_"#
		if(length(grep("AIC", dat$file[i])) > 0) crit <- "AIC"#
		if(length(grep("AICc", dat$file[i])) > 0) crit <- "AICc"#
		if(length(grep("BIC", dat$file[i])) > 0) crit <- "BIC"#
		if(length(grep("noPart", dat$file[i])) > 0) crit <- "noPart"#
		id.col[i] <- paste(c(spp, samp, algo, crit), collapse="")#
	}#
	return(id.col)#
}#
#####################################
#
get.rep.difference <- function(dat, rep, samp.size, spp, partitioning.criterion, distance){#
	temp.dat <- dat[dat$replicate == rep & dat$samp.size == samp.size & dat$species == spp , ]#
	no.part.result <- temp.dat[temp.dat$search.algo == "noPart" ,]#
	rclust.AIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AIC" ,]#
	rclust.BIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "BIC" ,]#
	rclust.AICc.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AICc",]#
	if(partitioning.criterion == "AIC"){#
		if(dim(rclust.AIC.result[distance])[1] == 0 | dim(no.part.result[distance])[1] == 0){ difference <- NA}#
		else{ difference <- no.part.result[distance] - rclust.AIC.result[distance] }#
	}#
	if(partitioning.criterion == "BIC"){#
		if(dim(rclust.BIC.result[distance])[1] == 0 | dim(no.part.result[distance])[1] == 0){ difference <- NA}#
		else{ difference <- no.part.result[distance] - rclust.BIC.result[distance] }#
	}#
	if(partitioning.criterion == "AICc"){#
		if(dim(rclust.AICc.result[distance])[1] == 0 | dim(no.part.result[distance])[1] == 0){ difference <- NA}#
		else{ difference <- no.part.result[distance] - rclust.AICc.result[distance] }#
	}#
	return(as.numeric(difference))			#
}#
#
#####################################
#
get.boxplot.dat <- function(dat, samp.size, spp, partitioning.criterion, distance){	#
	samp.size.dists <- NULL#
	for(j in unique(dat$replicate)){#
		dist <- get.rep.difference(dat, rep=j, samp.size=samp.size, spp=spp, partitioning.criterion=partitioning.criterion, distance=distance)#
		samp.size.dists <- c(samp.size.dists, dist)#
	}#
	return(samp.size.dists)#
}#
#
#####################################
#
get.partition.dat <- function(dat, samp.size, spp, partitioning.criterion){	#
	partition.numbers <- NULL#
	for(j in unique(dat$replicate)){#
		temp.dat <- dat[dat$replicate == j & dat$samp.size == samp.size & dat$species == spp , ]#
		rclust.AIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AIC" ,]#
		rclust.BIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "BIC" ,]#
		rclust.AICc.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AICc",]#
		if(partitioning.criterion == "AIC"){#
			if(length(rclust.AIC.result$num.partitions)[1] == 0){ num.parts <- NA}#
			else{ num.parts <- rclust.AIC.result$num.partitions }#
		}#
		if(partitioning.criterion == "BIC"){#
			if(length(rclust.BIC.result$num.partitions)[1] == 0){ num.parts <- NA}#
			else{ num.parts <- rclust.BIC.result$num.partitions }#
		}#
		if(partitioning.criterion == "AICc"){#
			if(length(rclust.AICc.result$num.partitions)[1] == 0){ num.parts <- NA}#
			else{ num.parts <- rclust.AICc.result$num.partitions }#
		}#
		partition.numbers <- c(partition.numbers, num.parts)#
	}#
	return(partition.numbers)#
}#
#
#####################################
# mut rate 1000#
#
infiles.a <- c("AllStatsOutput_New_Rep1_100-1000.csv",#
				"AllStatsOutput_New_Rep2_100-1000.csv",#
				"AllStatsOutput_New_Rep3_100-1000.csv",#
				"AllStatsOutput_New_Rep4_100-1000.csv",#
				"AllStatsOutput_New_Rep5_100-1000.csv",#
				"AllStatsOutput_New_Rep6_100-1000.csv",#
				"AllStatsOutput_Newest_Rep7_100-1000.csv",#
				"AllStatsOutput_Newest_Rep8_100-1000.csv",#
				"AllStatsOutput_Newest_Rep9_100-1000.csv",#
				"AllStatsOutput_Newest_Rep10_100-1000.csv",#
				"AllStatsOutput_Newest_Rep11_100-1000.csv",#
				"AllStatsOutput_Newest_Rep12_100-1000.csv",#
				"AllStatsOutput_Newest_Rep13_100-1000.csv",#
				"AllStatsOutput_Newest_Rep14_100-1000.csv",#
				"AllStatsOutput_Newest_Rep15_100-1000.csv",#
				"AllStatsOutput_Newest_Rep16_100-1000.csv",#
				"AllStatsOutput_Newest_Rep17_100-1000.csv",#
				"AllStatsOutput_Newest_Rep18_100-1000.csv",#
				"AllStatsOutput_Newest_Rep19_100-1000.csv",#
				"AllStatsOutput_Newest_Rep20_100-1000.csv",#
				"AllStatsOutput_Newest_Rep21_100-1000.csv",#
				"AllStatsOutput_Newest_Rep22_100-1000.csv"#,#
#				"AllStatsOutput_Newest_Rep23_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep24_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep25_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep26_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep27_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep28_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep29_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep30_100-1000.csv"#
				)#
infiles.b <- c("RF_Eucl_results_New_Rep1_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep2_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep3_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep4_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep5_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep6_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep7_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep8_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep9_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep10_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep11_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep12_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep13_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep14_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep15_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep16_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep17_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep18_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep19_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep20_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep21_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep22_100-1000_wConsensus.txt"#,#
#				"RF_Eucl_results_New_Rep23_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep24_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep25_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep26_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep27_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep28_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep29_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep30_100-1000_wConsensus.txt"#
				)#
#
dat <- NULL#
for(i in c(1:22)){#length(infiles.a)){ #**************UNCOMMENT ME FOR ALL REPS#
	temp.dat1 <- read.csv(infiles.a[i], header=TRUE, stringsAsFactors=FALSE)#
	temp.dat1$uniqueID <- paste(temp.dat1$species, temp.dat1$samp.size, temp.dat1$search.algo, temp.dat1$part.IC, sep="_")#
	temp.dat2 <- read.table(infiles.b[i], header=TRUE, stringsAsFactors=FALSE)#
	# because also have consenseus trees now:#
	temp.dat2 <- cbind(temp.dat2[1:32,], temp.dat2[33:64, 2:3])#
	names(temp.dat2) <- c("filename", "rf_dist", "eucl_dist", "cons_rf_dist", "cons_eucl_dist")#
	temp.dat2$uniqueID <- make.merge.id(temp.dat2)#
	temp.dat <- merge(temp.dat1, temp.dat2, by="uniqueID")#
	temp.dat$gene.size <- 100#
	temp.dat$mut.rate <- 1000#
	temp.dat$replicate <- i#
	dat <- rbind(dat, temp.dat)#
}#
#
no.part.dat <- dat[dat$part.IC == "noPart" ,]#
## IS there a statistically significant difference between the RF/eucl distance to true tree of no partitioning vs with partitioning??#
# compare at each sample size, for each species, for both RF and euclidean distance#
#
spp <- c("myria", "lopho")#
samps <- c(10,20,40,80)#
stat.data.set.BIC <- data.frame(matrix(NA, ncol=14, nrow=8))#
names(stat.data.set.BIC) <- c("species", "samp.size", "rf_twoside_p", "rf_less_p", "rf_greater_p", "eucl_twoside_p", "eucl_less_p", "eucl_greater_p", "cons_rf_twoside_p", "cons_rf_less_p", "cons_rf_greater_p", "cons_eucl_twoside_p", "cons_eucl_less_p", "cons_eucl_greater_p")#
#
iterate <- 1#
for(j in spp){#
	for(k in samps){#
		temp.dat.no.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "noPart" , ]#
		temp.dat.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "BIC" , ]#
		rf_ts_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		rf_less_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		rf_greater_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		eucl_ts_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		eucl_less_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		eucl_greater_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
#
		# also for the consensus tree#
		cons_rf_ts_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		cons_rf_less_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		cons_rf_greater_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		cons_eucl_ts_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		cons_eucl_less_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		cons_eucl_greater_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
		stat.data.set.BIC[iterate, ] <- c(j, k, rf_ts_p, rf_less_p, rf_greater_p, eucl_ts_p, eucl_less_p, eucl_greater_p, cons_rf_ts_p, cons_rf_less_p, cons_rf_greater_p, cons_eucl_ts_p, cons_eucl_less_p, cons_eucl_greater_p)#
		iterate <- iterate + 1#
	}#
}#
## AIC STATS#
#
spp <- c("myria", "lopho")#
samps <- c(10,20,40,80)#
stat.data.set.AIC <- data.frame(matrix(NA, ncol=14, nrow=8))#
names(stat.data.set.AIC) <- c("species", "samp.size", "rf_twoside_p", "rf_less_p", "rf_greater_p", "eucl_twoside_p", "eucl_less_p", "eucl_greater_p", "cons_rf_twoside_p", "cons_rf_less_p", "cons_rf_greater_p", "cons_eucl_twoside_p", "cons_eucl_less_p", "cons_eucl_greater_p")#
#
iterate <- 1#
for(j in spp){#
	for(k in samps){#
		temp.dat.no.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "noPart" , ]#
		temp.dat.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "AIC" , ]#
		rf_ts_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		rf_less_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		rf_greater_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		eucl_ts_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		eucl_less_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		eucl_greater_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
#
		# also for the consensus tree#
		cons_rf_ts_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		cons_rf_less_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		cons_rf_greater_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		cons_eucl_ts_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		cons_eucl_less_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		cons_eucl_greater_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
		stat.data.set.AIC[iterate, ] <- c(j, k, rf_ts_p, rf_less_p, rf_greater_p, eucl_ts_p, eucl_less_p, eucl_greater_p, cons_rf_ts_p, cons_rf_less_p, cons_rf_greater_p, cons_eucl_ts_p, cons_eucl_less_p, cons_eucl_greater_p)#
		iterate <- iterate + 1#
	}#
}#
### AICc STATS#
#
spp <- c("myria", "lopho")#
samps <- c(10,20,40,80)#
stat.data.set.AICc <- data.frame(matrix(NA, ncol=14, nrow=8))#
names(stat.data.set.AICc) <- c("species", "samp.size", "rf_twoside_p", "rf_less_p", "rf_greater_p", "eucl_twoside_p", "eucl_less_p", "eucl_greater_p", "cons_rf_twoside_p", "cons_rf_less_p", "cons_rf_greater_p", "cons_eucl_twoside_p", "cons_eucl_less_p", "cons_eucl_greater_p")#
#
iterate <- 1#
for(j in spp){#
	for(k in samps){#
		temp.dat.no.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "noPart" , ]#
		temp.dat.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "AICc" , ]#
		rf_ts_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		rf_less_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		rf_greater_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		eucl_ts_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		eucl_less_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		eucl_greater_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
#
		# also for the consensus tree#
		cons_rf_ts_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		cons_rf_less_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		cons_rf_greater_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		cons_eucl_ts_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		cons_eucl_less_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		cons_eucl_greater_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
		stat.data.set.AICc[iterate, ] <- c(j, k, rf_ts_p, rf_less_p, rf_greater_p, eucl_ts_p, eucl_less_p, eucl_greater_p, cons_rf_ts_p, cons_rf_less_p, cons_rf_greater_p, cons_eucl_ts_p, cons_eucl_less_p, cons_eucl_greater_p)#
		iterate <- iterate + 1#
	}#
}#
#####################################
samp.size.col <- c("steelblue4", "darkorange2", "green4", "red3")#
outline.col <- "gray30"#
samp.sizes <- c(10,20,40,80)#
#####################################
ylim1 <- c(-0.155, 0.155)#
ylim2 <- c(-1.35, 1.35)#
ylim3 <- c(0.5,10)#
box.width <- 1#
line.type <- 1#
line.width <- 1.75#
ytext1 <- 0.13#
ytext2 <- 1.075#
p.height1 <- 0.15#
p.height2 <- 1.3#
criteria <- c("AIC", "BIC", "AICc")#
for(criterion in criteria){#
#
if(criterion == "AIC") stat.data.set <- stat.data.set.AIC#
if(criterion == "BIC") stat.data.set <- stat.data.set.BIC#
if(criterion == "AICc") stat.data.set <- stat.data.set.AICc#
part.crit <- criterion#
#
pdf(paste(c("Results_Plots/Boxplots_", part.crit, "_StatsParts.pdf"), collapse=""), width=6, height=10)#
##par(mfrow=c(3,1), mar=c(2.5,4.25,1.75,0.25))#
par(mar=c(2.5,4.25,1.75,0.25))#
layout(matrix(c(1,1,2,2,3), ncol=1))#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim1, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Robinson Fould distance", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext1, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext1, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
# add p values from 2-sided wilcoxon test#
text(x=c(0.5,1:4), y=rep(p.height1, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height1, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
legend("bottomright", c("10", "20", "40", "80"), pch=15, col=samp.size.col, title = "num. genes", cex=0.875, pt.cex=1.5) # , bg="white"#
# eucl distance#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim2, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Euclidean distance", mgp=c(3,0.9,0))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext2, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext2, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=c(0.5,1:4), y=rep(p.height2, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height2, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
# number partitions#
par(mar=c(2.5,4.25,0.25,0.25))#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim3, xlab="", xaxt="n", ylab="number partitions inferred", main="", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
# AND NOW USING CONSENSUS TREE DISTANCE INSTEAD#
#
par(mar=c(2.5,4.25,1.75,0.25))#
#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim1, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Robinson Fould distance", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext1, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext1, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="cons_rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
# add p values from 2-sided wilcoxon test#
text(x=c(0.5,1:4), y=rep(p.height1, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="cons_rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height1, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
legend("bottomright", c("10", "20", "40", "80"), pch=15, col=samp.size.col, title = "num. genes", cex=0.875, pt.cex=1.5) # , bg="white"#
# eucl distance#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim2, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Euclidean distance", mgp=c(3,0.9,0))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext2, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext2, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="cons_eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=c(0.5,1:4), y=rep(p.height2, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="cons_eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height2, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
#SAME # number partitions#
par(mar=c(2.5,4.25,0.25,0.25))#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim3, xlab="", xaxt="n", ylab="number partitions inferred", main="", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
dev.off()#
}
library(scales)#
setwd("~/Documents/UNIL/PartitioningMethods_SimulationProject/FunctioningPipeline/AnalysisResults")#
make.merge.id <- function(dat){#
	id.col <- rep(NA, dim(dat)[1])#
	for(i in 1:dim(dat)[1]){#
		if(length(grep("lopho", dat$file[i])) > 0) spp <- "lopho_"#
		if(length(grep("myria", dat$file[i])) > 0) spp <- "myria_"#
		if(length(grep("10", dat$file[i])) > 0) samp <- "10_"#
		if(length(grep("20", dat$file[i])) > 0) samp <- "20_"#
		if(length(grep("40", dat$file[i])) > 0) samp <- "40_"#
		if(length(grep("80", dat$file[i])) > 0) samp <- "80_"#
		if(length(grep("rcluster", dat$file[i])) > 0) algo <- "rcluster_"#
		if(length(grep("greedy", dat$file[i])) > 0) algo <- "greedy_"#
		if(length(grep("noPart", dat$file[i])) > 0) algo <- "noPart_"#
		if(length(grep("AIC", dat$file[i])) > 0) crit <- "AIC"#
		if(length(grep("AICc", dat$file[i])) > 0) crit <- "AICc"#
		if(length(grep("BIC", dat$file[i])) > 0) crit <- "BIC"#
		if(length(grep("noPart", dat$file[i])) > 0) crit <- "noPart"#
		id.col[i] <- paste(c(spp, samp, algo, crit), collapse="")#
	}#
	return(id.col)#
}#
#####################################
#
get.rep.difference <- function(dat, rep, samp.size, spp, partitioning.criterion, distance){#
	temp.dat <- dat[dat$replicate == rep & dat$samp.size == samp.size & dat$species == spp , ]#
	no.part.result <- temp.dat[temp.dat$search.algo == "noPart" ,]#
	rclust.AIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AIC" ,]#
	rclust.BIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "BIC" ,]#
	rclust.AICc.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AICc",]#
	if(partitioning.criterion == "AIC"){#
		if(dim(rclust.AIC.result[distance])[1] == 0 | dim(no.part.result[distance])[1] == 0){ difference <- NA}#
		else{ difference <- no.part.result[distance] - rclust.AIC.result[distance] }#
	}#
	if(partitioning.criterion == "BIC"){#
		if(dim(rclust.BIC.result[distance])[1] == 0 | dim(no.part.result[distance])[1] == 0){ difference <- NA}#
		else{ difference <- no.part.result[distance] - rclust.BIC.result[distance] }#
	}#
	if(partitioning.criterion == "AICc"){#
		if(dim(rclust.AICc.result[distance])[1] == 0 | dim(no.part.result[distance])[1] == 0){ difference <- NA}#
		else{ difference <- no.part.result[distance] - rclust.AICc.result[distance] }#
	}#
	return(as.numeric(difference))			#
}#
#
#####################################
#
get.boxplot.dat <- function(dat, samp.size, spp, partitioning.criterion, distance){	#
	samp.size.dists <- NULL#
	for(j in unique(dat$replicate)){#
		dist <- get.rep.difference(dat, rep=j, samp.size=samp.size, spp=spp, partitioning.criterion=partitioning.criterion, distance=distance)#
		samp.size.dists <- c(samp.size.dists, dist)#
	}#
	return(samp.size.dists)#
}#
#
#####################################
#
get.partition.dat <- function(dat, samp.size, spp, partitioning.criterion){	#
	partition.numbers <- NULL#
	for(j in unique(dat$replicate)){#
		temp.dat <- dat[dat$replicate == j & dat$samp.size == samp.size & dat$species == spp , ]#
		rclust.AIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AIC" ,]#
		rclust.BIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "BIC" ,]#
		rclust.AICc.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AICc",]#
		if(partitioning.criterion == "AIC"){#
			if(length(rclust.AIC.result$num.partitions)[1] == 0){ num.parts <- NA}#
			else{ num.parts <- rclust.AIC.result$num.partitions }#
		}#
		if(partitioning.criterion == "BIC"){#
			if(length(rclust.BIC.result$num.partitions)[1] == 0){ num.parts <- NA}#
			else{ num.parts <- rclust.BIC.result$num.partitions }#
		}#
		if(partitioning.criterion == "AICc"){#
			if(length(rclust.AICc.result$num.partitions)[1] == 0){ num.parts <- NA}#
			else{ num.parts <- rclust.AICc.result$num.partitions }#
		}#
		partition.numbers <- c(partition.numbers, num.parts)#
	}#
	return(partition.numbers)#
}#
#
#####################################
# mut rate 1000#
#
infiles.a <- c("AllStatsOutput_New_Rep1_100-1000.csv",#
				"AllStatsOutput_New_Rep2_100-1000.csv",#
				"AllStatsOutput_New_Rep3_100-1000.csv",#
				"AllStatsOutput_New_Rep4_100-1000.csv",#
				"AllStatsOutput_New_Rep5_100-1000.csv",#
				"AllStatsOutput_New_Rep6_100-1000.csv",#
				"AllStatsOutput_Newest_Rep7_100-1000.csv",#
				"AllStatsOutput_Newest_Rep8_100-1000.csv",#
				"AllStatsOutput_Newest_Rep9_100-1000.csv",#
				"AllStatsOutput_Newest_Rep10_100-1000.csv",#
				"AllStatsOutput_Newest_Rep11_100-1000.csv",#
				"AllStatsOutput_Newest_Rep12_100-1000.csv",#
				"AllStatsOutput_Newest_Rep13_100-1000.csv",#
				"AllStatsOutput_Newest_Rep14_100-1000.csv",#
				"AllStatsOutput_Newest_Rep15_100-1000.csv",#
				"AllStatsOutput_Newest_Rep16_100-1000.csv",#
				"AllStatsOutput_Newest_Rep17_100-1000.csv",#
				"AllStatsOutput_Newest_Rep18_100-1000.csv",#
				"AllStatsOutput_Newest_Rep19_100-1000.csv",#
				"AllStatsOutput_Newest_Rep20_100-1000.csv",#
				"AllStatsOutput_Newest_Rep21_100-1000.csv",#
				"AllStatsOutput_Newest_Rep22_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep23_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep24_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep25_100-1000.csv",#
				"AllStatsOutput_Newest_Rep26_100-1000.csv"#,#
#				"AllStatsOutput_Newest_Rep27_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep28_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep29_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep30_100-1000.csv"#
				)#
infiles.b <- c("RF_Eucl_results_New_Rep1_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep2_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep3_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep4_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep5_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep6_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep7_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep8_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep9_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep10_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep11_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep12_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep13_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep14_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep15_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep16_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep17_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep18_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep19_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep20_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep21_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep22_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep23_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep24_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep25_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep26_100-1000_wConsensus.txt"#,#
#				"RF_Eucl_results_New_Rep27_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep28_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep29_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep30_100-1000_wConsensus.txt"#
				)#
#
dat <- NULL#
for(i in c(1:22,26)){#length(infiles.a)){ #**************UNCOMMENT ME FOR ALL REPS#
	temp.dat1 <- read.csv(infiles.a[i], header=TRUE, stringsAsFactors=FALSE)#
	temp.dat1$uniqueID <- paste(temp.dat1$species, temp.dat1$samp.size, temp.dat1$search.algo, temp.dat1$part.IC, sep="_")#
	temp.dat2 <- read.table(infiles.b[i], header=TRUE, stringsAsFactors=FALSE)#
	# because also have consenseus trees now:#
	temp.dat2 <- cbind(temp.dat2[1:32,], temp.dat2[33:64, 2:3])#
	names(temp.dat2) <- c("filename", "rf_dist", "eucl_dist", "cons_rf_dist", "cons_eucl_dist")#
	temp.dat2$uniqueID <- make.merge.id(temp.dat2)#
	temp.dat <- merge(temp.dat1, temp.dat2, by="uniqueID")#
	temp.dat$gene.size <- 100#
	temp.dat$mut.rate <- 1000#
	temp.dat$replicate <- i#
	dat <- rbind(dat, temp.dat)#
}#
#
no.part.dat <- dat[dat$part.IC == "noPart" ,]#
## IS there a statistically significant difference between the RF/eucl distance to true tree of no partitioning vs with partitioning??#
# compare at each sample size, for each species, for both RF and euclidean distance#
#
spp <- c("myria", "lopho")#
samps <- c(10,20,40,80)#
stat.data.set.BIC <- data.frame(matrix(NA, ncol=14, nrow=8))#
names(stat.data.set.BIC) <- c("species", "samp.size", "rf_twoside_p", "rf_less_p", "rf_greater_p", "eucl_twoside_p", "eucl_less_p", "eucl_greater_p", "cons_rf_twoside_p", "cons_rf_less_p", "cons_rf_greater_p", "cons_eucl_twoside_p", "cons_eucl_less_p", "cons_eucl_greater_p")#
#
iterate <- 1#
for(j in spp){#
	for(k in samps){#
		temp.dat.no.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "noPart" , ]#
		temp.dat.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "BIC" , ]#
		rf_ts_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		rf_less_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		rf_greater_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		eucl_ts_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		eucl_less_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		eucl_greater_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
#
		# also for the consensus tree#
		cons_rf_ts_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		cons_rf_less_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		cons_rf_greater_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		cons_eucl_ts_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		cons_eucl_less_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		cons_eucl_greater_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
		stat.data.set.BIC[iterate, ] <- c(j, k, rf_ts_p, rf_less_p, rf_greater_p, eucl_ts_p, eucl_less_p, eucl_greater_p, cons_rf_ts_p, cons_rf_less_p, cons_rf_greater_p, cons_eucl_ts_p, cons_eucl_less_p, cons_eucl_greater_p)#
		iterate <- iterate + 1#
	}#
}#
## AIC STATS#
#
spp <- c("myria", "lopho")#
samps <- c(10,20,40,80)#
stat.data.set.AIC <- data.frame(matrix(NA, ncol=14, nrow=8))#
names(stat.data.set.AIC) <- c("species", "samp.size", "rf_twoside_p", "rf_less_p", "rf_greater_p", "eucl_twoside_p", "eucl_less_p", "eucl_greater_p", "cons_rf_twoside_p", "cons_rf_less_p", "cons_rf_greater_p", "cons_eucl_twoside_p", "cons_eucl_less_p", "cons_eucl_greater_p")#
#
iterate <- 1#
for(j in spp){#
	for(k in samps){#
		temp.dat.no.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "noPart" , ]#
		temp.dat.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "AIC" , ]#
		rf_ts_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		rf_less_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		rf_greater_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		eucl_ts_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		eucl_less_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		eucl_greater_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
#
		# also for the consensus tree#
		cons_rf_ts_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		cons_rf_less_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		cons_rf_greater_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		cons_eucl_ts_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		cons_eucl_less_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		cons_eucl_greater_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
		stat.data.set.AIC[iterate, ] <- c(j, k, rf_ts_p, rf_less_p, rf_greater_p, eucl_ts_p, eucl_less_p, eucl_greater_p, cons_rf_ts_p, cons_rf_less_p, cons_rf_greater_p, cons_eucl_ts_p, cons_eucl_less_p, cons_eucl_greater_p)#
		iterate <- iterate + 1#
	}#
}#
### AICc STATS#
#
spp <- c("myria", "lopho")#
samps <- c(10,20,40,80)#
stat.data.set.AICc <- data.frame(matrix(NA, ncol=14, nrow=8))#
names(stat.data.set.AICc) <- c("species", "samp.size", "rf_twoside_p", "rf_less_p", "rf_greater_p", "eucl_twoside_p", "eucl_less_p", "eucl_greater_p", "cons_rf_twoside_p", "cons_rf_less_p", "cons_rf_greater_p", "cons_eucl_twoside_p", "cons_eucl_less_p", "cons_eucl_greater_p")#
#
iterate <- 1#
for(j in spp){#
	for(k in samps){#
		temp.dat.no.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "noPart" , ]#
		temp.dat.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "AICc" , ]#
		rf_ts_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		rf_less_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		rf_greater_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		eucl_ts_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		eucl_less_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		eucl_greater_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
#
		# also for the consensus tree#
		cons_rf_ts_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		cons_rf_less_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		cons_rf_greater_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		cons_eucl_ts_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		cons_eucl_less_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		cons_eucl_greater_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
		stat.data.set.AICc[iterate, ] <- c(j, k, rf_ts_p, rf_less_p, rf_greater_p, eucl_ts_p, eucl_less_p, eucl_greater_p, cons_rf_ts_p, cons_rf_less_p, cons_rf_greater_p, cons_eucl_ts_p, cons_eucl_less_p, cons_eucl_greater_p)#
		iterate <- iterate + 1#
	}#
}#
#####################################
samp.size.col <- c("steelblue4", "darkorange2", "green4", "red3")#
outline.col <- "gray30"#
samp.sizes <- c(10,20,40,80)#
#####################################
ylim1 <- c(-0.155, 0.155)#
ylim2 <- c(-1.35, 1.35)#
ylim3 <- c(0.5,10)#
box.width <- 1#
line.type <- 1#
line.width <- 1.75#
ytext1 <- 0.13#
ytext2 <- 1.075#
p.height1 <- 0.15#
p.height2 <- 1.3#
criteria <- c("AIC", "BIC", "AICc")#
for(criterion in criteria){#
#
if(criterion == "AIC") stat.data.set <- stat.data.set.AIC#
if(criterion == "BIC") stat.data.set <- stat.data.set.BIC#
if(criterion == "AICc") stat.data.set <- stat.data.set.AICc#
part.crit <- criterion#
#
pdf(paste(c("Results_Plots/Boxplots_", part.crit, "_StatsParts.pdf"), collapse=""), width=6, height=10)#
##par(mfrow=c(3,1), mar=c(2.5,4.25,1.75,0.25))#
par(mar=c(2.5,4.25,1.75,0.25))#
layout(matrix(c(1,1,2,2,3), ncol=1))#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim1, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Robinson Fould distance", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext1, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext1, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
# add p values from 2-sided wilcoxon test#
text(x=c(0.5,1:4), y=rep(p.height1, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height1, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
legend("bottomright", c("10", "20", "40", "80"), pch=15, col=samp.size.col, title = "num. genes", cex=0.875, pt.cex=1.5) # , bg="white"#
# eucl distance#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim2, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Euclidean distance", mgp=c(3,0.9,0))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext2, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext2, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=c(0.5,1:4), y=rep(p.height2, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height2, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
# number partitions#
par(mar=c(2.5,4.25,0.25,0.25))#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim3, xlab="", xaxt="n", ylab="number partitions inferred", main="", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
# AND NOW USING CONSENSUS TREE DISTANCE INSTEAD#
#
par(mar=c(2.5,4.25,1.75,0.25))#
#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim1, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Robinson Fould distance", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext1, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext1, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="cons_rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
# add p values from 2-sided wilcoxon test#
text(x=c(0.5,1:4), y=rep(p.height1, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="cons_rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height1, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
legend("bottomright", c("10", "20", "40", "80"), pch=15, col=samp.size.col, title = "num. genes", cex=0.875, pt.cex=1.5) # , bg="white"#
# eucl distance#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim2, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Euclidean distance", mgp=c(3,0.9,0))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext2, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext2, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="cons_eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=c(0.5,1:4), y=rep(p.height2, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="cons_eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height2, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
#SAME # number partitions#
par(mar=c(2.5,4.25,0.25,0.25))#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim3, xlab="", xaxt="n", ylab="number partitions inferred", main="", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
dev.off()#
}
library(scales)#
setwd("~/Documents/UNIL/PartitioningMethods_SimulationProject/FunctioningPipeline/AnalysisResults")#
make.merge.id <- function(dat){#
	id.col <- rep(NA, dim(dat)[1])#
	for(i in 1:dim(dat)[1]){#
		if(length(grep("lopho", dat$file[i])) > 0) spp <- "lopho_"#
		if(length(grep("myria", dat$file[i])) > 0) spp <- "myria_"#
		if(length(grep("10", dat$file[i])) > 0) samp <- "10_"#
		if(length(grep("20", dat$file[i])) > 0) samp <- "20_"#
		if(length(grep("40", dat$file[i])) > 0) samp <- "40_"#
		if(length(grep("80", dat$file[i])) > 0) samp <- "80_"#
		if(length(grep("rcluster", dat$file[i])) > 0) algo <- "rcluster_"#
		if(length(grep("greedy", dat$file[i])) > 0) algo <- "greedy_"#
		if(length(grep("noPart", dat$file[i])) > 0) algo <- "noPart_"#
		if(length(grep("AIC", dat$file[i])) > 0) crit <- "AIC"#
		if(length(grep("AICc", dat$file[i])) > 0) crit <- "AICc"#
		if(length(grep("BIC", dat$file[i])) > 0) crit <- "BIC"#
		if(length(grep("noPart", dat$file[i])) > 0) crit <- "noPart"#
		id.col[i] <- paste(c(spp, samp, algo, crit), collapse="")#
	}#
	return(id.col)#
}#
#####################################
#
get.rep.difference <- function(dat, rep, samp.size, spp, partitioning.criterion, distance){#
	temp.dat <- dat[dat$replicate == rep & dat$samp.size == samp.size & dat$species == spp , ]#
	no.part.result <- temp.dat[temp.dat$search.algo == "noPart" ,]#
	rclust.AIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AIC" ,]#
	rclust.BIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "BIC" ,]#
	rclust.AICc.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AICc",]#
	if(partitioning.criterion == "AIC"){#
		if(dim(rclust.AIC.result[distance])[1] == 0 | dim(no.part.result[distance])[1] == 0){ difference <- NA}#
		else{ difference <- no.part.result[distance] - rclust.AIC.result[distance] }#
	}#
	if(partitioning.criterion == "BIC"){#
		if(dim(rclust.BIC.result[distance])[1] == 0 | dim(no.part.result[distance])[1] == 0){ difference <- NA}#
		else{ difference <- no.part.result[distance] - rclust.BIC.result[distance] }#
	}#
	if(partitioning.criterion == "AICc"){#
		if(dim(rclust.AICc.result[distance])[1] == 0 | dim(no.part.result[distance])[1] == 0){ difference <- NA}#
		else{ difference <- no.part.result[distance] - rclust.AICc.result[distance] }#
	}#
	return(as.numeric(difference))			#
}#
#
#####################################
#
get.boxplot.dat <- function(dat, samp.size, spp, partitioning.criterion, distance){	#
	samp.size.dists <- NULL#
	for(j in unique(dat$replicate)){#
		dist <- get.rep.difference(dat, rep=j, samp.size=samp.size, spp=spp, partitioning.criterion=partitioning.criterion, distance=distance)#
		samp.size.dists <- c(samp.size.dists, dist)#
	}#
	return(samp.size.dists)#
}#
#
#####################################
#
get.partition.dat <- function(dat, samp.size, spp, partitioning.criterion){	#
	partition.numbers <- NULL#
	for(j in unique(dat$replicate)){#
		temp.dat <- dat[dat$replicate == j & dat$samp.size == samp.size & dat$species == spp , ]#
		rclust.AIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AIC" ,]#
		rclust.BIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "BIC" ,]#
		rclust.AICc.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AICc",]#
		if(partitioning.criterion == "AIC"){#
			if(length(rclust.AIC.result$num.partitions)[1] == 0){ num.parts <- NA}#
			else{ num.parts <- rclust.AIC.result$num.partitions }#
		}#
		if(partitioning.criterion == "BIC"){#
			if(length(rclust.BIC.result$num.partitions)[1] == 0){ num.parts <- NA}#
			else{ num.parts <- rclust.BIC.result$num.partitions }#
		}#
		if(partitioning.criterion == "AICc"){#
			if(length(rclust.AICc.result$num.partitions)[1] == 0){ num.parts <- NA}#
			else{ num.parts <- rclust.AICc.result$num.partitions }#
		}#
		partition.numbers <- c(partition.numbers, num.parts)#
	}#
	return(partition.numbers)#
}#
#
#####################################
# mut rate 1000#
#
infiles.a <- c("AllStatsOutput_New_Rep1_100-1000.csv",#
				"AllStatsOutput_New_Rep2_100-1000.csv",#
				"AllStatsOutput_New_Rep3_100-1000.csv",#
				"AllStatsOutput_New_Rep4_100-1000.csv",#
				"AllStatsOutput_New_Rep5_100-1000.csv",#
				"AllStatsOutput_New_Rep6_100-1000.csv",#
				"AllStatsOutput_Newest_Rep7_100-1000.csv",#
				"AllStatsOutput_Newest_Rep8_100-1000.csv",#
				"AllStatsOutput_Newest_Rep9_100-1000.csv",#
				"AllStatsOutput_Newest_Rep10_100-1000.csv",#
				"AllStatsOutput_Newest_Rep11_100-1000.csv",#
				"AllStatsOutput_Newest_Rep12_100-1000.csv",#
				"AllStatsOutput_Newest_Rep13_100-1000.csv",#
				"AllStatsOutput_Newest_Rep14_100-1000.csv",#
				"AllStatsOutput_Newest_Rep15_100-1000.csv",#
				"AllStatsOutput_Newest_Rep16_100-1000.csv",#
				"AllStatsOutput_Newest_Rep17_100-1000.csv",#
				"AllStatsOutput_Newest_Rep18_100-1000.csv",#
				"AllStatsOutput_Newest_Rep19_100-1000.csv",#
				"AllStatsOutput_Newest_Rep20_100-1000.csv",#
				"AllStatsOutput_Newest_Rep21_100-1000.csv",#
				"AllStatsOutput_Newest_Rep22_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep23_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep24_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep25_100-1000.csv",#
				"AllStatsOutput_Newest_Rep26_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep27_100-1000.csv",#
				"AllStatsOutput_Newest_Rep28_100-1000.csv"#,#
#				"AllStatsOutput_Newest_Rep29_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep30_100-1000.csv"#
				)#
infiles.b <- c("RF_Eucl_results_New_Rep1_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep2_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep3_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep4_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep5_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep6_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep7_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep8_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep9_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep10_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep11_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep12_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep13_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep14_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep15_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep16_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep17_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep18_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep19_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep20_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep21_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep22_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep23_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep24_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep25_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep26_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep27_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep28_100-1000_wConsensus.txt"#,#
#				"RF_Eucl_results_New_Rep29_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep30_100-1000_wConsensus.txt"#
				)#
#
dat <- NULL#
for(i in c(1:22,26,28)){#length(infiles.a)){ #**************UNCOMMENT ME FOR ALL REPS#
	temp.dat1 <- read.csv(infiles.a[i], header=TRUE, stringsAsFactors=FALSE)#
	temp.dat1$uniqueID <- paste(temp.dat1$species, temp.dat1$samp.size, temp.dat1$search.algo, temp.dat1$part.IC, sep="_")#
	temp.dat2 <- read.table(infiles.b[i], header=TRUE, stringsAsFactors=FALSE)#
	# because also have consenseus trees now:#
	temp.dat2 <- cbind(temp.dat2[1:32,], temp.dat2[33:64, 2:3])#
	names(temp.dat2) <- c("filename", "rf_dist", "eucl_dist", "cons_rf_dist", "cons_eucl_dist")#
	temp.dat2$uniqueID <- make.merge.id(temp.dat2)#
	temp.dat <- merge(temp.dat1, temp.dat2, by="uniqueID")#
	temp.dat$gene.size <- 100#
	temp.dat$mut.rate <- 1000#
	temp.dat$replicate <- i#
	dat <- rbind(dat, temp.dat)#
}#
#
no.part.dat <- dat[dat$part.IC == "noPart" ,]#
## IS there a statistically significant difference between the RF/eucl distance to true tree of no partitioning vs with partitioning??#
# compare at each sample size, for each species, for both RF and euclidean distance#
#
spp <- c("myria", "lopho")#
samps <- c(10,20,40,80)#
stat.data.set.BIC <- data.frame(matrix(NA, ncol=14, nrow=8))#
names(stat.data.set.BIC) <- c("species", "samp.size", "rf_twoside_p", "rf_less_p", "rf_greater_p", "eucl_twoside_p", "eucl_less_p", "eucl_greater_p", "cons_rf_twoside_p", "cons_rf_less_p", "cons_rf_greater_p", "cons_eucl_twoside_p", "cons_eucl_less_p", "cons_eucl_greater_p")#
#
iterate <- 1#
for(j in spp){#
	for(k in samps){#
		temp.dat.no.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "noPart" , ]#
		temp.dat.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "BIC" , ]#
		rf_ts_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		rf_less_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		rf_greater_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		eucl_ts_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		eucl_less_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		eucl_greater_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
#
		# also for the consensus tree#
		cons_rf_ts_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		cons_rf_less_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		cons_rf_greater_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		cons_eucl_ts_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		cons_eucl_less_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		cons_eucl_greater_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
		stat.data.set.BIC[iterate, ] <- c(j, k, rf_ts_p, rf_less_p, rf_greater_p, eucl_ts_p, eucl_less_p, eucl_greater_p, cons_rf_ts_p, cons_rf_less_p, cons_rf_greater_p, cons_eucl_ts_p, cons_eucl_less_p, cons_eucl_greater_p)#
		iterate <- iterate + 1#
	}#
}#
## AIC STATS#
#
spp <- c("myria", "lopho")#
samps <- c(10,20,40,80)#
stat.data.set.AIC <- data.frame(matrix(NA, ncol=14, nrow=8))#
names(stat.data.set.AIC) <- c("species", "samp.size", "rf_twoside_p", "rf_less_p", "rf_greater_p", "eucl_twoside_p", "eucl_less_p", "eucl_greater_p", "cons_rf_twoside_p", "cons_rf_less_p", "cons_rf_greater_p", "cons_eucl_twoside_p", "cons_eucl_less_p", "cons_eucl_greater_p")#
#
iterate <- 1#
for(j in spp){#
	for(k in samps){#
		temp.dat.no.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "noPart" , ]#
		temp.dat.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "AIC" , ]#
		rf_ts_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		rf_less_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		rf_greater_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		eucl_ts_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		eucl_less_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		eucl_greater_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
#
		# also for the consensus tree#
		cons_rf_ts_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		cons_rf_less_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		cons_rf_greater_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		cons_eucl_ts_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		cons_eucl_less_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		cons_eucl_greater_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
		stat.data.set.AIC[iterate, ] <- c(j, k, rf_ts_p, rf_less_p, rf_greater_p, eucl_ts_p, eucl_less_p, eucl_greater_p, cons_rf_ts_p, cons_rf_less_p, cons_rf_greater_p, cons_eucl_ts_p, cons_eucl_less_p, cons_eucl_greater_p)#
		iterate <- iterate + 1#
	}#
}#
### AICc STATS#
#
spp <- c("myria", "lopho")#
samps <- c(10,20,40,80)#
stat.data.set.AICc <- data.frame(matrix(NA, ncol=14, nrow=8))#
names(stat.data.set.AICc) <- c("species", "samp.size", "rf_twoside_p", "rf_less_p", "rf_greater_p", "eucl_twoside_p", "eucl_less_p", "eucl_greater_p", "cons_rf_twoside_p", "cons_rf_less_p", "cons_rf_greater_p", "cons_eucl_twoside_p", "cons_eucl_less_p", "cons_eucl_greater_p")#
#
iterate <- 1#
for(j in spp){#
	for(k in samps){#
		temp.dat.no.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "noPart" , ]#
		temp.dat.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "AICc" , ]#
		rf_ts_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		rf_less_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		rf_greater_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		eucl_ts_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		eucl_less_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		eucl_greater_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
#
		# also for the consensus tree#
		cons_rf_ts_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		cons_rf_less_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		cons_rf_greater_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		cons_eucl_ts_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		cons_eucl_less_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		cons_eucl_greater_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
		stat.data.set.AICc[iterate, ] <- c(j, k, rf_ts_p, rf_less_p, rf_greater_p, eucl_ts_p, eucl_less_p, eucl_greater_p, cons_rf_ts_p, cons_rf_less_p, cons_rf_greater_p, cons_eucl_ts_p, cons_eucl_less_p, cons_eucl_greater_p)#
		iterate <- iterate + 1#
	}#
}#
#####################################
samp.size.col <- c("steelblue4", "darkorange2", "green4", "red3")#
outline.col <- "gray30"#
samp.sizes <- c(10,20,40,80)#
#####################################
ylim1 <- c(-0.155, 0.155)#
ylim2 <- c(-1.35, 1.35)#
ylim3 <- c(0.5,10)#
box.width <- 1#
line.type <- 1#
line.width <- 1.75#
ytext1 <- 0.13#
ytext2 <- 1.075#
p.height1 <- 0.15#
p.height2 <- 1.3#
criteria <- c("AIC", "BIC", "AICc")#
for(criterion in criteria){#
#
if(criterion == "AIC") stat.data.set <- stat.data.set.AIC#
if(criterion == "BIC") stat.data.set <- stat.data.set.BIC#
if(criterion == "AICc") stat.data.set <- stat.data.set.AICc#
part.crit <- criterion#
#
pdf(paste(c("Results_Plots/Boxplots_", part.crit, "_StatsParts.pdf"), collapse=""), width=6, height=10)#
##par(mfrow=c(3,1), mar=c(2.5,4.25,1.75,0.25))#
par(mar=c(2.5,4.25,1.75,0.25))#
layout(matrix(c(1,1,2,2,3), ncol=1))#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim1, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Robinson Fould distance", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext1, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext1, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
# add p values from 2-sided wilcoxon test#
text(x=c(0.5,1:4), y=rep(p.height1, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height1, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
legend("bottomright", c("10", "20", "40", "80"), pch=15, col=samp.size.col, title = "num. genes", cex=0.875, pt.cex=1.5) # , bg="white"#
# eucl distance#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim2, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Euclidean distance", mgp=c(3,0.9,0))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext2, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext2, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=c(0.5,1:4), y=rep(p.height2, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height2, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
# number partitions#
par(mar=c(2.5,4.25,0.25,0.25))#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim3, xlab="", xaxt="n", ylab="number partitions inferred", main="", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
# AND NOW USING CONSENSUS TREE DISTANCE INSTEAD#
#
par(mar=c(2.5,4.25,1.75,0.25))#
#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim1, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Robinson Fould distance", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext1, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext1, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="cons_rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
# add p values from 2-sided wilcoxon test#
text(x=c(0.5,1:4), y=rep(p.height1, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="cons_rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height1, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
legend("bottomright", c("10", "20", "40", "80"), pch=15, col=samp.size.col, title = "num. genes", cex=0.875, pt.cex=1.5) # , bg="white"#
# eucl distance#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim2, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Euclidean distance", mgp=c(3,0.9,0))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext2, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext2, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="cons_eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=c(0.5,1:4), y=rep(p.height2, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="cons_eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height2, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
#SAME # number partitions#
par(mar=c(2.5,4.25,0.25,0.25))#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim3, xlab="", xaxt="n", ylab="number partitions inferred", main="", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
dev.off()#
}
library(scales)#
setwd("~/Documents/UNIL/PartitioningMethods_SimulationProject/FunctioningPipeline/AnalysisResults")#
make.merge.id <- function(dat){#
	id.col <- rep(NA, dim(dat)[1])#
	for(i in 1:dim(dat)[1]){#
		if(length(grep("lopho", dat$file[i])) > 0) spp <- "lopho_"#
		if(length(grep("myria", dat$file[i])) > 0) spp <- "myria_"#
		if(length(grep("10", dat$file[i])) > 0) samp <- "10_"#
		if(length(grep("20", dat$file[i])) > 0) samp <- "20_"#
		if(length(grep("40", dat$file[i])) > 0) samp <- "40_"#
		if(length(grep("80", dat$file[i])) > 0) samp <- "80_"#
		if(length(grep("rcluster", dat$file[i])) > 0) algo <- "rcluster_"#
		if(length(grep("greedy", dat$file[i])) > 0) algo <- "greedy_"#
		if(length(grep("noPart", dat$file[i])) > 0) algo <- "noPart_"#
		if(length(grep("AIC", dat$file[i])) > 0) crit <- "AIC"#
		if(length(grep("AICc", dat$file[i])) > 0) crit <- "AICc"#
		if(length(grep("BIC", dat$file[i])) > 0) crit <- "BIC"#
		if(length(grep("noPart", dat$file[i])) > 0) crit <- "noPart"#
		id.col[i] <- paste(c(spp, samp, algo, crit), collapse="")#
	}#
	return(id.col)#
}#
#####################################
#
get.rep.difference <- function(dat, rep, samp.size, spp, partitioning.criterion, distance){#
	temp.dat <- dat[dat$replicate == rep & dat$samp.size == samp.size & dat$species == spp , ]#
	no.part.result <- temp.dat[temp.dat$search.algo == "noPart" ,]#
	rclust.AIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AIC" ,]#
	rclust.BIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "BIC" ,]#
	rclust.AICc.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AICc",]#
	if(partitioning.criterion == "AIC"){#
		if(dim(rclust.AIC.result[distance])[1] == 0 | dim(no.part.result[distance])[1] == 0){ difference <- NA}#
		else{ difference <- no.part.result[distance] - rclust.AIC.result[distance] }#
	}#
	if(partitioning.criterion == "BIC"){#
		if(dim(rclust.BIC.result[distance])[1] == 0 | dim(no.part.result[distance])[1] == 0){ difference <- NA}#
		else{ difference <- no.part.result[distance] - rclust.BIC.result[distance] }#
	}#
	if(partitioning.criterion == "AICc"){#
		if(dim(rclust.AICc.result[distance])[1] == 0 | dim(no.part.result[distance])[1] == 0){ difference <- NA}#
		else{ difference <- no.part.result[distance] - rclust.AICc.result[distance] }#
	}#
	return(as.numeric(difference))			#
}#
#
#####################################
#
get.boxplot.dat <- function(dat, samp.size, spp, partitioning.criterion, distance){	#
	samp.size.dists <- NULL#
	for(j in unique(dat$replicate)){#
		dist <- get.rep.difference(dat, rep=j, samp.size=samp.size, spp=spp, partitioning.criterion=partitioning.criterion, distance=distance)#
		samp.size.dists <- c(samp.size.dists, dist)#
	}#
	return(samp.size.dists)#
}#
#
#####################################
#
get.partition.dat <- function(dat, samp.size, spp, partitioning.criterion){	#
	partition.numbers <- NULL#
	for(j in unique(dat$replicate)){#
		temp.dat <- dat[dat$replicate == j & dat$samp.size == samp.size & dat$species == spp , ]#
		rclust.AIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AIC" ,]#
		rclust.BIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "BIC" ,]#
		rclust.AICc.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AICc",]#
		if(partitioning.criterion == "AIC"){#
			if(length(rclust.AIC.result$num.partitions)[1] == 0){ num.parts <- NA}#
			else{ num.parts <- rclust.AIC.result$num.partitions }#
		}#
		if(partitioning.criterion == "BIC"){#
			if(length(rclust.BIC.result$num.partitions)[1] == 0){ num.parts <- NA}#
			else{ num.parts <- rclust.BIC.result$num.partitions }#
		}#
		if(partitioning.criterion == "AICc"){#
			if(length(rclust.AICc.result$num.partitions)[1] == 0){ num.parts <- NA}#
			else{ num.parts <- rclust.AICc.result$num.partitions }#
		}#
		partition.numbers <- c(partition.numbers, num.parts)#
	}#
	return(partition.numbers)#
}#
#
#####################################
# mut rate 1000#
#
infiles.a <- c("AllStatsOutput_New_Rep1_100-1000.csv",#
				"AllStatsOutput_New_Rep2_100-1000.csv",#
				"AllStatsOutput_New_Rep3_100-1000.csv",#
				"AllStatsOutput_New_Rep4_100-1000.csv",#
				"AllStatsOutput_New_Rep5_100-1000.csv",#
				"AllStatsOutput_New_Rep6_100-1000.csv",#
				"AllStatsOutput_Newest_Rep7_100-1000.csv",#
				"AllStatsOutput_Newest_Rep8_100-1000.csv",#
				"AllStatsOutput_Newest_Rep9_100-1000.csv",#
				"AllStatsOutput_Newest_Rep10_100-1000.csv",#
				"AllStatsOutput_Newest_Rep11_100-1000.csv",#
				"AllStatsOutput_Newest_Rep12_100-1000.csv",#
				"AllStatsOutput_Newest_Rep13_100-1000.csv",#
				"AllStatsOutput_Newest_Rep14_100-1000.csv",#
				"AllStatsOutput_Newest_Rep15_100-1000.csv",#
				"AllStatsOutput_Newest_Rep16_100-1000.csv",#
				"AllStatsOutput_Newest_Rep17_100-1000.csv",#
				"AllStatsOutput_Newest_Rep18_100-1000.csv",#
				"AllStatsOutput_Newest_Rep19_100-1000.csv",#
				"AllStatsOutput_Newest_Rep20_100-1000.csv",#
				"AllStatsOutput_Newest_Rep21_100-1000.csv",#
				"AllStatsOutput_Newest_Rep22_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep23_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep24_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep25_100-1000.csv",#
				"AllStatsOutput_Newest_Rep26_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep27_100-1000.csv",#
				"AllStatsOutput_Newest_Rep28_100-1000.csv"#,#
#				"AllStatsOutput_Newest_Rep29_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep30_100-1000.csv"#
				)#
infiles.b <- c("RF_Eucl_results_New_Rep1_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep2_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep3_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep4_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep5_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep6_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep7_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep8_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep9_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep10_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep11_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep12_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep13_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep14_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep15_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep16_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep17_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep18_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep19_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep20_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep21_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep22_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep23_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep24_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep25_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep26_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep27_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep28_100-1000_wConsensus.txt"#,#
#				"RF_Eucl_results_New_Rep29_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep30_100-1000_wConsensus.txt"#
				)#
#
dat <- NULL#
for(i in c(1:22,26,28)){#length(infiles.a)){ #**************UNCOMMENT ME FOR ALL REPS#
	temp.dat1 <- read.csv(infiles.a[i], header=TRUE, stringsAsFactors=FALSE)#
	temp.dat1$uniqueID <- paste(temp.dat1$species, temp.dat1$samp.size, temp.dat1$search.algo, temp.dat1$part.IC, sep="_")#
	temp.dat2 <- read.table(infiles.b[i], header=TRUE, stringsAsFactors=FALSE)#
	# because also have consenseus trees now:#
	temp.dat2 <- cbind(temp.dat2[1:32,], temp.dat2[33:64, 2:3])#
	names(temp.dat2) <- c("filename", "rf_dist", "eucl_dist", "cons_rf_dist", "cons_eucl_dist")#
	temp.dat2$uniqueID <- make.merge.id(temp.dat2)#
	temp.dat <- merge(temp.dat1, temp.dat2, by="uniqueID")#
	temp.dat$gene.size <- 100#
	temp.dat$mut.rate <- 1000#
	temp.dat$replicate <- i#
	dat <- rbind(dat, temp.dat)#
}#
#
no.part.dat <- dat[dat$part.IC == "noPart" ,]#
## IS there a statistically significant difference between the RF/eucl distance to true tree of no partitioning vs with partitioning??#
# compare at each sample size, for each species, for both RF and euclidean distance#
#
spp <- c("myria", "lopho")#
samps <- c(10,20,40,80)#
stat.data.set.BIC <- data.frame(matrix(NA, ncol=14, nrow=8))#
names(stat.data.set.BIC) <- c("species", "samp.size", "rf_twoside_p", "rf_less_p", "rf_greater_p", "eucl_twoside_p", "eucl_less_p", "eucl_greater_p", "cons_rf_twoside_p", "cons_rf_less_p", "cons_rf_greater_p", "cons_eucl_twoside_p", "cons_eucl_less_p", "cons_eucl_greater_p")#
#
iterate <- 1#
for(j in spp){#
	for(k in samps){#
		temp.dat.no.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "noPart" , ]#
		temp.dat.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "BIC" , ]#
		rf_ts_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		rf_less_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		rf_greater_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		eucl_ts_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		eucl_less_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		eucl_greater_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
#
		# also for the consensus tree#
		cons_rf_ts_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		cons_rf_less_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		cons_rf_greater_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		cons_eucl_ts_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		cons_eucl_less_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		cons_eucl_greater_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
		stat.data.set.BIC[iterate, ] <- c(j, k, rf_ts_p, rf_less_p, rf_greater_p, eucl_ts_p, eucl_less_p, eucl_greater_p, cons_rf_ts_p, cons_rf_less_p, cons_rf_greater_p, cons_eucl_ts_p, cons_eucl_less_p, cons_eucl_greater_p)#
		iterate <- iterate + 1#
	}#
}#
## AIC STATS#
#
spp <- c("myria", "lopho")#
samps <- c(10,20,40,80)#
stat.data.set.AIC <- data.frame(matrix(NA, ncol=14, nrow=8))#
names(stat.data.set.AIC) <- c("species", "samp.size", "rf_twoside_p", "rf_less_p", "rf_greater_p", "eucl_twoside_p", "eucl_less_p", "eucl_greater_p", "cons_rf_twoside_p", "cons_rf_less_p", "cons_rf_greater_p", "cons_eucl_twoside_p", "cons_eucl_less_p", "cons_eucl_greater_p")#
#
iterate <- 1#
for(j in spp){#
	for(k in samps){#
		temp.dat.no.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "noPart" , ]#
		temp.dat.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "AIC" , ]#
		rf_ts_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		rf_less_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		rf_greater_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		eucl_ts_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		eucl_less_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		eucl_greater_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
#
		# also for the consensus tree#
		cons_rf_ts_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		cons_rf_less_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		cons_rf_greater_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		cons_eucl_ts_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		cons_eucl_less_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		cons_eucl_greater_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
		stat.data.set.AIC[iterate, ] <- c(j, k, rf_ts_p, rf_less_p, rf_greater_p, eucl_ts_p, eucl_less_p, eucl_greater_p, cons_rf_ts_p, cons_rf_less_p, cons_rf_greater_p, cons_eucl_ts_p, cons_eucl_less_p, cons_eucl_greater_p)#
		iterate <- iterate + 1#
	}#
}#
### AICc STATS#
#
spp <- c("myria", "lopho")#
samps <- c(10,20,40,80)#
stat.data.set.AICc <- data.frame(matrix(NA, ncol=14, nrow=8))#
names(stat.data.set.AICc) <- c("species", "samp.size", "rf_twoside_p", "rf_less_p", "rf_greater_p", "eucl_twoside_p", "eucl_less_p", "eucl_greater_p", "cons_rf_twoside_p", "cons_rf_less_p", "cons_rf_greater_p", "cons_eucl_twoside_p", "cons_eucl_less_p", "cons_eucl_greater_p")#
#
iterate <- 1#
for(j in spp){#
	for(k in samps){#
		temp.dat.no.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "noPart" , ]#
		temp.dat.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "AICc" , ]#
		rf_ts_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		rf_less_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		rf_greater_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		eucl_ts_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		eucl_less_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		eucl_greater_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
#
		# also for the consensus tree#
		cons_rf_ts_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		cons_rf_less_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		cons_rf_greater_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		cons_eucl_ts_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		cons_eucl_less_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		cons_eucl_greater_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
		stat.data.set.AICc[iterate, ] <- c(j, k, rf_ts_p, rf_less_p, rf_greater_p, eucl_ts_p, eucl_less_p, eucl_greater_p, cons_rf_ts_p, cons_rf_less_p, cons_rf_greater_p, cons_eucl_ts_p, cons_eucl_less_p, cons_eucl_greater_p)#
		iterate <- iterate + 1#
	}#
}#
#####################################
samp.size.col <- c("steelblue4", "darkorange2", "green4", "red3")#
outline.col <- "gray30"#
samp.sizes <- c(10,20,40,80)#
#####################################
ylim1 <- c(-0.155, 0.155)#
ylim2 <- c(-1.35, 1.35)#
ylim3 <- c(0.5,10)#
box.width <- 1#
line.type <- 1#
line.width <- 1.75#
ytext1 <- 0.13#
ytext2 <- 1.075#
p.height1 <- 0.15#
p.height2 <- 1.3#
text.size <- 0.9#
criteria <- c("AIC", "BIC", "AICc")#
for(criterion in criteria){#
#
if(criterion == "AIC") stat.data.set <- stat.data.set.AIC#
if(criterion == "BIC") stat.data.set <- stat.data.set.BIC#
if(criterion == "AICc") stat.data.set <- stat.data.set.AICc#
part.crit <- criterion#
#
pdf(paste(c("Results_Plots/Boxplots_", part.crit, "_StatsParts.pdf"), collapse=""), width=6, height=10)#
##par(mfrow=c(3,1), mar=c(2.5,4.25,1.75,0.25))#
par(mar=c(2.5,4.25,1.75,0.25))#
layout(matrix(c(1,1,2,2,3), ncol=1))#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim1, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Robinson Fould distance", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext1, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext1, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
# add p values from 2-sided wilcoxon test#
text(x=c(0.5,1:4), y=rep(p.height1, 5), cex=text.size, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height1, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
legend("bottomright", c("10", "20", "40", "80"), pch=15, col=samp.size.col, title = "num. genes", cex=0.875, pt.cex=1.5) # , bg="white"#
# eucl distance#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim2, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Euclidean distance", mgp=c(3,0.9,0))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext2, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext2, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=c(0.5,1:4), y=rep(p.height2, 5), cex=text.size, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height2, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
# number partitions#
par(mar=c(2.5,4.25,0.25,0.25))#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim3, xlab="", xaxt="n", ylab="number partitions inferred", main="", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
# AND NOW USING CONSENSUS TREE DISTANCE INSTEAD#
#
par(mar=c(2.5,4.25,1.75,0.25))#
#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim1, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Robinson Fould distance", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext1, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext1, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="cons_rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
# add p values from 2-sided wilcoxon test#
text(x=c(0.5,1:4), y=rep(p.height1, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="cons_rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height1, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
legend("bottomright", c("10", "20", "40", "80"), pch=15, col=samp.size.col, title = "num. genes", cex=0.875, pt.cex=1.5) # , bg="white"#
# eucl distance#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim2, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Euclidean distance", mgp=c(3,0.9,0))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext2, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext2, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="cons_eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=c(0.5,1:4), y=rep(p.height2, 5), cex=0.75, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="cons_eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height2, 4), cex=0.75, c(#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
#SAME # number partitions#
par(mar=c(2.5,4.25,0.25,0.25))#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim3, xlab="", xaxt="n", ylab="number partitions inferred", main="", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
dev.off()#
}
library(scales)#
setwd("~/Documents/UNIL/PartitioningMethods_SimulationProject/FunctioningPipeline/AnalysisResults")#
make.merge.id <- function(dat){#
	id.col <- rep(NA, dim(dat)[1])#
	for(i in 1:dim(dat)[1]){#
		if(length(grep("lopho", dat$file[i])) > 0) spp <- "lopho_"#
		if(length(grep("myria", dat$file[i])) > 0) spp <- "myria_"#
		if(length(grep("10", dat$file[i])) > 0) samp <- "10_"#
		if(length(grep("20", dat$file[i])) > 0) samp <- "20_"#
		if(length(grep("40", dat$file[i])) > 0) samp <- "40_"#
		if(length(grep("80", dat$file[i])) > 0) samp <- "80_"#
		if(length(grep("rcluster", dat$file[i])) > 0) algo <- "rcluster_"#
		if(length(grep("greedy", dat$file[i])) > 0) algo <- "greedy_"#
		if(length(grep("noPart", dat$file[i])) > 0) algo <- "noPart_"#
		if(length(grep("AIC", dat$file[i])) > 0) crit <- "AIC"#
		if(length(grep("AICc", dat$file[i])) > 0) crit <- "AICc"#
		if(length(grep("BIC", dat$file[i])) > 0) crit <- "BIC"#
		if(length(grep("noPart", dat$file[i])) > 0) crit <- "noPart"#
		id.col[i] <- paste(c(spp, samp, algo, crit), collapse="")#
	}#
	return(id.col)#
}#
#####################################
#
get.rep.difference <- function(dat, rep, samp.size, spp, partitioning.criterion, distance){#
	temp.dat <- dat[dat$replicate == rep & dat$samp.size == samp.size & dat$species == spp , ]#
	no.part.result <- temp.dat[temp.dat$search.algo == "noPart" ,]#
	rclust.AIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AIC" ,]#
	rclust.BIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "BIC" ,]#
	rclust.AICc.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AICc",]#
	if(partitioning.criterion == "AIC"){#
		if(dim(rclust.AIC.result[distance])[1] == 0 | dim(no.part.result[distance])[1] == 0){ difference <- NA}#
		else{ difference <- no.part.result[distance] - rclust.AIC.result[distance] }#
	}#
	if(partitioning.criterion == "BIC"){#
		if(dim(rclust.BIC.result[distance])[1] == 0 | dim(no.part.result[distance])[1] == 0){ difference <- NA}#
		else{ difference <- no.part.result[distance] - rclust.BIC.result[distance] }#
	}#
	if(partitioning.criterion == "AICc"){#
		if(dim(rclust.AICc.result[distance])[1] == 0 | dim(no.part.result[distance])[1] == 0){ difference <- NA}#
		else{ difference <- no.part.result[distance] - rclust.AICc.result[distance] }#
	}#
	return(as.numeric(difference))			#
}#
#
#####################################
#
get.boxplot.dat <- function(dat, samp.size, spp, partitioning.criterion, distance){	#
	samp.size.dists <- NULL#
	for(j in unique(dat$replicate)){#
		dist <- get.rep.difference(dat, rep=j, samp.size=samp.size, spp=spp, partitioning.criterion=partitioning.criterion, distance=distance)#
		samp.size.dists <- c(samp.size.dists, dist)#
	}#
	return(samp.size.dists)#
}#
#
#####################################
#
get.partition.dat <- function(dat, samp.size, spp, partitioning.criterion){	#
	partition.numbers <- NULL#
	for(j in unique(dat$replicate)){#
		temp.dat <- dat[dat$replicate == j & dat$samp.size == samp.size & dat$species == spp , ]#
		rclust.AIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AIC" ,]#
		rclust.BIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "BIC" ,]#
		rclust.AICc.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AICc",]#
		if(partitioning.criterion == "AIC"){#
			if(length(rclust.AIC.result$num.partitions)[1] == 0){ num.parts <- NA}#
			else{ num.parts <- rclust.AIC.result$num.partitions }#
		}#
		if(partitioning.criterion == "BIC"){#
			if(length(rclust.BIC.result$num.partitions)[1] == 0){ num.parts <- NA}#
			else{ num.parts <- rclust.BIC.result$num.partitions }#
		}#
		if(partitioning.criterion == "AICc"){#
			if(length(rclust.AICc.result$num.partitions)[1] == 0){ num.parts <- NA}#
			else{ num.parts <- rclust.AICc.result$num.partitions }#
		}#
		partition.numbers <- c(partition.numbers, num.parts)#
	}#
	return(partition.numbers)#
}#
#
#####################################
# mut rate 1000#
#
infiles.a <- c("AllStatsOutput_New_Rep1_100-1000.csv",#
				"AllStatsOutput_New_Rep2_100-1000.csv",#
				"AllStatsOutput_New_Rep3_100-1000.csv",#
				"AllStatsOutput_New_Rep4_100-1000.csv",#
				"AllStatsOutput_New_Rep5_100-1000.csv",#
				"AllStatsOutput_New_Rep6_100-1000.csv",#
				"AllStatsOutput_Newest_Rep7_100-1000.csv",#
				"AllStatsOutput_Newest_Rep8_100-1000.csv",#
				"AllStatsOutput_Newest_Rep9_100-1000.csv",#
				"AllStatsOutput_Newest_Rep10_100-1000.csv",#
				"AllStatsOutput_Newest_Rep11_100-1000.csv",#
				"AllStatsOutput_Newest_Rep12_100-1000.csv",#
				"AllStatsOutput_Newest_Rep13_100-1000.csv",#
				"AllStatsOutput_Newest_Rep14_100-1000.csv",#
				"AllStatsOutput_Newest_Rep15_100-1000.csv",#
				"AllStatsOutput_Newest_Rep16_100-1000.csv",#
				"AllStatsOutput_Newest_Rep17_100-1000.csv",#
				"AllStatsOutput_Newest_Rep18_100-1000.csv",#
				"AllStatsOutput_Newest_Rep19_100-1000.csv",#
				"AllStatsOutput_Newest_Rep20_100-1000.csv",#
				"AllStatsOutput_Newest_Rep21_100-1000.csv",#
				"AllStatsOutput_Newest_Rep22_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep23_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep24_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep25_100-1000.csv",#
				"AllStatsOutput_Newest_Rep26_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep27_100-1000.csv",#
				"AllStatsOutput_Newest_Rep28_100-1000.csv"#,#
#				"AllStatsOutput_Newest_Rep29_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep30_100-1000.csv"#
				)#
infiles.b <- c("RF_Eucl_results_New_Rep1_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep2_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep3_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep4_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep5_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep6_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep7_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep8_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep9_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep10_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep11_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep12_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep13_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep14_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep15_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep16_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep17_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep18_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep19_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep20_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep21_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep22_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep23_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep24_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep25_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep26_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep27_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep28_100-1000_wConsensus.txt"#,#
#				"RF_Eucl_results_New_Rep29_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep30_100-1000_wConsensus.txt"#
				)#
#
dat <- NULL#
for(i in c(1:22,26,28)){#length(infiles.a)){ #**************UNCOMMENT ME FOR ALL REPS#
	temp.dat1 <- read.csv(infiles.a[i], header=TRUE, stringsAsFactors=FALSE)#
	temp.dat1$uniqueID <- paste(temp.dat1$species, temp.dat1$samp.size, temp.dat1$search.algo, temp.dat1$part.IC, sep="_")#
	temp.dat2 <- read.table(infiles.b[i], header=TRUE, stringsAsFactors=FALSE)#
	# because also have consenseus trees now:#
	temp.dat2 <- cbind(temp.dat2[1:32,], temp.dat2[33:64, 2:3])#
	names(temp.dat2) <- c("filename", "rf_dist", "eucl_dist", "cons_rf_dist", "cons_eucl_dist")#
	temp.dat2$uniqueID <- make.merge.id(temp.dat2)#
	temp.dat <- merge(temp.dat1, temp.dat2, by="uniqueID")#
	temp.dat$gene.size <- 100#
	temp.dat$mut.rate <- 1000#
	temp.dat$replicate <- i#
	dat <- rbind(dat, temp.dat)#
}#
#
no.part.dat <- dat[dat$part.IC == "noPart" ,]#
## IS there a statistically significant difference between the RF/eucl distance to true tree of no partitioning vs with partitioning??#
# compare at each sample size, for each species, for both RF and euclidean distance#
#
spp <- c("myria", "lopho")#
samps <- c(10,20,40,80)#
stat.data.set.BIC <- data.frame(matrix(NA, ncol=14, nrow=8))#
names(stat.data.set.BIC) <- c("species", "samp.size", "rf_twoside_p", "rf_less_p", "rf_greater_p", "eucl_twoside_p", "eucl_less_p", "eucl_greater_p", "cons_rf_twoside_p", "cons_rf_less_p", "cons_rf_greater_p", "cons_eucl_twoside_p", "cons_eucl_less_p", "cons_eucl_greater_p")#
#
iterate <- 1#
for(j in spp){#
	for(k in samps){#
		temp.dat.no.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "noPart" , ]#
		temp.dat.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "BIC" , ]#
		rf_ts_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		rf_less_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		rf_greater_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		eucl_ts_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		eucl_less_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		eucl_greater_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
#
		# also for the consensus tree#
		cons_rf_ts_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		cons_rf_less_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		cons_rf_greater_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		cons_eucl_ts_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		cons_eucl_less_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		cons_eucl_greater_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
		stat.data.set.BIC[iterate, ] <- c(j, k, rf_ts_p, rf_less_p, rf_greater_p, eucl_ts_p, eucl_less_p, eucl_greater_p, cons_rf_ts_p, cons_rf_less_p, cons_rf_greater_p, cons_eucl_ts_p, cons_eucl_less_p, cons_eucl_greater_p)#
		iterate <- iterate + 1#
	}#
}#
## AIC STATS#
#
spp <- c("myria", "lopho")#
samps <- c(10,20,40,80)#
stat.data.set.AIC <- data.frame(matrix(NA, ncol=14, nrow=8))#
names(stat.data.set.AIC) <- c("species", "samp.size", "rf_twoside_p", "rf_less_p", "rf_greater_p", "eucl_twoside_p", "eucl_less_p", "eucl_greater_p", "cons_rf_twoside_p", "cons_rf_less_p", "cons_rf_greater_p", "cons_eucl_twoside_p", "cons_eucl_less_p", "cons_eucl_greater_p")#
#
iterate <- 1#
for(j in spp){#
	for(k in samps){#
		temp.dat.no.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "noPart" , ]#
		temp.dat.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "AIC" , ]#
		rf_ts_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		rf_less_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		rf_greater_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		eucl_ts_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		eucl_less_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		eucl_greater_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
#
		# also for the consensus tree#
		cons_rf_ts_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		cons_rf_less_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		cons_rf_greater_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		cons_eucl_ts_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		cons_eucl_less_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		cons_eucl_greater_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
		stat.data.set.AIC[iterate, ] <- c(j, k, rf_ts_p, rf_less_p, rf_greater_p, eucl_ts_p, eucl_less_p, eucl_greater_p, cons_rf_ts_p, cons_rf_less_p, cons_rf_greater_p, cons_eucl_ts_p, cons_eucl_less_p, cons_eucl_greater_p)#
		iterate <- iterate + 1#
	}#
}#
### AICc STATS#
#
spp <- c("myria", "lopho")#
samps <- c(10,20,40,80)#
stat.data.set.AICc <- data.frame(matrix(NA, ncol=14, nrow=8))#
names(stat.data.set.AICc) <- c("species", "samp.size", "rf_twoside_p", "rf_less_p", "rf_greater_p", "eucl_twoside_p", "eucl_less_p", "eucl_greater_p", "cons_rf_twoside_p", "cons_rf_less_p", "cons_rf_greater_p", "cons_eucl_twoside_p", "cons_eucl_less_p", "cons_eucl_greater_p")#
#
iterate <- 1#
for(j in spp){#
	for(k in samps){#
		temp.dat.no.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "noPart" , ]#
		temp.dat.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "AICc" , ]#
		rf_ts_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		rf_less_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		rf_greater_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		eucl_ts_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		eucl_less_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		eucl_greater_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
#
		# also for the consensus tree#
		cons_rf_ts_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		cons_rf_less_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		cons_rf_greater_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		cons_eucl_ts_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		cons_eucl_less_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		cons_eucl_greater_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
		stat.data.set.AICc[iterate, ] <- c(j, k, rf_ts_p, rf_less_p, rf_greater_p, eucl_ts_p, eucl_less_p, eucl_greater_p, cons_rf_ts_p, cons_rf_less_p, cons_rf_greater_p, cons_eucl_ts_p, cons_eucl_less_p, cons_eucl_greater_p)#
		iterate <- iterate + 1#
	}#
}#
#####################################
samp.size.col <- c("steelblue4", "darkorange2", "green4", "red3")#
outline.col <- "gray30"#
samp.sizes <- c(10,20,40,80)#
#####################################
ylim1 <- c(-0.155, 0.155)#
ylim2 <- c(-1.35, 1.35)#
ylim3 <- c(0.5,10)#
box.width <- 1#
line.type <- 1#
line.width <- 1.75#
ytext1 <- 0.13#
ytext2 <- 1.075#
p.height1 <- 0.15#
p.height2 <- 1.3#
text.size <- 1.5#
criteria <- c("AIC", "BIC", "AICc")#
for(criterion in criteria){#
#
if(criterion == "AIC") stat.data.set <- stat.data.set.AIC#
if(criterion == "BIC") stat.data.set <- stat.data.set.BIC#
if(criterion == "AICc") stat.data.set <- stat.data.set.AICc#
part.crit <- criterion#
#
pdf(paste(c("Results_Plots/Boxplots_", part.crit, "_StatsParts.pdf"), collapse=""), width=6, height=10)#
##par(mfrow=c(3,1), mar=c(2.5,4.25,1.75,0.25))#
par(mar=c(2.5,4.25,1.75,0.25))#
layout(matrix(c(1,1,2,2,3), ncol=1))#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim1, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Robinson Fould distance", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext1, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext1, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
# add p values from 2-sided wilcoxon test#
text(x=c(0.5,1:4), y=rep(p.height1, 5), cex=text.size, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height1, 4), cex=text.size, c(#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
legend("bottomright", c("10", "20", "40", "80"), pch=15, col=samp.size.col, title = "num. genes", cex=0.875, pt.cex=1.5) # , bg="white"#
# eucl distance#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim2, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Euclidean distance", mgp=c(3,0.9,0))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext2, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext2, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=c(0.5,1:4), y=rep(p.height2, 5), cex=text.size, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height2, 4), cex=text.size, c(#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
# number partitions#
par(mar=c(2.5,4.25,0.25,0.25))#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim3, xlab="", xaxt="n", ylab="number partitions inferred", main="", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
# AND NOW USING CONSENSUS TREE DISTANCE INSTEAD#
#
par(mar=c(2.5,4.25,1.75,0.25))#
#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim1, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Robinson Fould distance", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext1, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext1, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="cons_rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
# add p values from 2-sided wilcoxon test#
text(x=c(0.5,1:4), y=rep(p.height1, 5), cex=text.size, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="cons_rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height1, 4), cex= text.size, c(#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
legend("bottomright", c("10", "20", "40", "80"), pch=15, col=samp.size.col, title = "num. genes", cex=0.875, pt.cex=1.5) # , bg="white"#
# eucl distance#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim2, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Euclidean distance", mgp=c(3,0.9,0))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext2, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext2, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="cons_eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=c(0.5,1:4), y=rep(p.height2, 5), cex=text.size, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="cons_eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height2, 4), cex=text.size, c(#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
#SAME # number partitions#
par(mar=c(2.5,4.25,0.25,0.25))#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim3, xlab="", xaxt="n", ylab="number partitions inferred", main="", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
dev.off()#
}
library(scales)#
setwd("~/Documents/UNIL/PartitioningMethods_SimulationProject/FunctioningPipeline/AnalysisResults")#
make.merge.id <- function(dat){#
	id.col <- rep(NA, dim(dat)[1])#
	for(i in 1:dim(dat)[1]){#
		if(length(grep("lopho", dat$file[i])) > 0) spp <- "lopho_"#
		if(length(grep("myria", dat$file[i])) > 0) spp <- "myria_"#
		if(length(grep("10", dat$file[i])) > 0) samp <- "10_"#
		if(length(grep("20", dat$file[i])) > 0) samp <- "20_"#
		if(length(grep("40", dat$file[i])) > 0) samp <- "40_"#
		if(length(grep("80", dat$file[i])) > 0) samp <- "80_"#
		if(length(grep("rcluster", dat$file[i])) > 0) algo <- "rcluster_"#
		if(length(grep("greedy", dat$file[i])) > 0) algo <- "greedy_"#
		if(length(grep("noPart", dat$file[i])) > 0) algo <- "noPart_"#
		if(length(grep("AIC", dat$file[i])) > 0) crit <- "AIC"#
		if(length(grep("AICc", dat$file[i])) > 0) crit <- "AICc"#
		if(length(grep("BIC", dat$file[i])) > 0) crit <- "BIC"#
		if(length(grep("noPart", dat$file[i])) > 0) crit <- "noPart"#
		id.col[i] <- paste(c(spp, samp, algo, crit), collapse="")#
	}#
	return(id.col)#
}#
#####################################
#
get.rep.difference <- function(dat, rep, samp.size, spp, partitioning.criterion, distance){#
	temp.dat <- dat[dat$replicate == rep & dat$samp.size == samp.size & dat$species == spp , ]#
	no.part.result <- temp.dat[temp.dat$search.algo == "noPart" ,]#
	rclust.AIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AIC" ,]#
	rclust.BIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "BIC" ,]#
	rclust.AICc.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AICc",]#
	if(partitioning.criterion == "AIC"){#
		if(dim(rclust.AIC.result[distance])[1] == 0 | dim(no.part.result[distance])[1] == 0){ difference <- NA}#
		else{ difference <- no.part.result[distance] - rclust.AIC.result[distance] }#
	}#
	if(partitioning.criterion == "BIC"){#
		if(dim(rclust.BIC.result[distance])[1] == 0 | dim(no.part.result[distance])[1] == 0){ difference <- NA}#
		else{ difference <- no.part.result[distance] - rclust.BIC.result[distance] }#
	}#
	if(partitioning.criterion == "AICc"){#
		if(dim(rclust.AICc.result[distance])[1] == 0 | dim(no.part.result[distance])[1] == 0){ difference <- NA}#
		else{ difference <- no.part.result[distance] - rclust.AICc.result[distance] }#
	}#
	return(as.numeric(difference))			#
}#
#
#####################################
#
get.boxplot.dat <- function(dat, samp.size, spp, partitioning.criterion, distance){	#
	samp.size.dists <- NULL#
	for(j in unique(dat$replicate)){#
		dist <- get.rep.difference(dat, rep=j, samp.size=samp.size, spp=spp, partitioning.criterion=partitioning.criterion, distance=distance)#
		samp.size.dists <- c(samp.size.dists, dist)#
	}#
	return(samp.size.dists)#
}#
#
#####################################
#
get.partition.dat <- function(dat, samp.size, spp, partitioning.criterion){	#
	partition.numbers <- NULL#
	for(j in unique(dat$replicate)){#
		temp.dat <- dat[dat$replicate == j & dat$samp.size == samp.size & dat$species == spp , ]#
		rclust.AIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AIC" ,]#
		rclust.BIC.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "BIC" ,]#
		rclust.AICc.result <- temp.dat[temp.dat$search.algo == "rcluster" & temp.dat$part.IC == "AICc",]#
		if(partitioning.criterion == "AIC"){#
			if(length(rclust.AIC.result$num.partitions)[1] == 0){ num.parts <- NA}#
			else{ num.parts <- rclust.AIC.result$num.partitions }#
		}#
		if(partitioning.criterion == "BIC"){#
			if(length(rclust.BIC.result$num.partitions)[1] == 0){ num.parts <- NA}#
			else{ num.parts <- rclust.BIC.result$num.partitions }#
		}#
		if(partitioning.criterion == "AICc"){#
			if(length(rclust.AICc.result$num.partitions)[1] == 0){ num.parts <- NA}#
			else{ num.parts <- rclust.AICc.result$num.partitions }#
		}#
		partition.numbers <- c(partition.numbers, num.parts)#
	}#
	return(partition.numbers)#
}#
#
#####################################
# mut rate 1000#
#
infiles.a <- c("AllStatsOutput_New_Rep1_100-1000.csv",#
				"AllStatsOutput_New_Rep2_100-1000.csv",#
				"AllStatsOutput_New_Rep3_100-1000.csv",#
				"AllStatsOutput_New_Rep4_100-1000.csv",#
				"AllStatsOutput_New_Rep5_100-1000.csv",#
				"AllStatsOutput_New_Rep6_100-1000.csv",#
				"AllStatsOutput_Newest_Rep7_100-1000.csv",#
				"AllStatsOutput_Newest_Rep8_100-1000.csv",#
				"AllStatsOutput_Newest_Rep9_100-1000.csv",#
				"AllStatsOutput_Newest_Rep10_100-1000.csv",#
				"AllStatsOutput_Newest_Rep11_100-1000.csv",#
				"AllStatsOutput_Newest_Rep12_100-1000.csv",#
				"AllStatsOutput_Newest_Rep13_100-1000.csv",#
				"AllStatsOutput_Newest_Rep14_100-1000.csv",#
				"AllStatsOutput_Newest_Rep15_100-1000.csv",#
				"AllStatsOutput_Newest_Rep16_100-1000.csv",#
				"AllStatsOutput_Newest_Rep17_100-1000.csv",#
				"AllStatsOutput_Newest_Rep18_100-1000.csv",#
				"AllStatsOutput_Newest_Rep19_100-1000.csv",#
				"AllStatsOutput_Newest_Rep20_100-1000.csv",#
				"AllStatsOutput_Newest_Rep21_100-1000.csv",#
				"AllStatsOutput_Newest_Rep22_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep23_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep24_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep25_100-1000.csv",#
				"AllStatsOutput_Newest_Rep26_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep27_100-1000.csv",#
				"AllStatsOutput_Newest_Rep28_100-1000.csv"#,#
#				"AllStatsOutput_Newest_Rep29_100-1000.csv",#
#				"AllStatsOutput_Newest_Rep30_100-1000.csv"#
				)#
infiles.b <- c("RF_Eucl_results_New_Rep1_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep2_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep3_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep4_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep5_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep6_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep7_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep8_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep9_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep10_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep11_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep12_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep13_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep14_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep15_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep16_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep17_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep18_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep19_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep20_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep21_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep22_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep23_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep24_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep25_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep26_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep27_100-1000_wConsensus.txt",#
				"RF_Eucl_results_New_Rep28_100-1000_wConsensus.txt"#,#
#				"RF_Eucl_results_New_Rep29_100-1000_wConsensus.txt",#
#				"RF_Eucl_results_New_Rep30_100-1000_wConsensus.txt"#
				)#
#
dat <- NULL#
for(i in c(1:22,26,28)){#length(infiles.a)){ #**************UNCOMMENT ME FOR ALL REPS#
	temp.dat1 <- read.csv(infiles.a[i], header=TRUE, stringsAsFactors=FALSE)#
	temp.dat1$uniqueID <- paste(temp.dat1$species, temp.dat1$samp.size, temp.dat1$search.algo, temp.dat1$part.IC, sep="_")#
	temp.dat2 <- read.table(infiles.b[i], header=TRUE, stringsAsFactors=FALSE)#
	# because also have consenseus trees now:#
	temp.dat2 <- cbind(temp.dat2[1:32,], temp.dat2[33:64, 2:3])#
	names(temp.dat2) <- c("filename", "rf_dist", "eucl_dist", "cons_rf_dist", "cons_eucl_dist")#
	temp.dat2$uniqueID <- make.merge.id(temp.dat2)#
	temp.dat <- merge(temp.dat1, temp.dat2, by="uniqueID")#
	temp.dat$gene.size <- 100#
	temp.dat$mut.rate <- 1000#
	temp.dat$replicate <- i#
	dat <- rbind(dat, temp.dat)#
}#
#
no.part.dat <- dat[dat$part.IC == "noPart" ,]#
## IS there a statistically significant difference between the RF/eucl distance to true tree of no partitioning vs with partitioning??#
# compare at each sample size, for each species, for both RF and euclidean distance#
#
spp <- c("myria", "lopho")#
samps <- c(10,20,40,80)#
stat.data.set.BIC <- data.frame(matrix(NA, ncol=14, nrow=8))#
names(stat.data.set.BIC) <- c("species", "samp.size", "rf_twoside_p", "rf_less_p", "rf_greater_p", "eucl_twoside_p", "eucl_less_p", "eucl_greater_p", "cons_rf_twoside_p", "cons_rf_less_p", "cons_rf_greater_p", "cons_eucl_twoside_p", "cons_eucl_less_p", "cons_eucl_greater_p")#
#
iterate <- 1#
for(j in spp){#
	for(k in samps){#
		temp.dat.no.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "noPart" , ]#
		temp.dat.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "BIC" , ]#
		rf_ts_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		rf_less_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		rf_greater_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		eucl_ts_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		eucl_less_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		eucl_greater_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
#
		# also for the consensus tree#
		cons_rf_ts_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		cons_rf_less_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		cons_rf_greater_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		cons_eucl_ts_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		cons_eucl_less_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		cons_eucl_greater_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
		stat.data.set.BIC[iterate, ] <- c(j, k, rf_ts_p, rf_less_p, rf_greater_p, eucl_ts_p, eucl_less_p, eucl_greater_p, cons_rf_ts_p, cons_rf_less_p, cons_rf_greater_p, cons_eucl_ts_p, cons_eucl_less_p, cons_eucl_greater_p)#
		iterate <- iterate + 1#
	}#
}#
## AIC STATS#
#
spp <- c("myria", "lopho")#
samps <- c(10,20,40,80)#
stat.data.set.AIC <- data.frame(matrix(NA, ncol=14, nrow=8))#
names(stat.data.set.AIC) <- c("species", "samp.size", "rf_twoside_p", "rf_less_p", "rf_greater_p", "eucl_twoside_p", "eucl_less_p", "eucl_greater_p", "cons_rf_twoside_p", "cons_rf_less_p", "cons_rf_greater_p", "cons_eucl_twoside_p", "cons_eucl_less_p", "cons_eucl_greater_p")#
#
iterate <- 1#
for(j in spp){#
	for(k in samps){#
		temp.dat.no.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "noPart" , ]#
		temp.dat.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "AIC" , ]#
		rf_ts_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		rf_less_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		rf_greater_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		eucl_ts_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		eucl_less_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		eucl_greater_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
#
		# also for the consensus tree#
		cons_rf_ts_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		cons_rf_less_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		cons_rf_greater_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		cons_eucl_ts_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		cons_eucl_less_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		cons_eucl_greater_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
		stat.data.set.AIC[iterate, ] <- c(j, k, rf_ts_p, rf_less_p, rf_greater_p, eucl_ts_p, eucl_less_p, eucl_greater_p, cons_rf_ts_p, cons_rf_less_p, cons_rf_greater_p, cons_eucl_ts_p, cons_eucl_less_p, cons_eucl_greater_p)#
		iterate <- iterate + 1#
	}#
}#
### AICc STATS#
#
spp <- c("myria", "lopho")#
samps <- c(10,20,40,80)#
stat.data.set.AICc <- data.frame(matrix(NA, ncol=14, nrow=8))#
names(stat.data.set.AICc) <- c("species", "samp.size", "rf_twoside_p", "rf_less_p", "rf_greater_p", "eucl_twoside_p", "eucl_less_p", "eucl_greater_p", "cons_rf_twoside_p", "cons_rf_less_p", "cons_rf_greater_p", "cons_eucl_twoside_p", "cons_eucl_less_p", "cons_eucl_greater_p")#
#
iterate <- 1#
for(j in spp){#
	for(k in samps){#
		temp.dat.no.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "noPart" , ]#
		temp.dat.part <- dat[dat$samp.size == k & dat$species == j & dat$part.IC == "AICc" , ]#
		rf_ts_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		rf_less_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		rf_greater_p <- wilcox.test(temp.dat.no.part$rf_dist, temp.dat.part$rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		eucl_ts_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		eucl_less_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		eucl_greater_p <- wilcox.test(temp.dat.no.part$eucl_dist, temp.dat.part$eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
#
		# also for the consensus tree#
		cons_rf_ts_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="two.sided")$p.value # is there a significant diff?#
		cons_rf_less_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="less")$p.value # is the rf distance smaller in no part vs partitioned?#
		cons_rf_greater_p <- wilcox.test(temp.dat.no.part$cons_rf_dist, temp.dat.part$cons_rf_dist, paired=TRUE, alternative="greater")$p.value # is the rf distance smaller in partitioned trees?#
		cons_eucl_ts_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="two.sided")$p.value#
		cons_eucl_less_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="less")$p.value # is the euclidean distance smaller in no part vs partitioned?#
		cons_eucl_greater_p <- wilcox.test(temp.dat.no.part$cons_eucl_dist, temp.dat.part$cons_eucl_dist, paired=TRUE, alternative="greater")$p.value # is the euclidean distance smaller in partitioned trees?#
		stat.data.set.AICc[iterate, ] <- c(j, k, rf_ts_p, rf_less_p, rf_greater_p, eucl_ts_p, eucl_less_p, eucl_greater_p, cons_rf_ts_p, cons_rf_less_p, cons_rf_greater_p, cons_eucl_ts_p, cons_eucl_less_p, cons_eucl_greater_p)#
		iterate <- iterate + 1#
	}#
}#
#####################################
samp.size.col <- c("steelblue4", "darkorange2", "green4", "red3")#
outline.col <- "gray30"#
samp.sizes <- c(10,20,40,80)#
#####################################
ylim1 <- c(-0.155, 0.155)#
ylim2 <- c(-1.35, 1.35)#
ylim3 <- c(0.5,10)#
box.width <- 1#
line.type <- 1#
line.width <- 1.75#
ytext1 <- 0.13#
ytext2 <- 1.075#
p.height1 <- 0.15#
p.height2 <- 1.3#
text.size <- 1.25#
criteria <- c("AIC", "BIC", "AICc")#
for(criterion in criteria){#
#
if(criterion == "AIC") stat.data.set <- stat.data.set.AIC#
if(criterion == "BIC") stat.data.set <- stat.data.set.BIC#
if(criterion == "AICc") stat.data.set <- stat.data.set.AICc#
part.crit <- criterion#
#
pdf(paste(c("Results_Plots/Boxplots_", part.crit, "_StatsParts.pdf"), collapse=""), width=6, height=10)#
##par(mfrow=c(3,1), mar=c(2.5,4.25,1.75,0.25))#
par(mar=c(2.5,4.25,1.75,0.25))#
layout(matrix(c(1,1,2,2,3), ncol=1))#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim1, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Robinson Fould distance", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext1, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext1, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
# add p values from 2-sided wilcoxon test#
text(x=c(0.5,1:4), y=rep(p.height1, 5), cex=text.size, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height1, 4), cex=text.size, c(#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
legend("bottomright", c("10", "20", "40", "80"), pch=15, col=samp.size.col, title = "num. genes", cex=0.875, pt.cex=1.5) # , bg="white"#
# eucl distance#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim2, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Euclidean distance", mgp=c(3,0.9,0))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext2, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext2, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=c(0.5,1:4), y=rep(p.height2, 5), cex=text.size, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height2, 4), cex=text.size, c(#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
# number partitions#
par(mar=c(2.5,4.25,0.25,0.25))#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim3, xlab="", xaxt="n", ylab="number partitions inferred", main="", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
# AND NOW USING CONSENSUS TREE DISTANCE INSTEAD#
#
par(mar=c(2.5,4.25,1.75,0.25))#
#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim1, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Robinson Fould distance", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext1, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext1, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="cons_rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
# add p values from 2-sided wilcoxon test#
text(x=c(0.5,1:4), y=rep(p.height1, 5), cex=text.size, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="cons_rf_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height1, 4), cex= text.size, c(#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_rf_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
legend("bottomright", c("10", "20", "40", "80"), pch=15, col=samp.size.col, title = "num. genes", cex=0.875, pt.cex=1.5) # , bg="white"#
# eucl distance#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim2, xlab="", xaxt="n", ylab="difference in distance from true tree", main="Euclidean distance", mgp=c(3,0.9,0))#
mtext(side=2, "(no partitioning - partitioning)", cex=0.75, line=2)#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
abline(h=0, col="gray75", lty=3, lwd=1.5)#
text(4.25,ytext2, expression(italic("partitioning better")), cex=1, col="green4")#
text(4.25,-ytext2, expression(italic("no partitioning better")), cex=1, col="red3")#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit, distance="cons_eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=c(0.5,1:4), y=rep(p.height2, 5), cex=text.size, c(expression(italic("p")*" = "), #
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "lopho" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
for(i in 1:4){#
	plot.dat <- get.boxplot.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit, distance="cons_eucl_dist")#
#	if(is.na(unique(plot.dat)) & length(unique(plot.dat)) == 1) next#
	boxplot(plot.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
text(x=1:4+4.5, y=rep(p.height2, 4), cex=text.size, c(#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 10][1]), digits=2), #
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 20][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 40][1]), digits=2),#
	format(as.numeric(stat.data.set$cons_eucl_twoside_p[stat.data.set$species == "myria" & stat.data.set$samp.size == 80][1]), digits=2)))#
#
#SAME # number partitions#
par(mar=c(2.5,4.25,0.25,0.25))#
plot(0, type="n", xlim=c(0.5,9), ylim=ylim3, xlab="", xaxt="n", ylab="number partitions inferred", main="", mgp=c(3,0.9,0))#
axis(side=1, at=c(2.5, 7), c("Lophotrochozoa (62 spp)", "Myriapoda (25 spp)"))#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="lopho", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
for(i in 1:4){#
	part.dat <- get.partition.dat(dat=dat, samp.size=samp.sizes[i], spp="myria", partitioning.criterion=part.crit)#
	boxplot(part.dat, add=TRUE, at=i+4.5, pch=23, col=samp.size.col[i], border=outline.col, width=box.width, lty=line.type, lwd=line.width, axes=FALSE)#
}#
dev.off()#
}
